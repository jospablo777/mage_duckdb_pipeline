---
title: "Data Pipeline with Mage, DuckDB, and Great Expectations"
include-in-header:
  - text: |
      <link rel = "shortcut icon" href = "img/favicon.png" />
author:
  name: "José P. Barrantes"
  url: "https://www.linkedin.com/in/jose-barrantes/"
description: "GitHub Repo: [Data Pipeline with Mage, DuckDB, and Great Expectations](https://github.com/jospablo777/)"
format: 
  html:
    toc: true
    toc-location: right
    toc-title: "On this page"
    aside: true
editor: source
---

![](img/pipeline_dag.png)

```{r}
#| label: setup
#| include: false
#| output: false

# Tell quarto where is our python venv
Sys.setenv(RETICULATE_PYTHON = "../venv/bin/python")
```

Token

```{python}
#| label: token_mention
#| include: true
#| eval: false

headers = {"X-App-Token": "YOUR_TOKEN"}
response = requests.get(data_url, headers=headers)
```

Bash execution

```{bash}
#| label: bash_pipeline_output
#| include: true
#| eval: false

user@user-pc:~/mage_duckdb_pipeline$ mage run . socrata_iowa_liquor_pipeline
SODA data pull started.
 Total of rows in this data set: 30522849
 Total of records in our DuckDB database: 12132000
Records left to fetch from the API: 18390849
Records that will be fetched in this job: 5000000
Number of batches: 100
Number of rows that will be pulled in each batch: 50000
Fetching data batches: 100%|█████████████████████| 100/100 [32:04<00:00, 19.25s/it]
Pipeline run completed.
```

