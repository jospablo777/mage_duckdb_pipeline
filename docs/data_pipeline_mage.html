<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="José P. Barrantes">
<meta name="dcterms.date" content="2025-01-07">
<meta name="description" content="GitHub Repo: SODA to DuckDB">

<title>Building a data pipeline with Mage, Polars, and DuckDB</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="site_libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<link rel="shortcut icon" href="img/favicon.png">


</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#where-are-we-in-the-data-lifecycle" id="toc-where-are-we-in-the-data-lifecycle" class="nav-link active" data-scroll-target="#where-are-we-in-the-data-lifecycle">Where are we in the data lifecycle?</a></li>
  <li><a href="#about-the-tools" id="toc-about-the-tools" class="nav-link" data-scroll-target="#about-the-tools">About the tools</a>
  <ul class="collapse">
  <li><a href="#what-are-data-orchestrators" id="toc-what-are-data-orchestrators" class="nav-link" data-scroll-target="#what-are-data-orchestrators">What are data orchestrators?</a></li>
  <li><a href="#data-manipulation-and-storage" id="toc-data-manipulation-and-storage" class="nav-link" data-scroll-target="#data-manipulation-and-storage">Data manipulation and storage</a></li>
  <li><a href="#tools-and-resources-overview" id="toc-tools-and-resources-overview" class="nav-link" data-scroll-target="#tools-and-resources-overview">Tools and resources overview:</a></li>
  </ul></li>
  <li><a href="#our-problem" id="toc-our-problem" class="nav-link" data-scroll-target="#our-problem">Our problem</a></li>
  <li><a href="#solution-implementation-getting-started" id="toc-solution-implementation-getting-started" class="nav-link" data-scroll-target="#solution-implementation-getting-started">Solution implementation: getting started</a></li>
  <li><a href="#soda-api-our-data-source" id="toc-soda-api-our-data-source" class="nav-link" data-scroll-target="#soda-api-our-data-source">SODA API: our data source</a></li>
  <li><a href="#fetching-the-data" id="toc-fetching-the-data" class="nav-link" data-scroll-target="#fetching-the-data">Fetching the data</a>
  <ul class="collapse">
  <li><a href="#writing-our-first-mage-blocks" id="toc-writing-our-first-mage-blocks" class="nav-link" data-scroll-target="#writing-our-first-mage-blocks">Writing our first Mage blocks</a></li>
  <li><a href="#pulling-the-iowa-liquor-sales-data" id="toc-pulling-the-iowa-liquor-sales-data" class="nav-link" data-scroll-target="#pulling-the-iowa-liquor-sales-data">Pulling the Iowa Liquor Sales data</a></li>
  <li><a href="#testing" id="toc-testing" class="nav-link" data-scroll-target="#testing">Testing</a></li>
  </ul></li>
  <li><a href="#transform-the-data" id="toc-transform-the-data" class="nav-link" data-scroll-target="#transform-the-data">Transform the data</a>
  <ul class="collapse">
  <li><a href="#have-present-the-bussiness-logic" id="toc-have-present-the-bussiness-logic" class="nav-link" data-scroll-target="#have-present-the-bussiness-logic">Have present the bussiness logic</a></li>
  <li><a href="#lets-transform-our-data" id="toc-lets-transform-our-data" class="nav-link" data-scroll-target="#lets-transform-our-data">Let’s transform our data</a></li>
  <li><a href="#test-test-test" id="toc-test-test-test" class="nav-link" data-scroll-target="#test-test-test">Test, test, test!</a></li>
  </ul></li>
  <li><a href="#persistent-storage-and-serving" id="toc-persistent-storage-and-serving" class="nav-link" data-scroll-target="#persistent-storage-and-serving">Persistent storage and serving</a>
  <ul class="collapse">
  <li><a href="#test-the-pipeline-in-mage" id="toc-test-the-pipeline-in-mage" class="nav-link" data-scroll-target="#test-the-pipeline-in-mage">Test the pipeline in Mage</a></li>
  </ul></li>
  <li><a href="#run-the-data-pipeline-in-the-terminal" id="toc-run-the-data-pipeline-in-the-terminal" class="nav-link" data-scroll-target="#run-the-data-pipeline-in-the-terminal">Run the data pipeline in the terminal</a>
  <ul class="collapse">
  <li><a href="#should-i-manually-run-the-pipeline-whenever-i-need-to-update-the-data" id="toc-should-i-manually-run-the-pipeline-whenever-i-need-to-update-the-data" class="nav-link" data-scroll-target="#should-i-manually-run-the-pipeline-whenever-i-need-to-update-the-data">Should I manually run the pipeline whenever I need to update the data?</a></li>
  </ul></li>
  <li><a href="#data-analytics" id="toc-data-analytics" class="nav-link" data-scroll-target="#data-analytics">Data analytics</a></li>
  <li><a href="#predictive-modeling-machine-learning" id="toc-predictive-modeling-machine-learning" class="nav-link" data-scroll-target="#predictive-modeling-machine-learning">Predictive modeling (machine learning)</a></li>
  <li><a href="#recap" id="toc-recap" class="nav-link" data-scroll-target="#recap">Recap</a></li>
  <li><a href="#cited-works-and-recommended-readings" id="toc-cited-works-and-recommended-readings" class="nav-link" data-scroll-target="#cited-works-and-recommended-readings">Cited works and recommended readings</a></li>
  <li><a href="#citation" id="toc-citation" class="nav-link" data-scroll-target="#citation">Citation</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#contact" id="toc-contact" class="nav-link" data-scroll-target="#contact">Contact</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Building a data pipeline with Mage, Polars, and DuckDB</h1>
</div>

<div>
  <div class="description">
    GitHub Repo: <a href="https://github.com/jospablo777/">SODA to DuckDB</a>
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://www.linkedin.com/in/jose-barrantes/">José P. Barrantes</a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Last updated</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><img src="img/bonjour_bear.png" class="img-fluid"></p>
<section id="where-are-we-in-the-data-lifecycle" class="level2">
<h2 class="anchored" data-anchor-id="where-are-we-in-the-data-lifecycle">Where are we in the data lifecycle?</h2>
<p>As data analysts or scientists, we often find ourselves working downstream in the data lifecycle. Most of the time, our role involves transforming and analyzing data that has already been prepared and served to us by upstream processes. However, having a deeper understanding of the entire data pipeline—from ingestion to transformation and storage—can empower us to optimize workflows, ensure data quality, and unlock new insights.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/data_lifecycle.png" class="img-fluid figure-img"></p>
<figcaption>The data lifecycle and where you are. Modified from “Fundamentals of Data Engineering” by Reis &amp; Housley (2022).</figcaption>
</figure>
</div>
<p>Another advantage of gaining understanding—and hands-on experience—in data engineering processes is the <strong>empathy</strong> we build with our data engineers. These are the colleagues we work closely with and rely on, making a strong, <strong>collaborative relationship</strong> essential. Hence, in this hands-on article, we will explore the Python ecosystem by examining tools such as Mage, Polars, and DuckDB. We’ll demonstrate how these tools can help us build efficient, lightweight data pipelines that take data from the source and store it in a format that is well-suited for high-performance analytics.</p>
</section>
<section id="about-the-tools" class="level2">
<h2 class="anchored" data-anchor-id="about-the-tools">About the tools</h2>
<p>In this project, we will use Mage as our data orchestrator. The tasks the orchestrator manages will include data fetching, manipulation and transformation using Polars, and persistent storage with DuckDB.</p>
<section id="what-are-data-orchestrators" class="level3">
<h3 class="anchored" data-anchor-id="what-are-data-orchestrators">What are data orchestrators?</h3>
<p>Data orchestrators, such as Mage, are tools that help manage, schedule, and monitor workflows in data pipelines. They allow us to automate complex processes, ensuring that tasks are executed in the correct order and dependencies are handled seamlessly. By using Mage as our orchestrator, we can streamline our data pipeline and focus on building efficient workflows that allow us to set a local database appropriate for our analysis.</p>
</section>
<section id="data-manipulation-and-storage" class="level3">
<h3 class="anchored" data-anchor-id="data-manipulation-and-storage">Data manipulation and storage</h3>
<p>Why Polars and DuckDB? The answer lies in the size and nature of the dataset we’re working with. Since our dataset is small enough to fit in memory, we don’t need a distributed system like Spark. Polars, with its fast and memory-efficient operations, is perfect for data manipulation and transformation. Meanwhile, DuckDB provides a lightweight, yet powerful, SQL-based engine for persistent storage and querying. Together, these tools offer a simple, performant, and highly efficient solution for handling our data pipeline.</p>
<p>Returning to the data lifecycle diagram, we can land it in a more concrete way to show how our project will be built and executed:</p>
<div id="fig-concrete-project-outline" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-concrete-project-outline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/data_lifecycle_logos.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-concrete-project-outline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Named figure&nbsp;1: The data lifecycle and a more concrete overview of what <strong>we will implement</strong> in this project. Modified from “Fundamentals of Data Engineering” by Reis &amp; Housley (2022).
</figcaption>
</figure>
</div>
<p>First, we will fetch the data from the Socrata Open Data API (SODA) through HTTP. After that, we will generate some extra variables of our interest with Polars, to finally store it in a DuckDB database. We will consume this database for analytics and predictive modeling. All this is orchestrated with Mage.</p>
</section>
<section id="tools-and-resources-overview" class="level3">
<h3 class="anchored" data-anchor-id="tools-and-resources-overview">Tools and resources overview:</h3>
<ul>
<li><a href="https://dev.socrata.com/"><strong>SODA API:</strong></a> provides access to open datasets, serving as our data source. It contains “a wealth of open data resources from governments, non-profits, and NGOs around the world<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.”</li>
<li><a href="https://www.mage.ai/"><strong>Mage:</strong></a> the data orchestrator that will automate and manage the pipeline.</li>
<li><a href="https://pola.rs/"><strong>Polars:</strong></a> a high-performance data frame library implemented in Rust, ideal for fast data manipulation.</li>
<li><a href="https://duckdb.org/"><strong>DuckDB:</strong></a> a columnar database system designed for efficient analytics and in-memory processing.</li>
</ul>
<p>We’ve chosen the <a href="https://data.iowa.gov/Sales-Distribution/Iowa-Liquor-Sales/m3tr-qhgy/about_data">Iowa Liquor Sales</a> dataset since it is big enough to make this ETL (extract, transform, load) pipeline interesting.</p>
</section>
</section>
<section id="our-problem" class="level2">
<h2 class="anchored" data-anchor-id="our-problem">Our problem</h2>
<p>Let’s say we work for a big chain of liquor stores located in the US, Iowa. Part of the intelligence in your company is built upon the information made available through SODA API, and it feeds some of the dashboards the decision-makers consume. You also use it often to do research and predictive modeling. Some stakeholders have started complaining about the loading times of the dashboards, and you have also been a little frustrated with the time it takes to get the data to train your predictive models.</p>
<p><img src="img/predictive_modeling_simpsons.png" class="img-fluid"></p>
<p>To continue building our situation, let’s imagine the year 2020—when the term “data engineer” was not as popular as it is today. You’ve just been hired as a data analyst<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, and according to Google Trends, the term “data engineer” was only half as popular as it is now. Moreover, a closer look at the trend data from 2020 reveals that most searches for this term originated in tech hubs like California or Washington rather than in states like Iowa.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_pipeline_mage_files/figure-html/google_trends_data_eng-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Google trends for ‘Data Engineering’ in the US, starting from 2004 to the date (Dec 2024)</figcaption>
</figure>
</div>
</div>
</div>
<p>At this point, you know you are on your own to optimize this process<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. And you already have a clear outline for this process:</p>
<ol type="1">
<li>Pull the data from the API.</li>
<li>Generate the variables that provide the most valuable insights for the team️.</li>
<li>Store the data in a location that allows for easy and fast retrieval .</li>
</ol>
<p>This brings us to our current challenge: finding a more agile and efficient way to make the SODA liquor sales data accessible to the rest of the company.</p>
</section>
<section id="solution-implementation-getting-started" class="level2">
<h2 class="anchored" data-anchor-id="solution-implementation-getting-started">Solution implementation: getting started</h2>
<p>As outlined earlier, the first step involves pulling the data from the API. However, before that, we need to set up Mage and configure the rest of our environment. To begin, we’ll clone the Git project and navigate to the project directory:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/jospablo777/mage_duckdb_pipeline.git</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> mage_duckdb_pipeline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we’ll set up a virtual environment and install the necessary libraries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> venv venv             <span class="co"># The first 'venv' is the command, the second is the name of the folder for the virtual environment.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> venv/bin/activate        <span class="co"># Activate the virtual environment.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt <span class="co"># Install dependencies from the requirements file.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>requirements.txt</code> file contains the libraries required for the project, with the key players being <code>mage-ai</code>, <code>polars</code>, and <code>duckdb</code>. Now, that we have all our dependencies ready we can start our Mage project with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mage</span> start</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will open a tab in our web browser that looks like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/mage_ui_main.png" class="img-fluid figure-img"></p>
<figcaption>Mage home UI.</figcaption>
</figure>
</div>
<p>One of Mage’s greatest strengths is its intuitive user interface. It allows us to easily create and manage data pipelines. In this example, we’ve named our pipeline <code>socrata_iowa_liquor_pipeline</code>. Once the pipeline is created, we can navigate to it using the left panel, then go to the <code>Pipelines</code> section, where our newly created pipeline will be listed, click on it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/mage_ui_left_panel.png" class="img-fluid figure-img"></p>
<figcaption>Mage home UI left panel.</figcaption>
</figure>
</div>
<p>After opening the pipeline, navigate to the Edit pipeline section in the left panel, identified by the <code>&lt;/&gt;</code> symbol. This is where we can begin constructing our pipeline. Here, you will have the option to insert a block:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/create_block.png" class="img-fluid figure-img"></p>
<figcaption>Create block options.</figcaption>
</figure>
</div>
<p>Our objective is to build the following pipeline using a series of different blocks:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/pipeline_dag.png" class="img-fluid figure-img"></p>
<figcaption>Pipeline we will implement in this projec.</figcaption>
</figure>
</div>
<p>Great! Now that our environment is set up and we’ve familiarized ourselves with Mage’s user interface, let’s take a closer look at our data source: the <a href="https://data.iowa.gov/Sales-Distribution/Iowa-Liquor-Sales/m3tr-qhgy/about_data">Iowa Liquor Sales</a> dataset. We’ll return to Mage shortly.</p>
</section>
<section id="soda-api-our-data-source" class="level2">
<h2 class="anchored" data-anchor-id="soda-api-our-data-source">SODA API: our data source</h2>
<p>The <a href="https://data.iowa.gov/Sales-Distribution/Iowa-Liquor-Sales/m3tr-qhgy/about_data">Iowa Liquor Sales data</a> is provided by the Iowa government through the Socrata Open Data API (SODA), a platform designed to grant access to open datasets from government agencies, non-profits, and other organizations. This API allows us to programmatically interact with our dataset of interest, enabling us to retrieve data via HTTP requests.</p>
<p>The <a href="https://dev.socrata.com/foundry/data.iowa.gov/m3tr-qhgy">dataset’s documentation</a> provides the key information needed to access the data: the source domain (<code>data.iowa.gov</code>) and the dataset identifier (<code>m3tr-qhgy</code>). With this information, we can define the endpoint for sending our requests. The documentation also details the available variables and their respective data types. Below is an example of a base endpoint for this dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">https://data.iowa.gov/resource/m3tr-qhgy.csv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The dataset documentation also informs us that, to date, it consists of more than 30 million rows and 24 variables. Now that we know the endpoint and the size of the data, we’re ready to pull the data, right?</p>
<p>A sensible approach would be to retrieve the data sequentially using the paging method described in the <a href="https://dev.socrata.com/docs/paging">SODA documentation</a>. This method allows us to fetch the data in manageable batches, specified by the <code>$limit</code> parameter, while navigating through the dataset using the <code>$offset</code> parameter. The process is illustrated in the following diagram:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/pagination_approach.png" class="img-fluid figure-img"></p>
<figcaption>Later rows of the data can’t be fetched due to system limits.</figcaption>
</figure>
</div>
<p>Naturally, I started with this approach to find a limitation in the API that was not documented. When we get to the point of pulling the records around row 20M, the data loader will get stuck, and no information will be pulled. This might be by design or due to system limitations in which deep paginations can bog the system<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, making this an unreliable method to get the data<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. Meaning that we will need a different strategy to retrieve the 30M records.</p>
<p>This brings us to the next strategy: using <a href="https://dev.socrata.com/docs/queries/">SoQL</a>, the query language of the Socrata API. SoQL is quite similar to SQL, with the key difference that its syntax is structured to work within a URL format.</p>
<p>We will send an HTTP request to the server to query individual batches of invoices corresponding to a specific year (based on the <code>date</code> variable). We represent this as follows.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/soql_approach.png" class="img-fluid figure-img"></p>
<figcaption>Fetching each year individually: an incremental approach. The queries in the blocks are written in SQL for readability.</figcaption>
</figure>
</div>
<p>This approach limits pagination to the number of years in the dataset rather than the total number of records. By fetching data in yearly batches, our requests won’t get stuck at an offset of 20 million, as each year contains fewer than 3 million records.</p>
<p><strong>Why are we spending so much time on this?</strong> Understanding our data source’s quirks, perks, and limitations is crucial because, ultimately, this knowledge will shape how we <strong>design</strong> our data pipeline. So it’s worth it to spend some time understanding the source system; it will save us headaches and result in a better design that is easier to maintain from the beginning.</p>
<p>Now, we have a clearer understanding of the upper stage in our stream, the data source.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/soda_done_data_lifecycle_logos.png" class="img-fluid figure-img"></p>
<figcaption>Progress we’ve made so far.</figcaption>
</figure>
</div>
<p>With this in mind, we can now move on to the ingestion step.</p>
</section>
<section id="fetching-the-data" class="level2">
<h2 class="anchored" data-anchor-id="fetching-the-data">Fetching the data</h2>
<p>We are aware of the endpoint to request the data and some limitations of this API. We know that we cannot fetch the data as it is because, at some point, our pipeline will clog, and we won’t be able to request more data from the SODA DB.</p>
<p>Due to this, we will write more complex HTTP requests using <a href="https://dev.socrata.com/docs/queries/">SoQL</a>, the SODA query language. SoQL syntax is similar to SQL, so if you are familiar with relational databases, learning will feel intuitive.</p>
<p>Our base query to fetch the data will look something like this:</p>
<p><span style="color:#008080;">https://data.iowa.gov/resource/m3tr-qhgy.csv</span>?<span style="color:#4169E1;">$where=date_extract_y(date)=2013</span>&amp;<span style="color:#FF8C00;">$limit=2000</span></p>
<ul>
<li><span style="color:#008080;"><strong>Teal:</strong></span> the endpoint for the data request.</li>
<li><span style="color:#4169E1;"><strong>Blue:</strong></span> the <code>WHERE</code> clause of the SoQL query, used to filter records for the year 2013. The function <code>date_extract_y()</code> extracts the year from the <code>date</code> column.</li>
<li><span style="color:#FF8C00;"><strong>Orange:</strong></span> the <code>LIMIT</code> clause of the SoQL query, used to limit the response to 2000 records. If we don’t indicate this, the default will be used, which is 1000 records.</li>
</ul>
<p>Notice that the <code>?</code> symbol separates the endpoint from the query parameters, and each clause is separated by an <code>&amp;</code> symbol. To indicate the start of a clause, a <code>$</code> is used.</p>
<p>This request will be sent using the <code>GET</code> HTTP method.</p>
<p>With this in mind, we can return to Mage. We’ll begin by creating the first three blocks, which will focus on retrieving metadata. The primary purpose of these blocks is to provide the downstream block with the necessary information on what data to fetch from the endpoint and how to fetch it.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this tutorial, we will adopt the writing style of <a href="https://doc.rust-lang.org/book/"><em>The Rust Programming Language</em></a> book, where the file path is shown before each code block. This approach allows you to easily follow the project’s structure. The complete code for the project is available on the <a href="https://github.com/jospablo777/mage_duckdb_pipeline">GitHub repo</a>. Also, the function docstrings have been removed from this article. However, you can review the complete technical documentation of each function by checking the files in the repo.</p>
</div>
</div>
<section id="writing-our-first-mage-blocks" class="level3">
<h3 class="anchored" data-anchor-id="writing-our-first-mage-blocks">Writing our first Mage blocks</h3>
<p>Here we will implement our first blocks, two of them will fetch metadata from the SODA API, and another one will get metadata from our local database (DuckDB). First lets go to our already created pipeline, <code>socrata_iowa_liquor_pipeline</code>. If you want to follow this tutorial from scratch, you can create a fresh pipeline (for instance, <code>socrata_iowa_liquor_pipeline_from_scratch</code>) and continue from there. With the intuitive Mage UI, it will be easy for you to create this new pipeline.</p>
<p>Our first block:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/create_block.png" class="img-fluid figure-img"></p>
<figcaption>Creating our first block.</figcaption>
</figure>
</div>
<p>Here, select the first option, <strong>Data loader</strong>, then navigate to the creation option and select Python as the language, and then API as the source, then name the block <code>get_schema_from_metadata</code>. When created, the block will come with a template like this:</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/data_loaders/get_schema_from_metadata.py"><code>data_loaders/get_schema_from_metadata.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-5"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-5-1" class="code-annotation-target"><a href="#annotated-cell-5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="annotated-cell-5-2"><a href="#annotated-cell-5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="annotated-cell-5-3"><a href="#annotated-cell-5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="annotated-cell-5-4"><a href="#annotated-cell-5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'data_loader'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="annotated-cell-5-5"><a href="#annotated-cell-5-5" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> mage_ai.data_preparation.decorators <span class="im">import</span> data_loader</span>
<span id="annotated-cell-5-6"><a href="#annotated-cell-5-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'test'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="annotated-cell-5-7"><a href="#annotated-cell-5-7" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> mage_ai.data_preparation.decorators <span class="im">import</span> test</span>
<span id="annotated-cell-5-8"><a href="#annotated-cell-5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-5-9"><a href="#annotated-cell-5-9" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-5-10" class="code-annotation-target"><a href="#annotated-cell-5-10" aria-hidden="true" tabindex="-1"></a><span class="at">@data_loader</span></span>
<span id="annotated-cell-5-11"><a href="#annotated-cell-5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data_from_api(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="annotated-cell-5-12"><a href="#annotated-cell-5-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="annotated-cell-5-13"><a href="#annotated-cell-5-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Template for loading data from API</span></span>
<span id="annotated-cell-5-14"><a href="#annotated-cell-5-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="annotated-cell-5-15"><a href="#annotated-cell-5-15" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">''</span></span>
<span id="annotated-cell-5-16"><a href="#annotated-cell-5-16" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url)</span>
<span id="annotated-cell-5-17"><a href="#annotated-cell-5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-5-18"><a href="#annotated-cell-5-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.read_csv(io.StringIO(response.text), sep<span class="op">=</span><span class="st">','</span>)</span>
<span id="annotated-cell-5-19"><a href="#annotated-cell-5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-5-20"><a href="#annotated-cell-5-20" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-5-21" class="code-annotation-target"><a href="#annotated-cell-5-21" aria-hidden="true" tabindex="-1"></a><span class="at">@test</span></span>
<span id="annotated-cell-5-22"><a href="#annotated-cell-5-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_output(output, <span class="op">*</span>args) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="annotated-cell-5-23"><a href="#annotated-cell-5-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="annotated-cell-5-24"><a href="#annotated-cell-5-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Template code for testing the output of the block.</span></span>
<span id="annotated-cell-5-25"><a href="#annotated-cell-5-25" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="annotated-cell-5-26"><a href="#annotated-cell-5-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> output <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>, <span class="st">'The output is undefined'</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="1,7" data-code-annotation="1"><strong>Imports:</strong> block’s prelude.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="10,18" data-code-annotation="2"><strong>Main functionality:</strong> since this is a data loader it has the <code>@data_loader</code> decorator on top.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="21,26" data-code-annotation="3"><strong>Test for data validation:</strong> accepts the output data of the block. If any of the tests fail, the block execution will also fail.</span>
</dd>
</dl>
</div>
</div>
<p>Mage provides a variety of templates designed to guide you and save time. These templates were incredibly helpful when we<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> first started building data pipelines. Notices the structure of a block, it is composed by three sections: library imports, a function, and a test. The function handles the main task of the block, while the test ensures that the block’s main functionality works as intended.</p>
<p>Next, we’ll modify the template to suit our specific use case. Overwrite the content of your newly created block with the following code, and let’s proceed to analyze it:</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/data_loaders/get_schema_from_metadata.py"><code>data_loaders/get_schema_from_metadata.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-6"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-6-1"><a href="#annotated-cell-6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-6-2" class="code-annotation-target"><a href="#annotated-cell-6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-6-3" class="code-annotation-target"><a href="#annotated-cell-6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="annotated-cell-6-4"><a href="#annotated-cell-6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'data_loader'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-6-5" class="code-annotation-target"><a href="#annotated-cell-6-5" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> mage_ai.data_preparation.decorators <span class="im">import</span> data_loader</span>
<span id="annotated-cell-6-6"><a href="#annotated-cell-6-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'test'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-6-7" class="code-annotation-target"><a href="#annotated-cell-6-7" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> mage_ai.data_preparation.decorators <span class="im">import</span> test</span>
<span id="annotated-cell-6-8"><a href="#annotated-cell-6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-9"><a href="#annotated-cell-6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Map API data types to Polars types</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-6-10" class="code-annotation-target"><a href="#annotated-cell-6-10" aria-hidden="true" tabindex="-1"></a>SODA_TO_POLARS <span class="op">=</span> {</span>
<span id="annotated-cell-6-11"><a href="#annotated-cell-6-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>: pl.Utf8,</span>
<span id="annotated-cell-6-12"><a href="#annotated-cell-6-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"number"</span>: pl.Float64, </span>
<span id="annotated-cell-6-13"><a href="#annotated-cell-6-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"calendar_date"</span>: pl.Datetime(<span class="st">"us"</span>),</span>
<span id="annotated-cell-6-14"><a href="#annotated-cell-6-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"floating_timestamp"</span>: pl.Datetime(<span class="st">"us"</span>),  </span>
<span id="annotated-cell-6-15"><a href="#annotated-cell-6-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-6-16"><a href="#annotated-cell-6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-17"><a href="#annotated-cell-6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-18"><a href="#annotated-cell-6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Loads the schema (i.e., types) of our data set</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-6-19" class="code-annotation-target"><a href="#annotated-cell-6-19" aria-hidden="true" tabindex="-1"></a><span class="at">@data_loader</span></span>
<span id="annotated-cell-6-20"><a href="#annotated-cell-6-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data_schema_from_api(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="annotated-cell-6-21"><a href="#annotated-cell-6-21" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-6-22" class="code-annotation-target"><a href="#annotated-cell-6-22" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">'https://</span><span class="sc">{DOMAIN}</span><span class="st">/api/views/</span><span class="sc">{DATASET_ID}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="op">**</span>kwargs)</span>
<span id="annotated-cell-6-23"><a href="#annotated-cell-6-23" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url)</span>
<span id="annotated-cell-6-24"><a href="#annotated-cell-6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-25"><a href="#annotated-cell-6-25" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> response.json()</span>
<span id="annotated-cell-6-26"><a href="#annotated-cell-6-26" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> metadata.get(<span class="st">"columns"</span>, [])</span>
<span id="annotated-cell-6-27"><a href="#annotated-cell-6-27" aria-hidden="true" tabindex="-1"></a>    schema <span class="op">=</span> {</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="8" onclick="event.preventDefault();">8</a><span id="annotated-cell-6-28" class="code-annotation-target"><a href="#annotated-cell-6-28" aria-hidden="true" tabindex="-1"></a>        col[<span class="st">"fieldName"</span>]: SODA_TO_POLARS.get(col[<span class="st">"dataTypeName"</span>], pl.Utf8)</span>
<span id="annotated-cell-6-29"><a href="#annotated-cell-6-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> columns</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="9" onclick="event.preventDefault();">9</a><span id="annotated-cell-6-30" class="code-annotation-target"><a href="#annotated-cell-6-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> col[<span class="st">"fieldName"</span>].startswith(<span class="st">":@computed_"</span>)</span>
<span id="annotated-cell-6-31"><a href="#annotated-cell-6-31" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="annotated-cell-6-32"><a href="#annotated-cell-6-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-6-33"><a href="#annotated-cell-6-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> schema</span>
<span id="annotated-cell-6-34"><a href="#annotated-cell-6-34" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="10" onclick="event.preventDefault();">10</a><span id="annotated-cell-6-35" class="code-annotation-target"><a href="#annotated-cell-6-35" aria-hidden="true" tabindex="-1"></a><span class="at">@test</span></span>
<span id="annotated-cell-6-36"><a href="#annotated-cell-6-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_output(dictionary, <span class="op">*</span>args) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="annotated-cell-6-37"><a href="#annotated-cell-6-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> dictionary <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>, <span class="st">"The output is undefined"</span></span>
<span id="annotated-cell-6-38"><a href="#annotated-cell-6-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">isinstance</span>(dictionary, <span class="bu">dict</span>), <span class="st">"The output is not a dictionary"</span></span>
<span id="annotated-cell-6-39"><a href="#annotated-cell-6-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">len</span>(dictionary) <span class="op">&gt;</span> <span class="dv">0</span>, <span class="st">"The dictionary is empty"</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="2" data-code-annotation="1"><strong>Polars:</strong> used for data manipulation and type mapping throughout the project.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="3" data-code-annotation="2"><strong>HTTP library:</strong> <code>requests</code> is used to send HTTP requests to the API.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="5" data-code-annotation="3"><strong>Loader decorator:</strong> the <code>@data_loader</code> decorator marks the function as a Mage data loader block.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="7" data-code-annotation="4"><strong>Test decorator:</strong> the <code>@test</code> decorator defines a test function for validating the output.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="10,15" data-code-annotation="5"><strong>Socrata to Polars type mapping:</strong> the <code>SODA_TO_POLARS</code> dictionary maps Socrata data types to corresponding Polars types, ensuring compatibility.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="19" data-code-annotation="6"><strong>Function decoration:</strong> the loader function <code>load_data_schema_from_api</code> is decorated with <code>@data_loader</code> to integrate it into the Mage pipeline. It is important to include the decorator to power the function we define with Mage functionalities.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="22" data-code-annotation="7"><strong>Endpoint definition:</strong> the endpoint URL is dynamically generated using the global variables <code>DOMAIN</code> and <code>DATASET_ID</code>. This is where the schema metadata is fetched.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="28" data-code-annotation="8"><strong>Dictionary comprehension:</strong> the <code>schema</code> dictionary maps column names to their corresponding Polars types, based on the <code>SODA_TO_POLARS</code> dictionary. Unrecognized types default to <code>Utf8</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="30" data-code-annotation="9"><strong>Exclusion columns:</strong> columns with names starting with <code>:@computed_</code> are excluded from the schema.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="10">10</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="35,39" data-code-annotation="10"><strong>Test function:</strong> the test validates the loader’s output, ensuring it is a non-empty dictionary of the correct type. Remember to include the <code>@test</code> decorator so the test works as Mage intended.</span>
</dd>
</dl>
</div>
</div>
<p>The primary goal of the <code>get_schema_from_metadata</code> block is to retrieve data type information to standardize batch ingestion. While Polars can infer data types based on the content it reads, each batch may differ in structure. This inconsistency can lead to errors and prevent us from merging batches later. We can resolve this issue by specifying data types and ensuring a consistent schema across all batches.</p>
<p>Please notice that we use Polars for data transformation and manipulation. Compared with Pandas, Polars offers better performance and scalability, making it a more cost-effective choice for production systems. This <a href="https://pola.rs/posts/case-check-technology/">case study</a> demonstrates that Polars can reduce computational costs, making it a good choice for projects that may eventually transition to production. Polars is a mature and robust library with extensive capabilities, making it an excellent choice for this project.</p>
<p>We can illustrate how the Mage flow operates using our first block. Initially, the block performs its main task—fetching data from an API in this example. The instructions for this task are defined in the block’s primary function, which is identified by the <code>@data_loader</code> decorator. Once the main task is completed, its output is passed to the tests, marked with the <code>@test</code> decorator. If all tests are successful, the output is forwarded to the next block in the stream.</p>
<p>When you first looked at <a href="#fig-concrete-project-outline" class="quarto-xref">Named figure&nbsp;1</a>, you might have wondered why storage spans the entire process and why Apache Arrow and Parquet are included in the storage block alongside DuckDB. This is because data storage underpins every major stage, with data being stored multiple times throughout its life cycle. Mage uses PyArrow to handle data serialization and deserialization between blocks during these storage steps<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>. For disk storage, PyArrow serializes the data into the Parquet format. For more details, you can check Mage’s <a href="https://docs.mage.ai/guides/blocks/polars">documentation</a>.</p>
<p>Below is an overview of how Mage blocks function:</p>
<div id="fig-mage-blocks-working" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mage-blocks-working-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/mage_blocks_function.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mage-blocks-working-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Named figure&nbsp;2: Overview of Mage blocks functioning.
</figcaption>
</figure>
</div>
<p>Congrats! You just implemented your first Mage block. Let’s test it, you can do this with the “play” icon in the header of the block:</p>
<p><img src="img/testing_mage_block.png" class="img-fluid"></p>
<p>After the block runs, you should be able to see the output in the tail of the block:</p>
<p><img src="img/testing_mage_block_2.png" class="img-fluid"></p>
<p>We see a message indicating that the test passed and how Mage tries to display the output dictionary.</p>
<p>Next, we will query the number of records (invoices) per year. To achieve this, we will create a data loader block named <code>soda_records_per_year.</code> The content of this block will look as follows:</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/data_loaders/soda_records_per_year.py"><code>data_loaders/soda_records_per_year.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-7-1" class="code-annotation-target"><a href="#annotated-cell-7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="annotated-cell-7-3"><a href="#annotated-cell-7-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="annotated-cell-7-4"><a href="#annotated-cell-7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'data_loader'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> mage_ai.data_preparation.decorators <span class="im">import</span> data_loader</span>
<span id="annotated-cell-7-6"><a href="#annotated-cell-7-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'test'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="annotated-cell-7-7"><a href="#annotated-cell-7-7" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> mage_ai.data_preparation.decorators <span class="im">import</span> test</span>
<span id="annotated-cell-7-8"><a href="#annotated-cell-7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-7-9"><a href="#annotated-cell-7-9" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-7-10" class="code-annotation-target"><a href="#annotated-cell-7-10" aria-hidden="true" tabindex="-1"></a><span class="at">@data_loader</span></span>
<span id="annotated-cell-7-11"><a href="#annotated-cell-7-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data_from_api(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="annotated-cell-7-12"><a href="#annotated-cell-7-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># SoQL to get the the number of invoices per year</span></span>
<span id="annotated-cell-7-13"><a href="#annotated-cell-7-13" aria-hidden="true" tabindex="-1"></a>    data_url <span class="op">=</span> <span class="st">"https://data.iowa.gov/resource/m3tr-qhgy.csv?$select=date_extract_y(date) AS year, count(invoice_line_no) AS rows&amp;$group=date_extract_y(date)"</span></span>
<span id="annotated-cell-7-14"><a href="#annotated-cell-7-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="annotated-cell-7-15"><a href="#annotated-cell-7-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Fetching the records-per-year metadata. This might take a couple minutes.."</span>)</span>
<span id="annotated-cell-7-16"><a href="#annotated-cell-7-16" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(data_url)</span>
<span id="annotated-cell-7-17"><a href="#annotated-cell-7-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Done! We have our year record metadata.</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="annotated-cell-7-18"><a href="#annotated-cell-7-18" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> pl.read_csv(io.StringIO(response.text))</span>
<span id="annotated-cell-7-19"><a href="#annotated-cell-7-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-7-20"><a href="#annotated-cell-7-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span>
<span id="annotated-cell-7-21"><a href="#annotated-cell-7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-7-22"><a href="#annotated-cell-7-22" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-7-23" class="code-annotation-target"><a href="#annotated-cell-7-23" aria-hidden="true" tabindex="-1"></a><span class="at">@test</span></span>
<span id="annotated-cell-7-24"><a href="#annotated-cell-7-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_output(output, <span class="op">*</span>args) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="annotated-cell-7-25"><a href="#annotated-cell-7-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> output <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>, <span class="st">'The output is undefined'</span></span>
<span id="annotated-cell-7-26"><a href="#annotated-cell-7-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">isinstance</span>(output, pl.DataFrame), <span class="st">'The output is not a Polars DataFrame'</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="1" data-code-annotation="1">You might have noticed that we use the <code>io</code> module to handle the API responses. Specifically, we utilize the <code>StringIO()</code> class to treat the response as a document. Otherwise, Polars will complain.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="10,20" data-code-annotation="2">Here, we make a SoQL query to the API, and load the response into a Polars data frame.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="23,26" data-code-annotation="3">We also validate that the block’s output is not empty and confirm that it is a Polars data frame.</span>
</dd>
</dl>
</div>
</div>
<p>In this block we request the records per year to the API, for this we make use of the SoQL language provided by the API developers:</p>
<p><span style="color:#008080;">https://data.iowa.gov/resource/m3tr-qhgy.csv</span>?<span style="color:#4169E1;">$select=date_extract_y(date) AS year, count(invoice_line_no) AS rows&amp;$group=date_extract_y(date)</span></p>
<p>And again, we can dissect this request:</p>
<ul>
<li><span style="color:#008080;"><strong>Teal:</strong></span> endpoint.</li>
<li><span style="color:#4169E1;"><strong>Blue:</strong></span> query.</li>
</ul>
<p>If we translate this query to SQL, we would have something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="dt">YEAR</span>(<span class="dt">date</span>) <span class="kw">AS</span> <span class="dt">year</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">COUNT</span>(invoice_line_no) <span class="kw">AS</span> <span class="kw">rows</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> m3tr<span class="op">-</span>qhgy <span class="co">-- Iowa Liquor Sales table</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="dt">YEAR</span>(<span class="dt">date</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output should be a table displaying the number of records for each year. This information will be used to determine the <code>$limit</code> clause when retrieving data later.</p>
<p>To complete the upstream blocks, we will create another block to check the data available in our local DuckDB database. I named this block <code>check_local_db</code>. It is of type “custom,” though it could also have been implemented as a data loader.</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/custom/check_local_db.py"><code>custom/check_local_db.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-9"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-9-1"><a href="#annotated-cell-9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span>
<span id="annotated-cell-9-2"><a href="#annotated-cell-9-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-9-3" class="code-annotation-target"><a href="#annotated-cell-9-3" aria-hidden="true" tabindex="-1"></a>db_path <span class="op">=</span> <span class="st">'data/iowa_liquor.duckdb'</span></span>
<span id="annotated-cell-9-4"><a href="#annotated-cell-9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-5"><a href="#annotated-cell-9-5" aria-hidden="true" tabindex="-1"></a><span class="at">@custom</span></span>
<span id="annotated-cell-9-6"><a href="#annotated-cell-9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_last_year(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-9-7" class="code-annotation-target"><a href="#annotated-cell-9-7" aria-hidden="true" tabindex="-1"></a>    conn <span class="op">=</span> duckdb.<span class="ex">connect</span>(<span class="st">"data/iowa_liquor.duckdb"</span>)</span>
<span id="annotated-cell-9-8"><a href="#annotated-cell-9-8" aria-hidden="true" tabindex="-1"></a>    </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-9-9" class="code-annotation-target"><a href="#annotated-cell-9-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="annotated-cell-9-10"><a href="#annotated-cell-9-10" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> conn.execute(<span class="st">"""</span></span>
<span id="annotated-cell-9-11"><a href="#annotated-cell-9-11" aria-hidden="true" tabindex="-1"></a><span class="st">        SELECT EXTRACT(YEAR FROM MAX(date)) FROM iowa_liquor_sales</span></span>
<span id="annotated-cell-9-12"><a href="#annotated-cell-9-12" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span>).fetchall()</span>
<span id="annotated-cell-9-13"><a href="#annotated-cell-9-13" aria-hidden="true" tabindex="-1"></a>        last_year <span class="op">=</span> result[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="annotated-cell-9-14"><a href="#annotated-cell-9-14" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-9-15" class="code-annotation-target"><a href="#annotated-cell-9-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> duckdb.CatalogException <span class="im">as</span> e:</span>
<span id="annotated-cell-9-16"><a href="#annotated-cell-9-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"The table doesn't exist; assigning rows_in_db=0"</span>)</span>
<span id="annotated-cell-9-17"><a href="#annotated-cell-9-17" aria-hidden="true" tabindex="-1"></a>        last_year <span class="op">=</span> <span class="dv">0</span></span>
<span id="annotated-cell-9-18"><a href="#annotated-cell-9-18" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-9-19" class="code-annotation-target"><a href="#annotated-cell-9-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="annotated-cell-9-20"><a href="#annotated-cell-9-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"An unexpected error occurred: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="annotated-cell-9-21"><a href="#annotated-cell-9-21" aria-hidden="true" tabindex="-1"></a>        last_year <span class="op">=</span> <span class="dv">0</span></span>
<span id="annotated-cell-9-22"><a href="#annotated-cell-9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-23"><a href="#annotated-cell-9-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Close DB connections</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-9-24" class="code-annotation-target"><a href="#annotated-cell-9-24" aria-hidden="true" tabindex="-1"></a>    conn.close()</span>
<span id="annotated-cell-9-25"><a href="#annotated-cell-9-25" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-9-26" class="code-annotation-target"><a href="#annotated-cell-9-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> last_year</span>
<span id="annotated-cell-9-27"><a href="#annotated-cell-9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-28"><a href="#annotated-cell-9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-9" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="3" data-code-annotation="1">Define the path to the database. For this project, the database will be stored in the file <code>data/iowa_liquor.duckdb</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="7" data-code-annotation="2">Establish a connection to the local database. If the file <code>iowa_liquor.duckdb</code> does not exist, DuckDB will automatically create it.</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="9,13" data-code-annotation="3">Query the date of the most recent invoice in the database and extract the year. Use <code>.fetchall()</code> to retrieve the query output as a Python object<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>.</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="15,17" data-code-annotation="4">If the table does not yet exist in the database, return <code>0</code> as the year.</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="19,21" data-code-annotation="5">If any other exception occurs, also return <code>0</code> as the year.</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="24" data-code-annotation="6">Explicitly close the database connection to avoid blocking access for downstream processes.</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="26" data-code-annotation="7">Return the most recent year as an <code>int</code>.</span>
</dd>
</dl>
</div>
</div>
<p>This block is designed to monitor the local database, enabling efficient updates by avoiding the need to fetch all data every time. This approach ensures faster processing and reduces resource consumption.</p>
<p>With that, we’ve completed the first layer of Mage blocks. The next step downstream involves retrieving the data of interest. In this stage, we will use the outputs of the three blocks we just created</p>
</section>
<section id="pulling-the-iowa-liquor-sales-data" class="level3">
<h3 class="anchored" data-anchor-id="pulling-the-iowa-liquor-sales-data">Pulling the Iowa Liquor Sales data</h3>
<p>With the metadata in place, we can now retrieve the sales data of interest by creating the <code>pull_data_from_socrata</code> block. Once this loader block is created, connect the upstream blocks to it in the following order:</p>
<ol type="1">
<li><code>get_schema_from_metadata</code></li>
<li><code>soda_records_per_year</code></li>
<li><code>check_local_db</code></li>
</ol>
<p>You can make this configuration in the “Tree” panel to the right of your Mage code editor:</p>
<p><img src="img/mage_code_editor_tree.png" class="img-fluid"></p>
<p>The final configuration should look like this:</p>
<p><img src="img/upstream_to_pull_data_from_socrata.png" class="img-fluid"></p>
<p>This will ensure the parameter order remains consistent for you as well. While we know this block will utilize data from the three upstream blocks, how do we access this data in our code? The answer lies in the header of our new block, which contains all the information we need:</p>
<p><img src="img/pull_data_from_socrata_header.png" class="img-fluid"></p>
<p>In this header, we receive all the necessary information to consume the upstream data. It includes an example showing the parameter order and how they correspond to each upstream block. The loader function, identified by the <code>@data_loader</code> decorator, provides a clear structure.</p>
<p>The parameter names (<code>data</code>, <code>data_2</code>, <code>data_3</code>) are arbitrary, allowing you to choose names that best suit your function. However, what matters most is the <strong>positional order</strong> of the parameters. Specifically:</p>
<ul>
<li>The first parameter corresponds to the output of <code>get_schema_from_metadata</code>.</li>
<li>The second parameter corresponds to <code>soda_records_per_year</code>.</li>
<li>The third parameter corresponds to <code>check_local_db</code>.</li>
</ul>
<p>With this in mind, we can proceed to define the content of this block. Since there is a lot to cover, we’ll break it down into three sections: the imports, the loader function, and the tests. Let’s start with the dependencies for this block:</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/data_loaders/pull_data_from_socrata.py"><code>data_loaders/pull_data_from_socrata.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-10-1"><a href="#annotated-cell-10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="annotated-cell-10-2"><a href="#annotated-cell-10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="annotated-cell-10-3"><a href="#annotated-cell-10-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-10-4" class="code-annotation-target"><a href="#annotated-cell-10-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> ceil</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-10-5" class="code-annotation-target"><a href="#annotated-cell-10-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> concurrent.futures <span class="im">import</span> ThreadPoolExecutor, as_completed</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-10-6" class="code-annotation-target"><a href="#annotated-cell-10-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="annotated-cell-10-7"><a href="#annotated-cell-10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-10-8"><a href="#annotated-cell-10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="4" data-code-annotation="1">Round numbers to the nearest ceiling.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="5" data-code-annotation="2">We will implement a multithreading approach to speed up the data retrieval process.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="6" data-code-annotation="3">A progress bar. Provides real-time feedback on the data-pulling progress, which besides of being helpful for the user, it’s also supportive for debugging purposes.</span>
</dd>
</dl>
</div>
</div>
<p>Nothing weird in the imports. Now, let’s review the most complex part of our implementation, the loader function:</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/data_loaders/pull_data_from_socrata.py"><code>data_loaders/pull_data_from_socrata.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-11"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-11-1"><a href="#annotated-cell-11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span>
<span id="annotated-cell-11-2"><a href="#annotated-cell-11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-3"><a href="#annotated-cell-11-3" aria-hidden="true" tabindex="-1"></a><span class="at">@data_loader</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-11-4" class="code-annotation-target"><a href="#annotated-cell-11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data_from_api(schema,</span>
<span id="annotated-cell-11-5"><a href="#annotated-cell-11-5" aria-hidden="true" tabindex="-1"></a>                       records_per_year,</span>
<span id="annotated-cell-11-6"><a href="#annotated-cell-11-6" aria-hidden="true" tabindex="-1"></a>                       last_year_in_local_db,</span>
<span id="annotated-cell-11-7"><a href="#annotated-cell-11-7" aria-hidden="true" tabindex="-1"></a>                       <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="annotated-cell-11-8"><a href="#annotated-cell-11-8" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-11-9" class="code-annotation-target"><a href="#annotated-cell-11-9" aria-hidden="true" tabindex="-1"></a>    DOMAIN     <span class="op">=</span> <span class="st">'data.iowa.gov'</span></span>
<span id="annotated-cell-11-10"><a href="#annotated-cell-11-10" aria-hidden="true" tabindex="-1"></a>    DATASET_ID <span class="op">=</span> <span class="st">'m3tr-qhgy'</span></span>
<span id="annotated-cell-11-11"><a href="#annotated-cell-11-11" aria-hidden="true" tabindex="-1"></a>    base_url   <span class="op">=</span> <span class="ss">f"https://</span><span class="sc">{</span>DOMAIN<span class="sc">}</span><span class="ss">/resource/</span><span class="sc">{</span>DATASET_ID<span class="sc">}</span><span class="ss">.csv?"</span></span>
<span id="annotated-cell-11-12"><a href="#annotated-cell-11-12" aria-hidden="true" tabindex="-1"></a>    query_url  <span class="op">=</span> <span class="st">"$where=date_extract_y(date)=</span><span class="sc">{}</span><span class="st">&amp;$limit=</span><span class="sc">{}</span><span class="st">"</span></span>
<span id="annotated-cell-11-13"><a href="#annotated-cell-11-13" aria-hidden="true" tabindex="-1"></a>    records_per_year <span class="op">=</span> records_per_year.with_columns(</span>
<span id="annotated-cell-11-14"><a href="#annotated-cell-11-14" aria-hidden="true" tabindex="-1"></a>    pl.<span class="bu">format</span>(base_url <span class="op">+</span> query_url, pl.col(<span class="st">"year"</span>), pl.col(<span class="st">"rows"</span>)).alias(<span class="st">"url"</span>)</span>
<span id="annotated-cell-11-15"><a href="#annotated-cell-11-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="annotated-cell-11-16"><a href="#annotated-cell-11-16" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-11-17" class="code-annotation-target"><a href="#annotated-cell-11-17" aria-hidden="true" tabindex="-1"></a>    records_per_year <span class="op">=</span> records_per_year.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">&gt;=</span> last_year_in_local_db)</span>
<span id="annotated-cell-11-18"><a href="#annotated-cell-11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-19"><a href="#annotated-cell-11-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (last_year_in_local_db <span class="op">!=</span> records_per_year[<span class="st">"year"</span>].<span class="bu">max</span>()) <span class="op">&amp;</span> last_year_in_local_db <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="annotated-cell-11-20"><a href="#annotated-cell-11-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We're limiting to five years per job so our machine dont explode</span></span>
<span id="annotated-cell-11-21"><a href="#annotated-cell-11-21" aria-hidden="true" tabindex="-1"></a>        records_per_year <span class="op">=</span> records_per_year.sort(<span class="st">"year"</span>).head(<span class="dv">6</span>)</span>
<span id="annotated-cell-11-22"><a href="#annotated-cell-11-22" aria-hidden="true" tabindex="-1"></a>        records_per_year <span class="op">=</span> records_per_year.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">!=</span> last_year_in_local_db)</span>
<span id="annotated-cell-11-23"><a href="#annotated-cell-11-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-11-24"><a href="#annotated-cell-11-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We're limiting to five years per job so our machine dont explode</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-11-25" class="code-annotation-target"><a href="#annotated-cell-11-25" aria-hidden="true" tabindex="-1"></a>    records_per_year <span class="op">=</span> records_per_year.sort(<span class="st">"year"</span>).head(<span class="dv">5</span>)</span>
<span id="annotated-cell-11-26"><a href="#annotated-cell-11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-27"><a href="#annotated-cell-11-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Years we will request to the API</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-11-28" class="code-annotation-target"><a href="#annotated-cell-11-28" aria-hidden="true" tabindex="-1"></a>    requests_list <span class="op">=</span> records_per_year[<span class="st">"url"</span>].to_list()</span>
<span id="annotated-cell-11-29"><a href="#annotated-cell-11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-30"><a href="#annotated-cell-11-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"SODA data pull started."</span>)</span>
<span id="annotated-cell-11-31"><a href="#annotated-cell-11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-32"><a href="#annotated-cell-11-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Report to the user which years we will be working with</span></span>
<span id="annotated-cell-11-33"><a href="#annotated-cell-11-33" aria-hidden="true" tabindex="-1"></a>    years_to_fetch <span class="op">=</span> records_per_year[<span class="st">"year"</span>].to_list()</span>
<span id="annotated-cell-11-34"><a href="#annotated-cell-11-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Years to be fetched: </span><span class="sc">{}</span><span class="st">."</span>.<span class="bu">format</span>(<span class="st">", "</span>.join(<span class="bu">map</span>(<span class="bu">str</span>, years_to_fetch))))</span>
<span id="annotated-cell-11-35"><a href="#annotated-cell-11-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-11-36"><a href="#annotated-cell-11-36" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-11" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="4,5,6" data-code-annotation="1"><strong>Parameter order:</strong> remember, the order of the parameters matters, but you can name them however you like.</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="9,15" data-code-annotation="2"><strong>Customizing API requests:</strong> The <code>records_per_year</code> data frame is used to construct the URLs for API requests. It customizes the SoQL query for each year, with a unique <code>$limit</code> value tailored to the data volume for that year.</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="17,22" data-code-annotation="3"><strong>Excluding existing data:</strong> an additional filter ensures that years already present in the local database are excluded from the requests.</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="25" data-code-annotation="4"><strong>Data pull limit:</strong> to prevent overloading your machine, we limit data pulls to a maximum of five years per run. Adjust this limit based on your system’s capacity.</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="28" data-code-annotation="5"><strong>URL list:</strong> after filtering, the formatted URLs are collected into a list, which will be used later for parallel data fetching.</span>
</dd>
</dl>
</div>
</div>
<p>Up to this point, the process has been straightforward. We simply used some upstream data (<code>records_per_year</code>) to format the URLs needed for API requests, applying a few Polars transformations for text formatting. Lets continue reviewing the concurrent fetch of the data.</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/data_loaders/pull_data_from_socrata.py"><code>data_loaders/pull_data_from_socrata.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-12-1"><a href="#annotated-cell-12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span>
<span id="annotated-cell-12-2"><a href="#annotated-cell-12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-3"><a href="#annotated-cell-12-3" aria-hidden="true" tabindex="-1"></a><span class="at">@data_loader</span></span>
<span id="annotated-cell-12-4"><a href="#annotated-cell-12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data_from_api(schema,</span>
<span id="annotated-cell-12-5"><a href="#annotated-cell-12-5" aria-hidden="true" tabindex="-1"></a>                       records_per_year,</span>
<span id="annotated-cell-12-6"><a href="#annotated-cell-12-6" aria-hidden="true" tabindex="-1"></a>                       last_year_in_local_db,</span>
<span id="annotated-cell-12-7"><a href="#annotated-cell-12-7" aria-hidden="true" tabindex="-1"></a>                       <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="annotated-cell-12-8"><a href="#annotated-cell-12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-9"><a href="#annotated-cell-12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span>
<span id="annotated-cell-12-10"><a href="#annotated-cell-12-10" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-12-11" class="code-annotation-target"><a href="#annotated-cell-12-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fetch_batch(data_url):</span>
<span id="annotated-cell-12-12"><a href="#annotated-cell-12-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Fetch data for a given URL."""</span></span>
<span id="annotated-cell-12-13"><a href="#annotated-cell-12-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="annotated-cell-12-14"><a href="#annotated-cell-12-14" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> requests.get(data_url)</span>
<span id="annotated-cell-12-15"><a href="#annotated-cell-12-15" aria-hidden="true" tabindex="-1"></a>            response.raise_for_status()  <span class="co"># Raise an error for bad responses</span></span>
<span id="annotated-cell-12-16"><a href="#annotated-cell-12-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> pl.read_csv(io.StringIO(response.text), schema <span class="op">=</span> schema)</span>
<span id="annotated-cell-12-17"><a href="#annotated-cell-12-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="annotated-cell-12-18"><a href="#annotated-cell-12-18" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error fetching data from </span><span class="sc">{</span>data_url<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="annotated-cell-12-19"><a href="#annotated-cell-12-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> pl.DataFrame(schema <span class="op">=</span> schema)</span>
<span id="annotated-cell-12-20"><a href="#annotated-cell-12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-21"><a href="#annotated-cell-12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use ThreadPoolExecutor for concurrent API calls</span></span>
<span id="annotated-cell-12-22"><a href="#annotated-cell-12-22" aria-hidden="true" tabindex="-1"></a>    df_list <span class="op">=</span> []</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-12-23" class="code-annotation-target"><a href="#annotated-cell-12-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> ThreadPoolExecutor(max_workers <span class="op">=</span> <span class="dv">3</span>) <span class="im">as</span> executor:</span>
<span id="annotated-cell-12-24"><a href="#annotated-cell-12-24" aria-hidden="true" tabindex="-1"></a>        </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-12-25" class="code-annotation-target"><a href="#annotated-cell-12-25" aria-hidden="true" tabindex="-1"></a>        futures <span class="op">=</span> {executor.submit(fetch_batch, url): url <span class="cf">for</span> url <span class="kw">in</span> requests_list}</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-12-26" class="code-annotation-target"><a href="#annotated-cell-12-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> future <span class="kw">in</span> tqdm(as_completed(futures), total<span class="op">=</span><span class="bu">len</span>(futures), desc<span class="op">=</span><span class="st">"Fetching data"</span>):</span>
<span id="annotated-cell-12-27"><a href="#annotated-cell-12-27" aria-hidden="true" tabindex="-1"></a>            url <span class="op">=</span> futures[future]</span>
<span id="annotated-cell-12-28"><a href="#annotated-cell-12-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-12-29" class="code-annotation-target"><a href="#annotated-cell-12-29" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> future.result()</span>
<span id="annotated-cell-12-30"><a href="#annotated-cell-12-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> data.is_empty():</span>
<span id="annotated-cell-12-31"><a href="#annotated-cell-12-31" aria-hidden="true" tabindex="-1"></a>                    df_list.append(data)</span>
<span id="annotated-cell-12-32"><a href="#annotated-cell-12-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="annotated-cell-12-33"><a href="#annotated-cell-12-33" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Error processing URL </span><span class="sc">{</span>url<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="annotated-cell-12-34"><a href="#annotated-cell-12-34" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-12-35" class="code-annotation-target"><a href="#annotated-cell-12-35" aria-hidden="true" tabindex="-1"></a>    all_pulled_data <span class="op">=</span> pl.concat(df_list, how<span class="op">=</span><span class="st">"vertical"</span>)</span>
<span id="annotated-cell-12-36"><a href="#annotated-cell-12-36" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-12-37" class="code-annotation-target"><a href="#annotated-cell-12-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> all_pulled_data</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="11,19" data-code-annotation="1">First we have to define a function that will handle the requests. It receives an URL, makes the <code>GET</code> request, and returns a Polars data frame with the data. In case there is an error in our request, it also handles that.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="23" data-code-annotation="2">Initializes a thread pool with a maximum of three workers (<code>max_workers = 3</code>), allowing up to three API requests to be executed concurrently. This will help to speed up the data retrieval. The <code>with</code> statement is used for context management, ensuring the thread pool is properly shut down once all threads have completed their work.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="25" data-code-annotation="3">Here, we submit tasks to the thread pool. A dictionary is created using comprehension. The <code>executor.submit(...)</code> method schedules the <code>fetch_batch</code> function to run in a separate thread with <code>url</code> as its argument, returning a <code>Future</code> object. The resulting <code>futures</code> dictionary maps these Future objects to their corresponding URLs.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="26" data-code-annotation="4">To monitor progress, the code iterates over the <code>Future</code> objects as they complete (using <code>as_completed</code>) and tracks progress with <code>tqdm</code>, providing real-time feedback to the user.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="29" data-code-annotation="5">Retrieves the results, for each completed task, <code>future.result()</code> is called to retrieve the result of the <code>fetch_batch</code> function. This method waits for the task to finish and returns the resulting Polars data frame.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="35" data-code-annotation="6">All data frames are merged into a single one.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="37" data-code-annotation="7">Finally, the merged data frame containing all the requested data is returned.</span>
</dd>
</dl>
</div>
</div>
<p>So, this function utilizes <code>ThreadPoolExecutor</code> to submit API requests for all the URLs in <code>requests_list</code>. Tasks are executed in parallel based on the number of workers specified. Progress is monitored using <code>tqdm,</code> which updates the progress bar in real-time. The result (a Polars data frame) is retrieved and validated for each completed task. Once all tasks are complete, the individual data frames are merged into a single one, which is then returned. The process is illustrated in the following chart.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/asynchronous_fetch.png" class="img-fluid figure-img"></p>
<figcaption>Asynchronous data fetching</figcaption>
</figure>
</div>
</section>
<section id="testing" class="level3">
<h3 class="anchored" data-anchor-id="testing">Testing</h3>
<p>With the main functionality complete, ensuring that the loader runs reliably is essential, and equally important, to run automatic tests after making adjustments to the code<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>. To achieve this, we write tests to verify its behavior. Additionally, to maintain the best data quality in our pipeline, these tests also focus on ensuring the integrity and consistency of the data.</p>
<p>Let’s review the final part of our block, which consists of three tests. These tests are designed to validate certain expectations of the data, such as ensuring no null values in specific columns, and to verify the overall integrity of the data.</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/data_loaders/pull_data_from_socrata.py"><code>data_loaders/pull_data_from_socrata.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-13"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-13-1"><a href="#annotated-cell-13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span>
<span id="annotated-cell-13-2"><a href="#annotated-cell-13-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-13-3" class="code-annotation-target"><a href="#annotated-cell-13-3" aria-hidden="true" tabindex="-1"></a><span class="at">@test</span></span>
<span id="annotated-cell-13-4"><a href="#annotated-cell-13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_output(output, <span class="op">*</span>args) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="annotated-cell-13-5"><a href="#annotated-cell-13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="annotated-cell-13-6"><a href="#annotated-cell-13-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Validates the output of data pulling block.</span></span>
<span id="annotated-cell-13-7"><a href="#annotated-cell-13-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="annotated-cell-13-8"><a href="#annotated-cell-13-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> output <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>, <span class="st">'The output is undefined'</span></span>
<span id="annotated-cell-13-9"><a href="#annotated-cell-13-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">isinstance</span>(output, pl.DataFrame), <span class="st">"The output is not a Polars data frame"</span></span>
<span id="annotated-cell-13-10"><a href="#annotated-cell-13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">len</span>(output) <span class="op">&gt;</span> <span class="dv">0</span>, <span class="st">"The data frame is empty"</span></span>
<span id="annotated-cell-13-11"><a href="#annotated-cell-13-11" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-13-12" class="code-annotation-target"><a href="#annotated-cell-13-12" aria-hidden="true" tabindex="-1"></a><span class="at">@test</span></span>
<span id="annotated-cell-13-13"><a href="#annotated-cell-13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_invoice_line_no_not_null_output(output, <span class="op">*</span>args) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="annotated-cell-13-14"><a href="#annotated-cell-13-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="annotated-cell-13-15"><a href="#annotated-cell-13-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Test the new invoice_line_no column contains no nulls.</span></span>
<span id="annotated-cell-13-16"><a href="#annotated-cell-13-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="annotated-cell-13-17"><a href="#annotated-cell-13-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> output[<span class="st">"invoice_line_no"</span>].is_null().<span class="bu">sum</span>() <span class="op">==</span> <span class="dv">0</span>, <span class="st">"The invoice_line_no column contains null values, it shouldn't"</span></span>
<span id="annotated-cell-13-18"><a href="#annotated-cell-13-18" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-13-19" class="code-annotation-target"><a href="#annotated-cell-13-19" aria-hidden="true" tabindex="-1"></a><span class="at">@test</span></span>
<span id="annotated-cell-13-20"><a href="#annotated-cell-13-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_date_not_null_output(output, <span class="op">*</span>args) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="annotated-cell-13-21"><a href="#annotated-cell-13-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="annotated-cell-13-22"><a href="#annotated-cell-13-22" aria-hidden="true" tabindex="-1"></a><span class="co">    Test the new date column contains no nulls.</span></span>
<span id="annotated-cell-13-23"><a href="#annotated-cell-13-23" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="annotated-cell-13-24"><a href="#annotated-cell-13-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> output[<span class="st">"date"</span>].is_null().<span class="bu">sum</span>() <span class="op">==</span> <span class="dv">0</span>, <span class="st">"The date column contain null values, it shouldn't"</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="3,10" data-code-annotation="1">Verify that the output is a non-empty Polars data frame containing valid content.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="12,17" data-code-annotation="2">Ensure that the <code>invoice_line_no</code> column contains no null values.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="19,24" data-code-annotation="3">Confirm that the <code>date</code> column contains no null values.</span>
</dd>
</dl>
</div>
</div>
<p>When writing tests for your blocks, always include the <code>@test</code> decorator. This informs Mage to treat the functions as tests. In these examples, we verified the basic integrity of the resulting data frame and enforced specific rules for two columns. If everything went smoothly, you should see a confirmation message for each test that passed after running the block.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/ingestion_done_data_lifecycle_logos.png" class="img-fluid figure-img"></p>
<figcaption>Progress we’ve made so far.</figcaption>
</figure>
</div>
<p>And we just finished implementing the data ingestion part of our pipeline! :D</p>
</section>
</section>
<section id="transform-the-data" class="level2">
<h2 class="anchored" data-anchor-id="transform-the-data">Transform the data</h2>
<p>With the retrieved data in hand, we now focus on transforming it. As illustrated in <a href="#fig-mage-blocks-working" class="quarto-xref">Named figure&nbsp;2</a>, after fetching the data and running the tests, the block serializes the data to pass it downstream. The next step is to implement these downstream blocks to transform the data and generate new variables.</p>
<section id="have-present-the-bussiness-logic" class="level3">
<h3 class="anchored" data-anchor-id="have-present-the-bussiness-logic">Have present the bussiness logic</h3>
<p>The dataset offers a wealth of information, such as product descriptions and geolocation points, providing ample opportunities for deeper insights and analysis. To enhance this further, we will create new variables that reveal additional business insights, enabling us to answer more interesting questions. We’ve organized the transformations into the following business-logic blocks:</p>
<ol type="1">
<li><code>product_transformations</code>: generates general product descriptions, such as liquor type or packaging size.</li>
<li><code>sales_and_price_related_metrics</code>: creates variables like profits and costs.</li>
<li><code>volume_based_features</code>: develops features related to the liquid volume (Liters) of sales.</li>
<li><code>time_based_features</code>: generates temporal variables for time-based analysis.</li>
</ol>
</section>
<section id="lets-transform-our-data" class="level3">
<h3 class="anchored" data-anchor-id="lets-transform-our-data">Let’s transform our data</h3>
<p>Most of the code in these blocks will be Polars transformations. If you are familiar with PySpark you will find that the syntax is similar, no worries if this is your first time with Polars, let’s review what the code does.</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/transformers/product_transformations.py"><code>transformers/product_transformations.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-14"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-14-1"><a href="#annotated-cell-14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span>
<span id="annotated-cell-14-2"><a href="#annotated-cell-14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-14-3"><a href="#annotated-cell-14-3" aria-hidden="true" tabindex="-1"></a><span class="at">@transformer</span></span>
<span id="annotated-cell-14-4"><a href="#annotated-cell-14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> transform(data, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="annotated-cell-14-5"><a href="#annotated-cell-14-5" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> data.with_columns(</span>
<span id="annotated-cell-14-6"><a href="#annotated-cell-14-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Categorize liquors</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-14-7" class="code-annotation-target"><a href="#annotated-cell-14-7" aria-hidden="true" tabindex="-1"></a>        pl.when(pl.col(<span class="st">"category_name"</span>).<span class="bu">str</span>.contains(<span class="st">"VODK"</span>)).then(<span class="st">"Vodka"</span>)</span>
<span id="annotated-cell-14-8"><a href="#annotated-cell-14-8" aria-hidden="true" tabindex="-1"></a>        .when(pl.col(<span class="st">"category_name"</span>).<span class="bu">str</span>.contains(<span class="st">"WHISK"</span>)).then(<span class="st">"Whisky"</span>)</span>
<span id="annotated-cell-14-9"><a href="#annotated-cell-14-9" aria-hidden="true" tabindex="-1"></a>        .when(pl.col(<span class="st">"category_name"</span>).<span class="bu">str</span>.contains(<span class="st">"RUM"</span>)).then(<span class="st">"Rum"</span>)</span>
<span id="annotated-cell-14-10"><a href="#annotated-cell-14-10" aria-hidden="true" tabindex="-1"></a>        .when(pl.col(<span class="st">"category_name"</span>).<span class="bu">str</span>.contains(<span class="st">"SCHN"</span>)).then(<span class="st">"Schnapps"</span>)</span>
<span id="annotated-cell-14-11"><a href="#annotated-cell-14-11" aria-hidden="true" tabindex="-1"></a>        .when(pl.col(<span class="st">"category_name"</span>).<span class="bu">str</span>.contains(<span class="st">"TEQ"</span>)).then(<span class="st">"Tequila"</span>)</span>
<span id="annotated-cell-14-12"><a href="#annotated-cell-14-12" aria-hidden="true" tabindex="-1"></a>        .when(</span>
<span id="annotated-cell-14-13"><a href="#annotated-cell-14-13" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"category_name"</span>).<span class="bu">str</span>.contains(<span class="st">"BRANDIE"</span>)</span>
<span id="annotated-cell-14-14"><a href="#annotated-cell-14-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">|</span> pl.col(<span class="st">"category_name"</span>).<span class="bu">str</span>.contains(<span class="st">"BRANDY"</span>)</span>
<span id="annotated-cell-14-15"><a href="#annotated-cell-14-15" aria-hidden="true" tabindex="-1"></a>            ).then(<span class="st">"Brandy"</span>)</span>
<span id="annotated-cell-14-16"><a href="#annotated-cell-14-16" aria-hidden="true" tabindex="-1"></a>        .when(pl.col(<span class="st">"category_name"</span>).<span class="bu">str</span>.contains(<span class="st">"GIN"</span>)).then(<span class="st">"Gin"</span>)</span>
<span id="annotated-cell-14-17"><a href="#annotated-cell-14-17" aria-hidden="true" tabindex="-1"></a>        .when(pl.col(<span class="st">"category_name"</span>).<span class="bu">str</span>.contains(<span class="st">"MEZC"</span>)).then(<span class="st">"Mezcal"</span>)</span>
<span id="annotated-cell-14-18"><a href="#annotated-cell-14-18" aria-hidden="true" tabindex="-1"></a>        .when(</span>
<span id="annotated-cell-14-19"><a href="#annotated-cell-14-19" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"category_name"</span>).<span class="bu">str</span>.contains(<span class="st">"CREM"</span>)</span>
<span id="annotated-cell-14-20"><a href="#annotated-cell-14-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">|</span> pl.col(<span class="st">"category_name"</span>).<span class="bu">str</span>.contains(<span class="st">"CREAM"</span>)</span>
<span id="annotated-cell-14-21"><a href="#annotated-cell-14-21" aria-hidden="true" tabindex="-1"></a>            ).then(<span class="st">"Cream"</span>)</span>
<span id="annotated-cell-14-22"><a href="#annotated-cell-14-22" aria-hidden="true" tabindex="-1"></a>        .otherwise(<span class="st">"Other"</span>)</span>
<span id="annotated-cell-14-23"><a href="#annotated-cell-14-23" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">"liquor_type"</span>),</span>
<span id="annotated-cell-14-24"><a href="#annotated-cell-14-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Is premium</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-14-25" class="code-annotation-target"><a href="#annotated-cell-14-25" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"state_bottle_retail"</span>) <span class="op">&gt;=</span> <span class="dv">30</span>).alias(<span class="st">"is_premium"</span>),</span>
<span id="annotated-cell-14-26"><a href="#annotated-cell-14-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Bottle size category</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-14-27" class="code-annotation-target"><a href="#annotated-cell-14-27" aria-hidden="true" tabindex="-1"></a>        pl.when(pl.col(<span class="st">"bottle_volume_ml"</span>) <span class="op">&lt;</span> <span class="dv">500</span>).then(<span class="st">"small"</span>)</span>
<span id="annotated-cell-14-28"><a href="#annotated-cell-14-28" aria-hidden="true" tabindex="-1"></a>        .when((pl.col(<span class="st">"bottle_volume_ml"</span>) <span class="op">&gt;=</span> <span class="dv">500</span>) <span class="op">&amp;</span> (pl.col(<span class="st">"bottle_volume_ml"</span>) <span class="op">&lt;</span> <span class="dv">1000</span>)).then(<span class="st">"medium"</span>)</span>
<span id="annotated-cell-14-29"><a href="#annotated-cell-14-29" aria-hidden="true" tabindex="-1"></a>        .otherwise(<span class="st">"large"</span>)</span>
<span id="annotated-cell-14-30"><a href="#annotated-cell-14-30" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">"bottle_size"</span>)</span>
<span id="annotated-cell-14-31"><a href="#annotated-cell-14-31" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="annotated-cell-14-32"><a href="#annotated-cell-14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-14-33"><a href="#annotated-cell-14-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Product-related new variables, generated."</span>)</span>
<span id="annotated-cell-14-34"><a href="#annotated-cell-14-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span>
<span id="annotated-cell-14-35"><a href="#annotated-cell-14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-14-36"><a href="#annotated-cell-14-36" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="7,23" data-code-annotation="1">Categorize the liquor type (Tequila, Whisky, etc.).</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="25" data-code-annotation="2">Determine whether the product is considered premium based on its individual price.</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="27,30" data-code-annotation="3">Classify the product by size.</span>
</dd>
</dl>
</div>
</div>
<p>In this context, <code>data</code> represents the upstream <code>DataFrame</code> passed to this block by <code>pull_data_from_socrata</code>. It is the first parameter of the <code>transform</code> transformer. The Polars transformation begins with the <code>with_columns</code> method, which is used to add or replace columns in the <code>DataFrame</code>.</p>
<p>Within <code>with_columns</code>, we define the transformations. To create the first new variable, we use the <code>pl.when()</code> function to start a conditional statement. To reference a column, we use the <code>pl.col()</code> function. If you are only familiar with Pandas or <code>dplyr</code>, this might feel counterintuitive at first, but it works in a similar fashion—just pass the column name as a string, e.g., <code>pl.col("your_col")</code>.</p>
<p>Once the column is selected, we apply the <code>.str.contains()</code> method to check if the string in a cell contains a specified pattern. If the pattern matches, the value specified in <code>.then()</code> will be used. We can chain additional <code>.when()</code> statements for more conditions, and the default value, used when no condition is met, is specified with <code>.otherwise("Other")</code>. To name the new column, we use <code>.alias("liquor_type")</code>. If the name matches an existing column, it will overwrite that column.</p>
<p>This transformation leverages chained operations, a powerful feature in Polars. Most Polars methods return a <code>DataFrame</code>, allowing you to immediately chain additional methods. This enhances code readability and makes debugging easier. Note that after the <code>.alias()</code> method, there is a comma <code>,</code> instead of a dot <code>.</code>, indicating the end of the chain.</p>
<p>Next, we proceed with premium and size categorizations in a similar manner.</p>
</section>
<section id="test-test-test" class="level3">
<h3 class="anchored" data-anchor-id="test-test-test">Test, test, test!</h3>
<p>Once the new variables are created, we will write tests for the outputs to ensure a baseline level of quality for the new data.</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/transformers/product_transformations.py"><code>transformers/product_transformations.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-15"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-15-1"><a href="#annotated-cell-15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span>
<span id="annotated-cell-15-2"><a href="#annotated-cell-15-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-15-3" class="code-annotation-target"><a href="#annotated-cell-15-3" aria-hidden="true" tabindex="-1"></a><span class="at">@test</span></span>
<span id="annotated-cell-15-4"><a href="#annotated-cell-15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_output(output, <span class="op">*</span>args) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="annotated-cell-15-5"><a href="#annotated-cell-15-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> output <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>, <span class="st">'The output is undefined'</span></span>
<span id="annotated-cell-15-6"><a href="#annotated-cell-15-6" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-15-7" class="code-annotation-target"><a href="#annotated-cell-15-7" aria-hidden="true" tabindex="-1"></a><span class="at">@test</span></span>
<span id="annotated-cell-15-8"><a href="#annotated-cell-15-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_liquor_type_col(output, <span class="op">*</span>args) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="annotated-cell-15-9"><a href="#annotated-cell-15-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> output.get_column(<span class="st">"liquor_type"</span>) <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>, <span class="st">'The column liquor_type is undefined'</span></span>
<span id="annotated-cell-15-10"><a href="#annotated-cell-15-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> output.get_column(<span class="st">"liquor_type"</span>).dtype <span class="kw">is</span> pl.Utf8, <span class="st">"The new variable type doesn't match"</span></span>
<span id="annotated-cell-15-11"><a href="#annotated-cell-15-11" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-15-12" class="code-annotation-target"><a href="#annotated-cell-15-12" aria-hidden="true" tabindex="-1"></a><span class="at">@test</span></span>
<span id="annotated-cell-15-13"><a href="#annotated-cell-15-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_is_premium_col(output, <span class="op">*</span>args) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="annotated-cell-15-14"><a href="#annotated-cell-15-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> output.get_column(<span class="st">"is_premium"</span>) <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>, <span class="st">'The column is_premium is undefined'</span></span>
<span id="annotated-cell-15-15"><a href="#annotated-cell-15-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> output.get_column(<span class="st">"is_premium"</span>).dtype <span class="kw">is</span> pl.Boolean, <span class="st">"The new variable type doesn't match"</span></span>
<span id="annotated-cell-15-16"><a href="#annotated-cell-15-16" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-15-17" class="code-annotation-target"><a href="#annotated-cell-15-17" aria-hidden="true" tabindex="-1"></a><span class="at">@test</span></span>
<span id="annotated-cell-15-18"><a href="#annotated-cell-15-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_bottle_size_col(output, <span class="op">*</span>args) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="annotated-cell-15-19"><a href="#annotated-cell-15-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> output.get_column(<span class="st">"bottle_size"</span>) <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>, <span class="st">'The column bottle_size is undefined'</span></span>
<span id="annotated-cell-15-20"><a href="#annotated-cell-15-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> output.get_column(<span class="st">"bottle_size"</span>).dtype <span class="kw">is</span> pl.Utf8, <span class="st">"The new variable type doesn't match"</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="3,5" data-code-annotation="1">Validate the overall output has content.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="7,10" data-code-annotation="2">Verify the <code>liquor_type</code> column’s content and data type.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="12,15" data-code-annotation="3">Check the <code>is_premium</code> column’s content and data type.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="17,20" data-code-annotation="4">Ensure the <code>bottle_size</code> column’s content and data type are correct.</span>
</dd>
</dl>
</div>
</div>
<p>Notice that each new variable has at least one associated test. While more detailed tests can be added later, these initial ones will suffice for now. And that’s essentially how a transformation block is structured. The next three transformation blocks follow a similar pattern, so I won’t explain them in detail, but feel free to review them as needed.</p>
<ul>
<li><a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/transformers/sales_and_price_related_metrics.py"><code>sales_and_price_related_metrics</code></a></li>
<li><a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/transformers/volume_based_features.py"><code>volume_based_features</code></a></li>
<li><a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/transformers/time_based_features.py"><code>time_based_features</code></a></li>
</ul>
<p>That concludes our data transformation step! Next, we’ll move on to storing our valuable data.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/transformation_done_data_lifecycle_logos.png" class="img-fluid figure-img"></p>
<figcaption>Progress we’ve made so far.</figcaption>
</figure>
</div>
</section>
</section>
<section id="persistent-storage-and-serving" class="level2">
<h2 class="anchored" data-anchor-id="persistent-storage-and-serving">Persistent storage and serving</h2>
<p>With a robust method for retrieving and transforming our data, the next step is to store and query it efficiently. For this purpose, we’ll use DuckDB. But why choose DuckDB?</p>
<p>DuckDB is well-known for its in-memory data manipulation capabilities, but it also supports persistent storage with several compelling advantages. By using DuckDB’s native storage format, we gain the following benefits:</p>
<ul>
<li><a href="https://duckdb.org/why_duckdb.html"><strong>Free and open source:</strong></a> DuckDB is free and open-source, aligning with our preference for accessible and transparent tools<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a>.</li>
<li><a href="https://duckdb.org/2022/10/28/lightweight-compression.html"><strong>Lightweight compression:</strong></a> it employs advanced compression techniques to reduce storage space while maintaining efficiency.</li>
<li><a href="https://vldb.org/pvldb/vol11/p2209-kersten.pdf"><strong>Columnar vectorized query execution:</strong></a> DuckDB processes data in chunks (vectors) rather than row-by-row, making efficient use of CPU and memory. This design is optimized for modern hardware architectures. For a comprehensive explanation, see Kersten et al.&nbsp;(2018).</li>
<li><a href="https://duckdb.org/docs/archive/1.0/internals/storage.html"><strong>Compact file structure:</strong></a> DuckDB stores data in a compact, self-contained binary file, making it portable and easy to manage.</li>
<li><a href="https://www.manning.com/books/duckdb-in-action"><strong>Comprehensible resources:</strong></a> besides excellent documentation, DuckDB has a fantastic community that makes it easy to use this database system. You can get a free “DuckDB in Action” copy on the <a href="https://motherduck.com/duckdb-book-brief/">MotherDuck</a> webpage<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>.</li>
</ul>
<p>Due to this and its ease of use<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a>, DuckDB is an ideal tool for our purpose. So let’s continue with the implementation of our storage step.</p>
<p>After we have finished with our data transformers, we can move to the data exporters. Here, we could have done this by creating only one data exporter, but for the sake of keep the blocks simple and modular (only one task per block) I decided to create two blocks for the data exportation, one for creating the table we will use to store our data, and a last one to export the data. We will start by analyzing the block responsible of the table creation.</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/data_exporters/create_duckdb_table.py"><code>data_exporters/create_duckdb_table.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-16"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-16-1" class="code-annotation-target"><a href="#annotated-cell-16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-16-2" class="code-annotation-target"><a href="#annotated-cell-16-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="annotated-cell-16-3"><a href="#annotated-cell-16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-16-4"><a href="#annotated-cell-16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'data_exporter'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="annotated-cell-16-5"><a href="#annotated-cell-16-5" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> mage_ai.data_preparation.decorators <span class="im">import</span> data_exporter</span>
<span id="annotated-cell-16-6"><a href="#annotated-cell-16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-16-7"><a href="#annotated-cell-16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-16" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="1" data-code-annotation="1">We will use the <code>os</code> module in our tests.</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="2" data-code-annotation="2">Python DuckDB client.</span>
</dd>
</dl>
</div>
</div>
<p>We start with the imports—of course, we’ll need the DuckDB client. If you’ve been following this tutorial, you should have installed it along with the dependencies. Next, we define a query to create the table where we will store our data. This step is crucial to specify the data types for each column.</p>
<p>Another critical aspect is defining constraints for the table. Here, we specify that two columns cannot contain null values and designate <code>invoice_line_no</code> as the primary key. But is this necessary? If we aim to enforce data integrity and prevent duplication, the answer is yes.</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/data_exporters/create_duckdb_table.py"><code>data_exporters/create_duckdb_table.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>create_table_query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">    CREATE TABLE IF NOT EXISTS iowa_liquor_sales (</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">        invoice_line_no TEXT PRIMARY KEY NOT NULL,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="st">        date TIMESTAMP NOT NULL,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="st">        store TEXT,</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="st">        name TEXT,</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="st">        address TEXT,</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="st">        city TEXT,</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="st">        zipcode TEXT,</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="st">        store_location TEXT,</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="st">        county_number TEXT,</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="st">        county TEXT,</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="st">        category TEXT,</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="st">        category_name TEXT,</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="st">        vendor_no TEXT,</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="st">        vendor_name TEXT,</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="st">        itemno TEXT,</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="st">        im_desc TEXT,</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="st">        pack REAL,</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="st">        bottle_volume_ml REAL,</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="st">        state_bottle_cost REAL,</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="st">        state_bottle_retail REAL,</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="st">        sale_bottles REAL,</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="st">        sale_dollars REAL,</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="st">        sale_liters REAL,</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="st">        sale_gallons REAL,</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="st">        liquor_type TEXT,</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="st">        is_premium BOOLEAN,</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="st">        bottle_size TEXT,</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="st">        gov_profit_margin REAL,</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="st">        gov_retail_markup_percentage REAL,</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="st">        price_per_liter REAL,</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="st">        price_per_gallon REAL,</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="st">        total_volume_ordered_L REAL,</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="st">        volume_to_revenue_ratio REAL,</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="st">        week_day INTEGER,</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="st">        is_weekend BOOLEAN,</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="st">        quarter INTEGER</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="st">);</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This query also helps eliminate potential ambiguities when the data is exported. With the query defined, we can now move on to the main functionality of this block, the exporter<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a>. The logic is quite simple.</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/data_exporters/create_duckdb_table.py"><code>data_exporters/create_duckdb_table.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-18"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-18-1"><a href="#annotated-cell-18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span>
<span id="annotated-cell-18-2"><a href="#annotated-cell-18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-18-3"><a href="#annotated-cell-18-3" aria-hidden="true" tabindex="-1"></a><span class="at">@data_exporter</span></span>
<span id="annotated-cell-18-4"><a href="#annotated-cell-18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> export_data(data, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="annotated-cell-18-5"><a href="#annotated-cell-18-5" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-18-6" class="code-annotation-target"><a href="#annotated-cell-18-6" aria-hidden="true" tabindex="-1"></a>    conn <span class="op">=</span> duckdb.<span class="ex">connect</span>(<span class="st">"data/iowa_liquor.duckdb"</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-18-7" class="code-annotation-target"><a href="#annotated-cell-18-7" aria-hidden="true" tabindex="-1"></a>    conn.sql(create_table_query)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-18-8" class="code-annotation-target"><a href="#annotated-cell-18-8" aria-hidden="true" tabindex="-1"></a>    conn.close()</span>
<span id="annotated-cell-18-9"><a href="#annotated-cell-18-9" aria-hidden="true" tabindex="-1"></a>    </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-18-10" class="code-annotation-target"><a href="#annotated-cell-18-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span>
<span id="annotated-cell-18-11"><a href="#annotated-cell-18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-18-12"><a href="#annotated-cell-18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-18" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="6" data-code-annotation="1">Create a connection to a file called <code>data/iowa_liquor.duckdb</code>. If the file doesn’t exist it should create it</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="7" data-code-annotation="2">Creates the table with our query.</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="8" data-code-annotation="3">Explicitly close the connection so no access to the database is blocked downstream</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="10" data-code-annotation="4">Return the unmodified data that was passed upstream.</span>
</dd>
</dl>
</div>
</div>
<p>Here, we connect to our local database, create the table if it doesn’t exist, and close the connection to avoid blocking its access downstream. And that’s the main task of this block. Then, we validate that untouched upstream data has been passed and that the database file is also there:</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/data_exporters/create_duckdb_table.py"><code>data_exporters/create_duckdb_table.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">@test</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_output(output, <span class="op">*</span>args) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> output <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>, <span class="st">'The output is undefined'</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="at">@test</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> db_exist(<span class="op">*</span>args) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> os.path.exists(<span class="st">"data/iowa_liquor.duckdb"</span>), <span class="st">"The database file doesnt exist"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we move to the real exporter, and the last block of our flow. And as you already guessed, here is where we store the retrieved data to our local database. First we establish a connection with our database, and use the object <code>conn</code> to interact with it, then we try to insert the freshly fetched and transformed data to the table <code>iowa_liquor_sales</code>. If a constraint exception is raised we check for duplicates in our batch, exclude them, and try to insert them again. This exception handling will be specially useful when we are at the stage of just updating with the last records our data base. You can examine this in the block:</p>
<p>Filename: <a href="https://github.com/jospablo777/mage_duckdb_pipeline/blob/main/data_exporters/export_polars_to_duckdb.py"><code>data_exporters/export_polars_to_duckdb.py</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-20"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-20-1"><a href="#annotated-cell-20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- snip --</span></span>
<span id="annotated-cell-20-2"><a href="#annotated-cell-20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-20-3"><a href="#annotated-cell-20-3" aria-hidden="true" tabindex="-1"></a><span class="at">@data_exporter</span></span>
<span id="annotated-cell-20-4"><a href="#annotated-cell-20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_data_in_table(data, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-20-5" class="code-annotation-target"><a href="#annotated-cell-20-5" aria-hidden="true" tabindex="-1"></a>    conn <span class="op">=</span> duckdb.<span class="ex">connect</span>(<span class="st">"data/iowa_liquor.duckdb"</span>)</span>
<span id="annotated-cell-20-6"><a href="#annotated-cell-20-6" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-20-7" class="code-annotation-target"><a href="#annotated-cell-20-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="annotated-cell-20-8"><a href="#annotated-cell-20-8" aria-hidden="true" tabindex="-1"></a>        conn.register(<span class="st">"data"</span>, data)</span>
<span id="annotated-cell-20-9"><a href="#annotated-cell-20-9" aria-hidden="true" tabindex="-1"></a>        conn.execute(<span class="st">"INSERT INTO iowa_liquor_sales SELECT * FROM data"</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-20-10" class="code-annotation-target"><a href="#annotated-cell-20-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> duckdb.ConstraintException <span class="im">as</span> e:</span>
<span id="annotated-cell-20-11"><a href="#annotated-cell-20-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(e)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-20-12" class="code-annotation-target"><a href="#annotated-cell-20-12" aria-hidden="true" tabindex="-1"></a>        existing_keys_df <span class="op">=</span> conn.execute(<span class="st">"SELECT invoice_line_no FROM iowa_liquor_sales"</span>).fetchdf()</span>
<span id="annotated-cell-20-13"><a href="#annotated-cell-20-13" aria-hidden="true" tabindex="-1"></a>        existing_keys_series <span class="op">=</span> pl.DataFrame(existing_keys_df)[<span class="st">"invoice_line_no"</span>] </span>
<span id="annotated-cell-20-14"><a href="#annotated-cell-20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-20-15"><a href="#annotated-cell-20-15" aria-hidden="true" tabindex="-1"></a>        filtered_data <span class="op">=</span> data.<span class="bu">filter</span>(<span class="op">~</span>data[<span class="st">"invoice_line_no"</span>].is_in(existing_keys_series))</span>
<span id="annotated-cell-20-16"><a href="#annotated-cell-20-16" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-20-17" class="code-annotation-target"><a href="#annotated-cell-20-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> filtered_data.height <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="annotated-cell-20-18"><a href="#annotated-cell-20-18" aria-hidden="true" tabindex="-1"></a>            conn.register(<span class="st">"filtered_data"</span>, filtered_data)  </span>
<span id="annotated-cell-20-19"><a href="#annotated-cell-20-19" aria-hidden="true" tabindex="-1"></a>            conn.execute(<span class="st">"INSERT INTO iowa_liquor_sales SELECT * FROM filtered_data"</span>)</span>
<span id="annotated-cell-20-20"><a href="#annotated-cell-20-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="annotated-cell-20-21"><a href="#annotated-cell-20-21" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"No new records to insert."</span>)</span>
<span id="annotated-cell-20-22"><a href="#annotated-cell-20-22" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-20-23" class="code-annotation-target"><a href="#annotated-cell-20-23" aria-hidden="true" tabindex="-1"></a>    conn.close()</span>
<span id="annotated-cell-20-24"><a href="#annotated-cell-20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-20-25"><a href="#annotated-cell-20-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Data loaded to your DuckDB database!"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-20" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="5" data-code-annotation="1">Connect to the local database.</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="7,9" data-code-annotation="2">Attempt to insert the data into the <code>iowa_liquor_sales</code> table.</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="10" data-code-annotation="3">If a constraint exception occurs, it likely means the batch of data pulled contains records already present in the database. It should not be about null values since we have already validated that upstream.</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="12,15" data-code-annotation="4">In case of an exception, query the invoice IDs from the local database and filter out the duplicate records from the incoming batch.</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="17,19" data-code-annotation="5">If the filtered <code>DataFrame</code> still contains records, proceed with inserting them into the table.</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="23" data-code-annotation="6">Close the database connection to ensure safety and prevent potential issues.</span>
</dd>
</dl>
</div>
</div>
<p>We have finished the implementation of our pipeline! Congrats!</p>
<section id="test-the-pipeline-in-mage" class="level3">
<h3 class="anchored" data-anchor-id="test-the-pipeline-in-mage">Test the pipeline in Mage</h3>
<p>Now it’s time to see if it works. To do this, click on the three-dot icon in the upper-right corner of your last block (<code>export_polars_to_duckdb</code>).</p>
<p><img src="img/test_pipeline_in_mage.png" class="img-fluid"></p>
<p>Here, select the option labeled “Execute with all upstream blocks.” This will run the entire pipeline. If an error occurs, Python/Mage will notify you, allowing you to begin debugging. If the process runs successfully, then your first batch of data will be stored in your local database.</p>
</section>
</section>
<section id="run-the-data-pipeline-in-the-terminal" class="level2">
<h2 class="anchored" data-anchor-id="run-the-data-pipeline-in-the-terminal">Run the data pipeline in the terminal</h2>
<p>Now open a terminal in the project folder and run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mage</span> run . socrata_iowa_liquor_pipeline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use the <code>run</code> command to execute the pipeline. The dot (<code>.</code>) refers to the current directory (assuming you’re in the project’s folder), and <code>socrata_iowa_liquor_pipeline</code> is the name of our pipeline. If everything runs successfully, your second batch should now be stored in your local database. A successful output will look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">user@user-pc:~/mage_duckdb_pipeline$</span> mage run . socrata_iowa_liquor_pipeline</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Fetching</span> the records-per-year metadata. This might take a couple minutes..</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Done!</span> We have our year record metadata.</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ex">SODA</span> data pull started.</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Years</span> to be fetched: 2017, 2018, 2019, 2020, 2021.</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Fetching</span> data: 100%<span class="kw">|</span><span class="ex">█████████████████████████████████████</span><span class="kw">|</span> <span class="ex">5/5</span> [10:08<span class="op">&lt;</span>00:00, 121.69s/it]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Product-related</span> new variables, generated.</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Sales</span> and price related metrics, computed.</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Volume-based</span> features, computed.</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Time-based</span> features, computed.</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Data</span> loaded to your DuckDB database!</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Pipeline</span> run completed.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can continue with this until your local data is up to date. Remember that we set a limit to fetch a maximum of five years per run. Feel free to adjust this in the <code>pull_data_from_socrata</code> loader.</p>
<section id="should-i-manually-run-the-pipeline-whenever-i-need-to-update-the-data" class="level3">
<h3 class="anchored" data-anchor-id="should-i-manually-run-the-pipeline-whenever-i-need-to-update-the-data">Should I manually run the pipeline whenever I need to update the data?</h3>
<p>Running the pipeline in your terminal might be an option, but not the most appealing one, depending on your use case. For instance, the Iowa Liquor data set is updated once per month with the new data available on the 1st of each month, according to its <a href="https://data.iowa.gov/Sales-Distribution/Iowa-Liquor-Sales/m3tr-qhgy/about_data">documentation</a>. Therefore, it makes sense to run an update job once per month. We can configure a trigger for this, and it is very easy to do, so go review Mage’s <a href="https://docs.mage.ai/orchestration/triggers/configure-triggers-in-code">documentation</a> if you are in the need.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/serving_done_data_lifecycle_logos.png" class="img-fluid figure-img"></p>
<figcaption>Progress we’ve made so far.</figcaption>
</figure>
</div>
<p>And our data is ready to be served via SQL! We can continue with the pipeline’s end goal: analytics and predictive modeling.</p>
</section>
</section>
<section id="data-analytics" class="level2">
<h2 class="anchored" data-anchor-id="data-analytics">Data analytics</h2>
<p>Many proprietary dashboarding tools can take advantage of our DuckDB database. But in keeping with the spirit of our project, we will use the R language for this purpose since it is free, open-source<a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a>, and extremely powerful.</p>
<p>We start by connecting to our local database within our R environment. This connection will be called <code>conn</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>conn <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">drv =</span> duckdb<span class="sc">::</span><span class="fu">duckdb</span>(),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dbdir =</span> <span class="st">"../data/iowa_liquor.duckdb"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">read_only =</span> <span class="cn">TRUE</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that we indicate <code>read_only = TRUE</code> so this connection can be shared between processes. With our connection in place, let’s query some data to visualize:</p>
<div class="cell" data-output.var="bottles_sold_per_type">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">date</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  liquor_type,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">SUM</span>(sale_bottles) <span class="kw">AS</span> bottles_sold</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> iowa_liquor_sales</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="dt">date</span>, liquor_type</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output table of this query is stored in the object <code>bottles_sold_per_type</code>. Let’s have a peek at it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>bottles_sold_per_type <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="sjthfooqyr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#sjthfooqyr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#sjthfooqyr thead, #sjthfooqyr tbody, #sjthfooqyr tfoot, #sjthfooqyr tr, #sjthfooqyr td, #sjthfooqyr th {
  border-style: none;
}

#sjthfooqyr p {
  margin: 0;
  padding: 0;
}

#sjthfooqyr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#sjthfooqyr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#sjthfooqyr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#sjthfooqyr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#sjthfooqyr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sjthfooqyr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sjthfooqyr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sjthfooqyr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#sjthfooqyr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#sjthfooqyr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#sjthfooqyr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#sjthfooqyr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#sjthfooqyr .gt_spanner_row {
  border-bottom-style: hidden;
}

#sjthfooqyr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#sjthfooqyr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#sjthfooqyr .gt_from_md > :first-child {
  margin-top: 0;
}

#sjthfooqyr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#sjthfooqyr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#sjthfooqyr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#sjthfooqyr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#sjthfooqyr .gt_row_group_first td {
  border-top-width: 2px;
}

#sjthfooqyr .gt_row_group_first th {
  border-top-width: 2px;
}

#sjthfooqyr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sjthfooqyr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#sjthfooqyr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#sjthfooqyr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sjthfooqyr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sjthfooqyr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#sjthfooqyr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#sjthfooqyr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#sjthfooqyr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sjthfooqyr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sjthfooqyr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sjthfooqyr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sjthfooqyr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sjthfooqyr .gt_left {
  text-align: left;
}

#sjthfooqyr .gt_center {
  text-align: center;
}

#sjthfooqyr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#sjthfooqyr .gt_font_normal {
  font-weight: normal;
}

#sjthfooqyr .gt_font_bold {
  font-weight: bold;
}

#sjthfooqyr .gt_font_italic {
  font-style: italic;
}

#sjthfooqyr .gt_super {
  font-size: 65%;
}

#sjthfooqyr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#sjthfooqyr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#sjthfooqyr .gt_indent_1 {
  text-indent: 5px;
}

#sjthfooqyr .gt_indent_2 {
  text-indent: 10px;
}

#sjthfooqyr .gt_indent_3 {
  text-indent: 15px;
}

#sjthfooqyr .gt_indent_4 {
  text-indent: 20px;
}

#sjthfooqyr .gt_indent_5 {
  text-indent: 25px;
}

#sjthfooqyr .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#sjthfooqyr div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">date</th>
<th id="liquor_type" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">liquor_type</th>
<th id="bottles_sold" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">bottles_sold</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="date">2013-07-10</td>
<td class="gt_row gt_left" headers="liquor_type">Other</td>
<td class="gt_row gt_right" headers="bottles_sold">15502</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">2013-05-13</td>
<td class="gt_row gt_left" headers="liquor_type">Rum</td>
<td class="gt_row gt_right" headers="bottles_sold">15740</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">2013-12-21</td>
<td class="gt_row gt_left" headers="liquor_type">Whisky</td>
<td class="gt_row gt_right" headers="bottles_sold">17183</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">2013-03-06</td>
<td class="gt_row gt_left" headers="liquor_type">Whisky</td>
<td class="gt_row gt_right" headers="bottles_sold">22114</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">2013-11-25</td>
<td class="gt_row gt_left" headers="liquor_type">Other</td>
<td class="gt_row gt_right" headers="bottles_sold">7959</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s say we want to know how well we sell liquor and see if there is a trend in our historical data. We start by aggregating our freshly queried data. One advantage of using R is that its libraries have pretty useful abstractions; for example, we will use <code>floor_date</code> from <code>lubridate</code> to aggregate the data by month.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>bottle_sales_by_month <span class="ot">&lt;-</span> bottles_sold_per_type <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">month =</span> <span class="fu">floor_date</span>(date, <span class="st">'month'</span>), <span class="co"># Group by month</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>           liquor_type) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">monthly_bottles_sold =</span> <span class="fu">sum</span>(bottles_sold))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using <code>lubridate</code> is more straightforward and less verbose than applying this logic in SQL, so we took advantage of R capabilities. Now that our data is ready let’s visualize it to get some knowledge:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>month_sales_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bottle_sales_by_month, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> monthly_bottles_sold, <span class="at">color =</span> liquor_type)) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Liquor bottles sold by month"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Bottles sold"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Liquor type"</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(month_sales_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-6fdfb24b6c4a1ebc7b7f" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6fdfb24b6c4a1ebc7b7f">{"x":{"data":[{"x":[1325376000,1328054400,1330560000,1333238400,1335830400,1338508800,1341100800,1343779200,1346457600,1349049600,1351728000,1354320000,1356998400,1359676800,1362096000,1364774400,1367366400,1370044800,1372636800,1375315200,1377993600,1380585600,1383264000,1385856000,1388534400,1391212800,1393632000,1396310400,1398902400,1401580800,1404172800,1406851200,1409529600,1412121600,1414800000,1417392000,1420070400,1422748800,1425168000,1427846400,1430438400,1433116800,1435708800,1438387200,1441065600,1443657600,1446336000,1448928000,1451606400,1454284800,1456790400,1459468800,1462060800,1464739200,1467331200,1470009600,1472688000,1475280000,1477958400,1480550400,1483228800,1485907200,1488326400,1491004800,1493596800,1496275200,1498867200,1501545600,1504224000,1506816000,1509494400,1512086400,1514764800,1517443200,1519862400,1522540800,1525132800,1527811200,1530403200,1533081600,1535760000,1538352000,1541030400,1543622400,1546300800,1548979200,1551398400,1554076800,1556668800,1559347200,1561939200,1564617600,1567296000,1569888000,1572566400,1575158400,1577836800,1580515200,1583020800,1585699200,1588291200,1590969600,1593561600,1596240000,1598918400,1601510400,1604188800,1606780800,1609459200,1612137600,1614556800,1617235200,1619827200,1622505600,1625097600,1627776000,1630454400,1633046400,1635724800,1638316800,1640995200,1643673600,1646092800,1648771200,1651363200,1654041600,1656633600,1659312000,1661990400,1664582400,1667260800,1669852800,1672531200,1675209600,1677628800,1680307200,1682899200,1685577600,1688169600,1690848000,1693526400,1696118400,1698796800,1701388800,1704067200,1706745600,1709251200,1711929600,1714521600,1717200000,1719792000,1722470400,1725148800,1727740800,1730419200],"y":[71967,83090,81131,83601,87468,78456,71940,85772,69912,110265,89783,105485,87947,82102,79319,88444,85821,75706,87136,85052,77446,105908,77176,110918,82125,82795,85915,90656,84254,83641,91711,76360,89006,95855,87763,123757,83183,89113,104525,95387,84661,104049,91055,93710,101060,104850,108029,134971,83908,74688,120349,97247,110967,111874,88462,98655,105149,110537,129649,140785,101330,99578,120885,102246,127876,112257,102518,145158,101776,115453,133208,116346,110257,104842,104732,126366,122463,113240,106423,116559,101032,131451,124402,134963,116742,110083,109435,124187,131847,112553,124459,115190,113421,119840,123982,153045,111331,105327,148112,137053,164388,158921,153643,148482,131350,150563,120083,121060,139359,127233,133964,156447,127516,113051,102726,160236,115722,127433,113770,138446,93315,94102,77528,110047,119011,105977,107678,145257,111648,103312,107942,120992,94498,94811,107733,93948,109798,100585,93666,97075,91727,99468,105862,111468,96859,89113,91147,95429,96761,89754,94798,87040,85949,91641,92720],"text":["month: 2012-01-01<br />monthly_bottles_sold:   71967<br />liquor_type: Brandy","month: 2012-02-01<br />monthly_bottles_sold:   83090<br />liquor_type: Brandy","month: 2012-03-01<br />monthly_bottles_sold:   81131<br />liquor_type: Brandy","month: 2012-04-01<br />monthly_bottles_sold:   83601<br />liquor_type: Brandy","month: 2012-05-01<br />monthly_bottles_sold:   87468<br />liquor_type: Brandy","month: 2012-06-01<br />monthly_bottles_sold:   78456<br />liquor_type: Brandy","month: 2012-07-01<br />monthly_bottles_sold:   71940<br />liquor_type: Brandy","month: 2012-08-01<br />monthly_bottles_sold:   85772<br />liquor_type: Brandy","month: 2012-09-01<br />monthly_bottles_sold:   69912<br />liquor_type: Brandy","month: 2012-10-01<br />monthly_bottles_sold:  110265<br />liquor_type: Brandy","month: 2012-11-01<br />monthly_bottles_sold:   89783<br />liquor_type: Brandy","month: 2012-12-01<br />monthly_bottles_sold:  105485<br />liquor_type: Brandy","month: 2013-01-01<br />monthly_bottles_sold:   87947<br />liquor_type: Brandy","month: 2013-02-01<br />monthly_bottles_sold:   82102<br />liquor_type: Brandy","month: 2013-03-01<br />monthly_bottles_sold:   79319<br />liquor_type: Brandy","month: 2013-04-01<br />monthly_bottles_sold:   88444<br />liquor_type: Brandy","month: 2013-05-01<br />monthly_bottles_sold:   85821<br />liquor_type: Brandy","month: 2013-06-01<br />monthly_bottles_sold:   75706<br />liquor_type: Brandy","month: 2013-07-01<br />monthly_bottles_sold:   87136<br />liquor_type: Brandy","month: 2013-08-01<br />monthly_bottles_sold:   85052<br />liquor_type: Brandy","month: 2013-09-01<br />monthly_bottles_sold:   77446<br />liquor_type: Brandy","month: 2013-10-01<br />monthly_bottles_sold:  105908<br />liquor_type: Brandy","month: 2013-11-01<br />monthly_bottles_sold:   77176<br />liquor_type: Brandy","month: 2013-12-01<br />monthly_bottles_sold:  110918<br />liquor_type: Brandy","month: 2014-01-01<br />monthly_bottles_sold:   82125<br />liquor_type: Brandy","month: 2014-02-01<br />monthly_bottles_sold:   82795<br />liquor_type: Brandy","month: 2014-03-01<br />monthly_bottles_sold:   85915<br />liquor_type: Brandy","month: 2014-04-01<br />monthly_bottles_sold:   90656<br />liquor_type: Brandy","month: 2014-05-01<br />monthly_bottles_sold:   84254<br />liquor_type: Brandy","month: 2014-06-01<br />monthly_bottles_sold:   83641<br />liquor_type: Brandy","month: 2014-07-01<br />monthly_bottles_sold:   91711<br />liquor_type: Brandy","month: 2014-08-01<br />monthly_bottles_sold:   76360<br />liquor_type: Brandy","month: 2014-09-01<br />monthly_bottles_sold:   89006<br />liquor_type: Brandy","month: 2014-10-01<br />monthly_bottles_sold:   95855<br />liquor_type: Brandy","month: 2014-11-01<br />monthly_bottles_sold:   87763<br />liquor_type: Brandy","month: 2014-12-01<br />monthly_bottles_sold:  123757<br />liquor_type: Brandy","month: 2015-01-01<br />monthly_bottles_sold:   83183<br />liquor_type: Brandy","month: 2015-02-01<br />monthly_bottles_sold:   89113<br />liquor_type: Brandy","month: 2015-03-01<br />monthly_bottles_sold:  104525<br />liquor_type: Brandy","month: 2015-04-01<br />monthly_bottles_sold:   95387<br />liquor_type: Brandy","month: 2015-05-01<br />monthly_bottles_sold:   84661<br />liquor_type: Brandy","month: 2015-06-01<br />monthly_bottles_sold:  104049<br />liquor_type: Brandy","month: 2015-07-01<br />monthly_bottles_sold:   91055<br />liquor_type: Brandy","month: 2015-08-01<br />monthly_bottles_sold:   93710<br />liquor_type: Brandy","month: 2015-09-01<br />monthly_bottles_sold:  101060<br />liquor_type: Brandy","month: 2015-10-01<br />monthly_bottles_sold:  104850<br />liquor_type: Brandy","month: 2015-11-01<br />monthly_bottles_sold:  108029<br />liquor_type: Brandy","month: 2015-12-01<br />monthly_bottles_sold:  134971<br />liquor_type: Brandy","month: 2016-01-01<br />monthly_bottles_sold:   83908<br />liquor_type: Brandy","month: 2016-02-01<br />monthly_bottles_sold:   74688<br />liquor_type: Brandy","month: 2016-03-01<br />monthly_bottles_sold:  120349<br />liquor_type: Brandy","month: 2016-04-01<br />monthly_bottles_sold:   97247<br />liquor_type: Brandy","month: 2016-05-01<br />monthly_bottles_sold:  110967<br />liquor_type: Brandy","month: 2016-06-01<br />monthly_bottles_sold:  111874<br />liquor_type: Brandy","month: 2016-07-01<br />monthly_bottles_sold:   88462<br />liquor_type: Brandy","month: 2016-08-01<br />monthly_bottles_sold:   98655<br />liquor_type: Brandy","month: 2016-09-01<br />monthly_bottles_sold:  105149<br />liquor_type: Brandy","month: 2016-10-01<br />monthly_bottles_sold:  110537<br />liquor_type: Brandy","month: 2016-11-01<br />monthly_bottles_sold:  129649<br />liquor_type: Brandy","month: 2016-12-01<br />monthly_bottles_sold:  140785<br />liquor_type: Brandy","month: 2017-01-01<br />monthly_bottles_sold:  101330<br />liquor_type: Brandy","month: 2017-02-01<br />monthly_bottles_sold:   99578<br />liquor_type: Brandy","month: 2017-03-01<br />monthly_bottles_sold:  120885<br />liquor_type: Brandy","month: 2017-04-01<br />monthly_bottles_sold:  102246<br />liquor_type: Brandy","month: 2017-05-01<br />monthly_bottles_sold:  127876<br />liquor_type: Brandy","month: 2017-06-01<br />monthly_bottles_sold:  112257<br />liquor_type: Brandy","month: 2017-07-01<br />monthly_bottles_sold:  102518<br />liquor_type: Brandy","month: 2017-08-01<br />monthly_bottles_sold:  145158<br />liquor_type: Brandy","month: 2017-09-01<br />monthly_bottles_sold:  101776<br />liquor_type: Brandy","month: 2017-10-01<br />monthly_bottles_sold:  115453<br />liquor_type: Brandy","month: 2017-11-01<br />monthly_bottles_sold:  133208<br />liquor_type: Brandy","month: 2017-12-01<br />monthly_bottles_sold:  116346<br />liquor_type: Brandy","month: 2018-01-01<br />monthly_bottles_sold:  110257<br />liquor_type: Brandy","month: 2018-02-01<br />monthly_bottles_sold:  104842<br />liquor_type: Brandy","month: 2018-03-01<br />monthly_bottles_sold:  104732<br />liquor_type: Brandy","month: 2018-04-01<br />monthly_bottles_sold:  126366<br />liquor_type: Brandy","month: 2018-05-01<br />monthly_bottles_sold:  122463<br />liquor_type: Brandy","month: 2018-06-01<br />monthly_bottles_sold:  113240<br />liquor_type: Brandy","month: 2018-07-01<br />monthly_bottles_sold:  106423<br />liquor_type: Brandy","month: 2018-08-01<br />monthly_bottles_sold:  116559<br />liquor_type: Brandy","month: 2018-09-01<br />monthly_bottles_sold:  101032<br />liquor_type: Brandy","month: 2018-10-01<br />monthly_bottles_sold:  131451<br />liquor_type: Brandy","month: 2018-11-01<br />monthly_bottles_sold:  124402<br />liquor_type: Brandy","month: 2018-12-01<br />monthly_bottles_sold:  134963<br />liquor_type: Brandy","month: 2019-01-01<br />monthly_bottles_sold:  116742<br />liquor_type: Brandy","month: 2019-02-01<br />monthly_bottles_sold:  110083<br />liquor_type: Brandy","month: 2019-03-01<br />monthly_bottles_sold:  109435<br />liquor_type: Brandy","month: 2019-04-01<br />monthly_bottles_sold:  124187<br />liquor_type: Brandy","month: 2019-05-01<br />monthly_bottles_sold:  131847<br />liquor_type: Brandy","month: 2019-06-01<br />monthly_bottles_sold:  112553<br />liquor_type: Brandy","month: 2019-07-01<br />monthly_bottles_sold:  124459<br />liquor_type: Brandy","month: 2019-08-01<br />monthly_bottles_sold:  115190<br />liquor_type: Brandy","month: 2019-09-01<br />monthly_bottles_sold:  113421<br />liquor_type: Brandy","month: 2019-10-01<br />monthly_bottles_sold:  119840<br />liquor_type: Brandy","month: 2019-11-01<br />monthly_bottles_sold:  123982<br />liquor_type: Brandy","month: 2019-12-01<br />monthly_bottles_sold:  153045<br />liquor_type: Brandy","month: 2020-01-01<br />monthly_bottles_sold:  111331<br />liquor_type: Brandy","month: 2020-02-01<br />monthly_bottles_sold:  105327<br />liquor_type: Brandy","month: 2020-03-01<br />monthly_bottles_sold:  148112<br />liquor_type: Brandy","month: 2020-04-01<br />monthly_bottles_sold:  137053<br />liquor_type: Brandy","month: 2020-05-01<br />monthly_bottles_sold:  164388<br />liquor_type: Brandy","month: 2020-06-01<br />monthly_bottles_sold:  158921<br />liquor_type: Brandy","month: 2020-07-01<br />monthly_bottles_sold:  153643<br />liquor_type: Brandy","month: 2020-08-01<br />monthly_bottles_sold:  148482<br />liquor_type: Brandy","month: 2020-09-01<br />monthly_bottles_sold:  131350<br />liquor_type: Brandy","month: 2020-10-01<br />monthly_bottles_sold:  150563<br />liquor_type: Brandy","month: 2020-11-01<br />monthly_bottles_sold:  120083<br />liquor_type: Brandy","month: 2020-12-01<br />monthly_bottles_sold:  121060<br />liquor_type: Brandy","month: 2021-01-01<br />monthly_bottles_sold:  139359<br />liquor_type: Brandy","month: 2021-02-01<br />monthly_bottles_sold:  127233<br />liquor_type: Brandy","month: 2021-03-01<br />monthly_bottles_sold:  133964<br />liquor_type: Brandy","month: 2021-04-01<br />monthly_bottles_sold:  156447<br />liquor_type: Brandy","month: 2021-05-01<br />monthly_bottles_sold:  127516<br />liquor_type: Brandy","month: 2021-06-01<br />monthly_bottles_sold:  113051<br />liquor_type: Brandy","month: 2021-07-01<br />monthly_bottles_sold:  102726<br />liquor_type: Brandy","month: 2021-08-01<br />monthly_bottles_sold:  160236<br />liquor_type: Brandy","month: 2021-09-01<br />monthly_bottles_sold:  115722<br />liquor_type: Brandy","month: 2021-10-01<br />monthly_bottles_sold:  127433<br />liquor_type: Brandy","month: 2021-11-01<br />monthly_bottles_sold:  113770<br />liquor_type: Brandy","month: 2021-12-01<br />monthly_bottles_sold:  138446<br />liquor_type: Brandy","month: 2022-01-01<br />monthly_bottles_sold:   93315<br />liquor_type: Brandy","month: 2022-02-01<br />monthly_bottles_sold:   94102<br />liquor_type: Brandy","month: 2022-03-01<br />monthly_bottles_sold:   77528<br />liquor_type: Brandy","month: 2022-04-01<br />monthly_bottles_sold:  110047<br />liquor_type: Brandy","month: 2022-05-01<br />monthly_bottles_sold:  119011<br />liquor_type: Brandy","month: 2022-06-01<br />monthly_bottles_sold:  105977<br />liquor_type: Brandy","month: 2022-07-01<br />monthly_bottles_sold:  107678<br />liquor_type: Brandy","month: 2022-08-01<br />monthly_bottles_sold:  145257<br />liquor_type: Brandy","month: 2022-09-01<br />monthly_bottles_sold:  111648<br />liquor_type: Brandy","month: 2022-10-01<br />monthly_bottles_sold:  103312<br />liquor_type: Brandy","month: 2022-11-01<br />monthly_bottles_sold:  107942<br />liquor_type: Brandy","month: 2022-12-01<br />monthly_bottles_sold:  120992<br />liquor_type: Brandy","month: 2023-01-01<br />monthly_bottles_sold:   94498<br />liquor_type: Brandy","month: 2023-02-01<br />monthly_bottles_sold:   94811<br />liquor_type: Brandy","month: 2023-03-01<br />monthly_bottles_sold:  107733<br />liquor_type: Brandy","month: 2023-04-01<br />monthly_bottles_sold:   93948<br />liquor_type: Brandy","month: 2023-05-01<br />monthly_bottles_sold:  109798<br />liquor_type: Brandy","month: 2023-06-01<br />monthly_bottles_sold:  100585<br />liquor_type: Brandy","month: 2023-07-01<br />monthly_bottles_sold:   93666<br />liquor_type: Brandy","month: 2023-08-01<br />monthly_bottles_sold:   97075<br />liquor_type: Brandy","month: 2023-09-01<br />monthly_bottles_sold:   91727<br />liquor_type: Brandy","month: 2023-10-01<br />monthly_bottles_sold:   99468<br />liquor_type: Brandy","month: 2023-11-01<br />monthly_bottles_sold:  105862<br />liquor_type: Brandy","month: 2023-12-01<br />monthly_bottles_sold:  111468<br />liquor_type: Brandy","month: 2024-01-01<br />monthly_bottles_sold:   96859<br />liquor_type: Brandy","month: 2024-02-01<br />monthly_bottles_sold:   89113<br />liquor_type: Brandy","month: 2024-03-01<br />monthly_bottles_sold:   91147<br />liquor_type: Brandy","month: 2024-04-01<br />monthly_bottles_sold:   95429<br />liquor_type: Brandy","month: 2024-05-01<br />monthly_bottles_sold:   96761<br />liquor_type: Brandy","month: 2024-06-01<br />monthly_bottles_sold:   89754<br />liquor_type: Brandy","month: 2024-07-01<br />monthly_bottles_sold:   94798<br />liquor_type: Brandy","month: 2024-08-01<br />monthly_bottles_sold:   87040<br />liquor_type: Brandy","month: 2024-09-01<br />monthly_bottles_sold:   85949<br />liquor_type: Brandy","month: 2024-10-01<br />monthly_bottles_sold:   91641<br />liquor_type: Brandy","month: 2024-11-01<br />monthly_bottles_sold:   92720<br />liquor_type: Brandy"],"type":"scatter","mode":"lines+markers","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Brandy","legendgroup":"Brandy","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"frame":null},{"x":[1325376000,1328054400,1330560000,1333238400,1335830400,1338508800,1341100800,1343779200,1346457600,1349049600,1351728000,1354320000,1356998400,1359676800,1362096000,1364774400,1367366400,1370044800,1372636800,1375315200,1377993600,1380585600,1383264000,1385856000,1388534400,1391212800,1393632000,1396310400,1398902400,1401580800,1404172800,1406851200,1409529600,1412121600,1414800000,1417392000,1420070400,1422748800,1425168000,1427846400,1430438400,1433116800,1435708800,1438387200,1441065600,1443657600,1446336000,1448928000,1451606400,1454284800,1456790400,1459468800,1462060800,1464739200,1467331200,1470009600,1472688000,1475280000,1477958400,1480550400,1483228800,1485907200,1488326400,1491004800,1493596800,1496275200,1498867200,1501545600,1504224000,1506816000,1509494400,1512086400,1514764800,1517443200,1519862400,1522540800,1525132800,1527811200,1530403200,1533081600,1535760000,1538352000,1541030400,1543622400,1546300800,1548979200,1551398400,1554076800,1556668800,1559347200,1561939200,1564617600,1567296000,1569888000,1572566400,1575158400,1577836800,1580515200,1583020800,1585699200,1588291200,1590969600,1593561600,1596240000,1598918400,1601510400,1604188800,1606780800,1609459200,1612137600,1614556800,1617235200,1619827200,1622505600,1625097600,1627776000,1630454400,1633046400,1635724800,1638316800,1640995200,1643673600,1646092800,1648771200,1651363200,1654041600,1656633600,1659312000,1661990400,1664582400,1667260800,1669852800,1672531200,1675209600,1677628800,1680307200,1682899200,1685577600,1688169600,1690848000,1693526400,1696118400,1698796800,1701388800,1704067200,1706745600,1709251200,1711929600,1714521600,1717200000,1719792000,1722470400,1725148800,1727740800,1730419200],"y":[24192,27880,35944,30612,42858,31736,44529,36780,40122,98398,48156,82009,37164,38280,44588,26318,25691,22645,28604,25823,30776,80908,33498,77565,29907,27960,28141,24061,21357,24004,22009,23321,44625,50192,42309,74122,31089,32256,30982,20387,22016,23278,22115,23777,28017,42248,39228,72211,27640,25615,26870,17901,22130,20181,18739,21130,24051,35818,41005,74022,23942,21970,27673,16895,21650,21335,19308,21349,22583,38689,45096,68573,30098,21675,26456,17980,19010,17524,19420,24093,18742,53927,47226,67162,26831,27706,27025,18610,22437,17882,20254,18708,26986,40925,49414,60969,27863,20866,31443,24334,24922,24540,24725,21583,33646,53208,44196,72475,35351,31740,36051,23717,24180,26924,24859,26693,35456,53771,52697,64331,34245,31105,24268,22827,23377,25936,19828,24780,28679,45511,60679,63902,34143,26477,31096,21734,25287,24537,25195,27976,34082,48654,51389,62894,35310,27030,28321,23058,26751,19564,21256,22448,23664,54989,41431],"text":["month: 2012-01-01<br />monthly_bottles_sold:   24192<br />liquor_type: Cream","month: 2012-02-01<br />monthly_bottles_sold:   27880<br />liquor_type: Cream","month: 2012-03-01<br />monthly_bottles_sold:   35944<br />liquor_type: Cream","month: 2012-04-01<br />monthly_bottles_sold:   30612<br />liquor_type: Cream","month: 2012-05-01<br />monthly_bottles_sold:   42858<br />liquor_type: Cream","month: 2012-06-01<br />monthly_bottles_sold:   31736<br />liquor_type: Cream","month: 2012-07-01<br />monthly_bottles_sold:   44529<br />liquor_type: Cream","month: 2012-08-01<br />monthly_bottles_sold:   36780<br />liquor_type: Cream","month: 2012-09-01<br />monthly_bottles_sold:   40122<br />liquor_type: Cream","month: 2012-10-01<br />monthly_bottles_sold:   98398<br />liquor_type: Cream","month: 2012-11-01<br />monthly_bottles_sold:   48156<br />liquor_type: Cream","month: 2012-12-01<br />monthly_bottles_sold:   82009<br />liquor_type: Cream","month: 2013-01-01<br />monthly_bottles_sold:   37164<br />liquor_type: Cream","month: 2013-02-01<br />monthly_bottles_sold:   38280<br />liquor_type: Cream","month: 2013-03-01<br />monthly_bottles_sold:   44588<br />liquor_type: Cream","month: 2013-04-01<br />monthly_bottles_sold:   26318<br />liquor_type: Cream","month: 2013-05-01<br />monthly_bottles_sold:   25691<br />liquor_type: Cream","month: 2013-06-01<br />monthly_bottles_sold:   22645<br />liquor_type: Cream","month: 2013-07-01<br />monthly_bottles_sold:   28604<br />liquor_type: Cream","month: 2013-08-01<br />monthly_bottles_sold:   25823<br />liquor_type: Cream","month: 2013-09-01<br />monthly_bottles_sold:   30776<br />liquor_type: Cream","month: 2013-10-01<br />monthly_bottles_sold:   80908<br />liquor_type: Cream","month: 2013-11-01<br />monthly_bottles_sold:   33498<br />liquor_type: Cream","month: 2013-12-01<br />monthly_bottles_sold:   77565<br />liquor_type: Cream","month: 2014-01-01<br />monthly_bottles_sold:   29907<br />liquor_type: Cream","month: 2014-02-01<br />monthly_bottles_sold:   27960<br />liquor_type: Cream","month: 2014-03-01<br />monthly_bottles_sold:   28141<br />liquor_type: Cream","month: 2014-04-01<br />monthly_bottles_sold:   24061<br />liquor_type: Cream","month: 2014-05-01<br />monthly_bottles_sold:   21357<br />liquor_type: Cream","month: 2014-06-01<br />monthly_bottles_sold:   24004<br />liquor_type: Cream","month: 2014-07-01<br />monthly_bottles_sold:   22009<br />liquor_type: Cream","month: 2014-08-01<br />monthly_bottles_sold:   23321<br />liquor_type: Cream","month: 2014-09-01<br />monthly_bottles_sold:   44625<br />liquor_type: Cream","month: 2014-10-01<br />monthly_bottles_sold:   50192<br />liquor_type: Cream","month: 2014-11-01<br />monthly_bottles_sold:   42309<br />liquor_type: Cream","month: 2014-12-01<br />monthly_bottles_sold:   74122<br />liquor_type: Cream","month: 2015-01-01<br />monthly_bottles_sold:   31089<br />liquor_type: Cream","month: 2015-02-01<br />monthly_bottles_sold:   32256<br />liquor_type: Cream","month: 2015-03-01<br />monthly_bottles_sold:   30982<br />liquor_type: Cream","month: 2015-04-01<br />monthly_bottles_sold:   20387<br />liquor_type: Cream","month: 2015-05-01<br />monthly_bottles_sold:   22016<br />liquor_type: Cream","month: 2015-06-01<br />monthly_bottles_sold:   23278<br />liquor_type: Cream","month: 2015-07-01<br />monthly_bottles_sold:   22115<br />liquor_type: Cream","month: 2015-08-01<br />monthly_bottles_sold:   23777<br />liquor_type: Cream","month: 2015-09-01<br />monthly_bottles_sold:   28017<br />liquor_type: Cream","month: 2015-10-01<br />monthly_bottles_sold:   42248<br />liquor_type: Cream","month: 2015-11-01<br />monthly_bottles_sold:   39228<br />liquor_type: Cream","month: 2015-12-01<br />monthly_bottles_sold:   72211<br />liquor_type: Cream","month: 2016-01-01<br />monthly_bottles_sold:   27640<br />liquor_type: Cream","month: 2016-02-01<br />monthly_bottles_sold:   25615<br />liquor_type: Cream","month: 2016-03-01<br />monthly_bottles_sold:   26870<br />liquor_type: Cream","month: 2016-04-01<br />monthly_bottles_sold:   17901<br />liquor_type: Cream","month: 2016-05-01<br />monthly_bottles_sold:   22130<br />liquor_type: Cream","month: 2016-06-01<br />monthly_bottles_sold:   20181<br />liquor_type: Cream","month: 2016-07-01<br />monthly_bottles_sold:   18739<br />liquor_type: Cream","month: 2016-08-01<br />monthly_bottles_sold:   21130<br />liquor_type: Cream","month: 2016-09-01<br />monthly_bottles_sold:   24051<br />liquor_type: Cream","month: 2016-10-01<br />monthly_bottles_sold:   35818<br />liquor_type: Cream","month: 2016-11-01<br />monthly_bottles_sold:   41005<br />liquor_type: Cream","month: 2016-12-01<br />monthly_bottles_sold:   74022<br />liquor_type: Cream","month: 2017-01-01<br />monthly_bottles_sold:   23942<br />liquor_type: Cream","month: 2017-02-01<br />monthly_bottles_sold:   21970<br />liquor_type: Cream","month: 2017-03-01<br />monthly_bottles_sold:   27673<br />liquor_type: Cream","month: 2017-04-01<br />monthly_bottles_sold:   16895<br />liquor_type: Cream","month: 2017-05-01<br />monthly_bottles_sold:   21650<br />liquor_type: Cream","month: 2017-06-01<br />monthly_bottles_sold:   21335<br />liquor_type: Cream","month: 2017-07-01<br />monthly_bottles_sold:   19308<br />liquor_type: Cream","month: 2017-08-01<br />monthly_bottles_sold:   21349<br />liquor_type: Cream","month: 2017-09-01<br />monthly_bottles_sold:   22583<br />liquor_type: Cream","month: 2017-10-01<br />monthly_bottles_sold:   38689<br />liquor_type: Cream","month: 2017-11-01<br />monthly_bottles_sold:   45096<br />liquor_type: Cream","month: 2017-12-01<br />monthly_bottles_sold:   68573<br />liquor_type: Cream","month: 2018-01-01<br />monthly_bottles_sold:   30098<br />liquor_type: Cream","month: 2018-02-01<br />monthly_bottles_sold:   21675<br />liquor_type: Cream","month: 2018-03-01<br />monthly_bottles_sold:   26456<br />liquor_type: Cream","month: 2018-04-01<br />monthly_bottles_sold:   17980<br />liquor_type: Cream","month: 2018-05-01<br />monthly_bottles_sold:   19010<br />liquor_type: Cream","month: 2018-06-01<br />monthly_bottles_sold:   17524<br />liquor_type: Cream","month: 2018-07-01<br />monthly_bottles_sold:   19420<br />liquor_type: Cream","month: 2018-08-01<br />monthly_bottles_sold:   24093<br />liquor_type: Cream","month: 2018-09-01<br />monthly_bottles_sold:   18742<br />liquor_type: Cream","month: 2018-10-01<br />monthly_bottles_sold:   53927<br />liquor_type: Cream","month: 2018-11-01<br />monthly_bottles_sold:   47226<br />liquor_type: Cream","month: 2018-12-01<br />monthly_bottles_sold:   67162<br />liquor_type: Cream","month: 2019-01-01<br />monthly_bottles_sold:   26831<br />liquor_type: Cream","month: 2019-02-01<br />monthly_bottles_sold:   27706<br />liquor_type: Cream","month: 2019-03-01<br />monthly_bottles_sold:   27025<br />liquor_type: Cream","month: 2019-04-01<br />monthly_bottles_sold:   18610<br />liquor_type: Cream","month: 2019-05-01<br />monthly_bottles_sold:   22437<br />liquor_type: Cream","month: 2019-06-01<br />monthly_bottles_sold:   17882<br />liquor_type: Cream","month: 2019-07-01<br />monthly_bottles_sold:   20254<br />liquor_type: Cream","month: 2019-08-01<br />monthly_bottles_sold:   18708<br />liquor_type: Cream","month: 2019-09-01<br />monthly_bottles_sold:   26986<br />liquor_type: Cream","month: 2019-10-01<br />monthly_bottles_sold:   40925<br />liquor_type: Cream","month: 2019-11-01<br />monthly_bottles_sold:   49414<br />liquor_type: Cream","month: 2019-12-01<br />monthly_bottles_sold:   60969<br />liquor_type: Cream","month: 2020-01-01<br />monthly_bottles_sold:   27863<br />liquor_type: Cream","month: 2020-02-01<br />monthly_bottles_sold:   20866<br />liquor_type: Cream","month: 2020-03-01<br />monthly_bottles_sold:   31443<br />liquor_type: Cream","month: 2020-04-01<br />monthly_bottles_sold:   24334<br />liquor_type: Cream","month: 2020-05-01<br />monthly_bottles_sold:   24922<br />liquor_type: Cream","month: 2020-06-01<br />monthly_bottles_sold:   24540<br />liquor_type: Cream","month: 2020-07-01<br />monthly_bottles_sold:   24725<br />liquor_type: Cream","month: 2020-08-01<br />monthly_bottles_sold:   21583<br />liquor_type: Cream","month: 2020-09-01<br />monthly_bottles_sold:   33646<br />liquor_type: Cream","month: 2020-10-01<br />monthly_bottles_sold:   53208<br />liquor_type: Cream","month: 2020-11-01<br />monthly_bottles_sold:   44196<br />liquor_type: Cream","month: 2020-12-01<br />monthly_bottles_sold:   72475<br />liquor_type: Cream","month: 2021-01-01<br />monthly_bottles_sold:   35351<br />liquor_type: Cream","month: 2021-02-01<br />monthly_bottles_sold:   31740<br />liquor_type: Cream","month: 2021-03-01<br />monthly_bottles_sold:   36051<br />liquor_type: Cream","month: 2021-04-01<br />monthly_bottles_sold:   23717<br />liquor_type: Cream","month: 2021-05-01<br />monthly_bottles_sold:   24180<br />liquor_type: Cream","month: 2021-06-01<br />monthly_bottles_sold:   26924<br />liquor_type: Cream","month: 2021-07-01<br />monthly_bottles_sold:   24859<br />liquor_type: Cream","month: 2021-08-01<br />monthly_bottles_sold:   26693<br />liquor_type: Cream","month: 2021-09-01<br />monthly_bottles_sold:   35456<br />liquor_type: Cream","month: 2021-10-01<br />monthly_bottles_sold:   53771<br />liquor_type: Cream","month: 2021-11-01<br />monthly_bottles_sold:   52697<br />liquor_type: Cream","month: 2021-12-01<br />monthly_bottles_sold:   64331<br />liquor_type: Cream","month: 2022-01-01<br />monthly_bottles_sold:   34245<br />liquor_type: Cream","month: 2022-02-01<br />monthly_bottles_sold:   31105<br />liquor_type: Cream","month: 2022-03-01<br />monthly_bottles_sold:   24268<br />liquor_type: Cream","month: 2022-04-01<br />monthly_bottles_sold:   22827<br />liquor_type: Cream","month: 2022-05-01<br />monthly_bottles_sold:   23377<br />liquor_type: Cream","month: 2022-06-01<br />monthly_bottles_sold:   25936<br />liquor_type: Cream","month: 2022-07-01<br />monthly_bottles_sold:   19828<br />liquor_type: Cream","month: 2022-08-01<br />monthly_bottles_sold:   24780<br />liquor_type: Cream","month: 2022-09-01<br />monthly_bottles_sold:   28679<br />liquor_type: Cream","month: 2022-10-01<br />monthly_bottles_sold:   45511<br />liquor_type: Cream","month: 2022-11-01<br />monthly_bottles_sold:   60679<br />liquor_type: Cream","month: 2022-12-01<br />monthly_bottles_sold:   63902<br />liquor_type: Cream","month: 2023-01-01<br />monthly_bottles_sold:   34143<br />liquor_type: Cream","month: 2023-02-01<br />monthly_bottles_sold:   26477<br />liquor_type: Cream","month: 2023-03-01<br />monthly_bottles_sold:   31096<br />liquor_type: Cream","month: 2023-04-01<br />monthly_bottles_sold:   21734<br />liquor_type: Cream","month: 2023-05-01<br />monthly_bottles_sold:   25287<br />liquor_type: Cream","month: 2023-06-01<br />monthly_bottles_sold:   24537<br />liquor_type: Cream","month: 2023-07-01<br />monthly_bottles_sold:   25195<br />liquor_type: Cream","month: 2023-08-01<br />monthly_bottles_sold:   27976<br />liquor_type: Cream","month: 2023-09-01<br />monthly_bottles_sold:   34082<br />liquor_type: Cream","month: 2023-10-01<br />monthly_bottles_sold:   48654<br />liquor_type: Cream","month: 2023-11-01<br />monthly_bottles_sold:   51389<br />liquor_type: Cream","month: 2023-12-01<br />monthly_bottles_sold:   62894<br />liquor_type: Cream","month: 2024-01-01<br />monthly_bottles_sold:   35310<br />liquor_type: Cream","month: 2024-02-01<br />monthly_bottles_sold:   27030<br />liquor_type: Cream","month: 2024-03-01<br />monthly_bottles_sold:   28321<br />liquor_type: Cream","month: 2024-04-01<br />monthly_bottles_sold:   23058<br />liquor_type: Cream","month: 2024-05-01<br />monthly_bottles_sold:   26751<br />liquor_type: Cream","month: 2024-06-01<br />monthly_bottles_sold:   19564<br />liquor_type: Cream","month: 2024-07-01<br />monthly_bottles_sold:   21256<br />liquor_type: Cream","month: 2024-08-01<br />monthly_bottles_sold:   22448<br />liquor_type: Cream","month: 2024-09-01<br />monthly_bottles_sold:   23664<br />liquor_type: Cream","month: 2024-10-01<br />monthly_bottles_sold:   54989<br />liquor_type: Cream","month: 2024-11-01<br />monthly_bottles_sold:   41431<br />liquor_type: Cream"],"type":"scatter","mode":"lines+markers","line":{"width":1.8897637795275593,"color":"rgba(216,144,0,1)","dash":"solid"},"hoveron":"points","name":"Cream","legendgroup":"Cream","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(216,144,0,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(216,144,0,1)"}},"frame":null},{"x":[1325376000,1328054400,1330560000,1333238400,1335830400,1338508800,1341100800,1343779200,1346457600,1349049600,1351728000,1354320000,1356998400,1359676800,1362096000,1364774400,1367366400,1370044800,1372636800,1375315200,1377993600,1380585600,1383264000,1385856000,1388534400,1391212800,1393632000,1396310400,1398902400,1401580800,1404172800,1406851200,1409529600,1412121600,1414800000,1417392000,1420070400,1422748800,1425168000,1427846400,1430438400,1433116800,1435708800,1438387200,1441065600,1443657600,1446336000,1448928000,1451606400,1454284800,1456790400,1459468800,1462060800,1464739200,1467331200,1470009600,1472688000,1475280000,1477958400,1480550400,1483228800,1485907200,1488326400,1491004800,1493596800,1496275200,1498867200,1501545600,1504224000,1506816000,1509494400,1512086400,1514764800,1517443200,1519862400,1522540800,1525132800,1527811200,1530403200,1533081600,1535760000,1538352000,1541030400,1543622400,1546300800,1548979200,1551398400,1554076800,1556668800,1559347200,1561939200,1564617600,1567296000,1569888000,1572566400,1575158400,1577836800,1580515200,1583020800,1585699200,1588291200,1590969600,1593561600,1596240000,1598918400,1601510400,1604188800,1606780800,1609459200,1612137600,1614556800,1617235200,1619827200,1622505600,1625097600,1627776000,1630454400,1633046400,1635724800,1638316800,1640995200,1643673600,1646092800,1648771200,1651363200,1654041600,1656633600,1659312000,1661990400,1664582400,1667260800,1669852800,1672531200,1675209600,1677628800,1680307200,1682899200,1685577600,1688169600,1690848000,1693526400,1696118400,1698796800,1701388800,1704067200,1706745600,1709251200,1711929600,1714521600,1717200000,1719792000,1722470400,1725148800,1727740800,1730419200],"y":[46827,52158,56662,62549,71114,65860,72705,71510,52005,63616,58719,67434,51954,49607,50587,62229,65183,61645,71916,64790,59178,66313,55314,64568,60140,45890,49915,59820,58231,66609,68797,60896,52809,58639,47541,63028,43430,44386,54502,57886,56405,72353,60121,63440,55516,54910,51335,66410,44069,47078,58071,53304,59892,73628,55461,56523,56669,52062,53061,65334,44525,44671,50663,51895,63052,67783,60268,65554,48203,55570,53307,57223,47443,42904,48308,52022,65361,61663,61835,66597,52358,58096,51650,60679,49895,43528,43620,61102,63704,57669,67938,60400,50715,56924,52991,61656,46446,43900,56956,52520,58691,66320,61262,59982,62556,56150,52440,60073,49406,49239,57158,62914,54239,68847,66091,61616,59359,50838,50152,58260,34028,36952,33049,53399,52881,65017,55662,68029,49710,48459,49535,50527,43346,39999,47475,52431,54038,60672,49447,56324,50336,53758,46799,50188,41954,46790,43024,51642,56171,53640,55292,55385,49215,50507,42526],"text":["month: 2012-01-01<br />monthly_bottles_sold:   46827<br />liquor_type: Gin","month: 2012-02-01<br />monthly_bottles_sold:   52158<br />liquor_type: Gin","month: 2012-03-01<br />monthly_bottles_sold:   56662<br />liquor_type: Gin","month: 2012-04-01<br />monthly_bottles_sold:   62549<br />liquor_type: Gin","month: 2012-05-01<br />monthly_bottles_sold:   71114<br />liquor_type: Gin","month: 2012-06-01<br />monthly_bottles_sold:   65860<br />liquor_type: Gin","month: 2012-07-01<br />monthly_bottles_sold:   72705<br />liquor_type: Gin","month: 2012-08-01<br />monthly_bottles_sold:   71510<br />liquor_type: Gin","month: 2012-09-01<br />monthly_bottles_sold:   52005<br />liquor_type: Gin","month: 2012-10-01<br />monthly_bottles_sold:   63616<br />liquor_type: Gin","month: 2012-11-01<br />monthly_bottles_sold:   58719<br />liquor_type: Gin","month: 2012-12-01<br />monthly_bottles_sold:   67434<br />liquor_type: Gin","month: 2013-01-01<br />monthly_bottles_sold:   51954<br />liquor_type: Gin","month: 2013-02-01<br />monthly_bottles_sold:   49607<br />liquor_type: Gin","month: 2013-03-01<br />monthly_bottles_sold:   50587<br />liquor_type: Gin","month: 2013-04-01<br />monthly_bottles_sold:   62229<br />liquor_type: Gin","month: 2013-05-01<br />monthly_bottles_sold:   65183<br />liquor_type: Gin","month: 2013-06-01<br />monthly_bottles_sold:   61645<br />liquor_type: Gin","month: 2013-07-01<br />monthly_bottles_sold:   71916<br />liquor_type: Gin","month: 2013-08-01<br />monthly_bottles_sold:   64790<br />liquor_type: Gin","month: 2013-09-01<br />monthly_bottles_sold:   59178<br />liquor_type: Gin","month: 2013-10-01<br />monthly_bottles_sold:   66313<br />liquor_type: Gin","month: 2013-11-01<br />monthly_bottles_sold:   55314<br />liquor_type: Gin","month: 2013-12-01<br />monthly_bottles_sold:   64568<br />liquor_type: Gin","month: 2014-01-01<br />monthly_bottles_sold:   60140<br />liquor_type: Gin","month: 2014-02-01<br />monthly_bottles_sold:   45890<br />liquor_type: Gin","month: 2014-03-01<br />monthly_bottles_sold:   49915<br />liquor_type: Gin","month: 2014-04-01<br />monthly_bottles_sold:   59820<br />liquor_type: Gin","month: 2014-05-01<br />monthly_bottles_sold:   58231<br />liquor_type: Gin","month: 2014-06-01<br />monthly_bottles_sold:   66609<br />liquor_type: Gin","month: 2014-07-01<br />monthly_bottles_sold:   68797<br />liquor_type: Gin","month: 2014-08-01<br />monthly_bottles_sold:   60896<br />liquor_type: Gin","month: 2014-09-01<br />monthly_bottles_sold:   52809<br />liquor_type: Gin","month: 2014-10-01<br />monthly_bottles_sold:   58639<br />liquor_type: Gin","month: 2014-11-01<br />monthly_bottles_sold:   47541<br />liquor_type: Gin","month: 2014-12-01<br />monthly_bottles_sold:   63028<br />liquor_type: Gin","month: 2015-01-01<br />monthly_bottles_sold:   43430<br />liquor_type: Gin","month: 2015-02-01<br />monthly_bottles_sold:   44386<br />liquor_type: Gin","month: 2015-03-01<br />monthly_bottles_sold:   54502<br />liquor_type: Gin","month: 2015-04-01<br />monthly_bottles_sold:   57886<br />liquor_type: Gin","month: 2015-05-01<br />monthly_bottles_sold:   56405<br />liquor_type: Gin","month: 2015-06-01<br />monthly_bottles_sold:   72353<br />liquor_type: Gin","month: 2015-07-01<br />monthly_bottles_sold:   60121<br />liquor_type: Gin","month: 2015-08-01<br />monthly_bottles_sold:   63440<br />liquor_type: Gin","month: 2015-09-01<br />monthly_bottles_sold:   55516<br />liquor_type: Gin","month: 2015-10-01<br />monthly_bottles_sold:   54910<br />liquor_type: Gin","month: 2015-11-01<br />monthly_bottles_sold:   51335<br />liquor_type: Gin","month: 2015-12-01<br />monthly_bottles_sold:   66410<br />liquor_type: Gin","month: 2016-01-01<br />monthly_bottles_sold:   44069<br />liquor_type: Gin","month: 2016-02-01<br />monthly_bottles_sold:   47078<br />liquor_type: Gin","month: 2016-03-01<br />monthly_bottles_sold:   58071<br />liquor_type: Gin","month: 2016-04-01<br />monthly_bottles_sold:   53304<br />liquor_type: Gin","month: 2016-05-01<br />monthly_bottles_sold:   59892<br />liquor_type: Gin","month: 2016-06-01<br />monthly_bottles_sold:   73628<br />liquor_type: Gin","month: 2016-07-01<br />monthly_bottles_sold:   55461<br />liquor_type: Gin","month: 2016-08-01<br />monthly_bottles_sold:   56523<br />liquor_type: Gin","month: 2016-09-01<br />monthly_bottles_sold:   56669<br />liquor_type: Gin","month: 2016-10-01<br />monthly_bottles_sold:   52062<br />liquor_type: Gin","month: 2016-11-01<br />monthly_bottles_sold:   53061<br />liquor_type: Gin","month: 2016-12-01<br />monthly_bottles_sold:   65334<br />liquor_type: Gin","month: 2017-01-01<br />monthly_bottles_sold:   44525<br />liquor_type: Gin","month: 2017-02-01<br />monthly_bottles_sold:   44671<br />liquor_type: Gin","month: 2017-03-01<br />monthly_bottles_sold:   50663<br />liquor_type: Gin","month: 2017-04-01<br />monthly_bottles_sold:   51895<br />liquor_type: Gin","month: 2017-05-01<br />monthly_bottles_sold:   63052<br />liquor_type: Gin","month: 2017-06-01<br />monthly_bottles_sold:   67783<br />liquor_type: Gin","month: 2017-07-01<br />monthly_bottles_sold:   60268<br />liquor_type: Gin","month: 2017-08-01<br />monthly_bottles_sold:   65554<br />liquor_type: Gin","month: 2017-09-01<br />monthly_bottles_sold:   48203<br />liquor_type: Gin","month: 2017-10-01<br />monthly_bottles_sold:   55570<br />liquor_type: Gin","month: 2017-11-01<br />monthly_bottles_sold:   53307<br />liquor_type: Gin","month: 2017-12-01<br />monthly_bottles_sold:   57223<br />liquor_type: Gin","month: 2018-01-01<br />monthly_bottles_sold:   47443<br />liquor_type: Gin","month: 2018-02-01<br />monthly_bottles_sold:   42904<br />liquor_type: Gin","month: 2018-03-01<br />monthly_bottles_sold:   48308<br />liquor_type: Gin","month: 2018-04-01<br />monthly_bottles_sold:   52022<br />liquor_type: Gin","month: 2018-05-01<br />monthly_bottles_sold:   65361<br />liquor_type: Gin","month: 2018-06-01<br />monthly_bottles_sold:   61663<br />liquor_type: Gin","month: 2018-07-01<br />monthly_bottles_sold:   61835<br />liquor_type: Gin","month: 2018-08-01<br />monthly_bottles_sold:   66597<br />liquor_type: Gin","month: 2018-09-01<br />monthly_bottles_sold:   52358<br />liquor_type: Gin","month: 2018-10-01<br />monthly_bottles_sold:   58096<br />liquor_type: Gin","month: 2018-11-01<br />monthly_bottles_sold:   51650<br />liquor_type: Gin","month: 2018-12-01<br />monthly_bottles_sold:   60679<br />liquor_type: Gin","month: 2019-01-01<br />monthly_bottles_sold:   49895<br />liquor_type: Gin","month: 2019-02-01<br />monthly_bottles_sold:   43528<br />liquor_type: Gin","month: 2019-03-01<br />monthly_bottles_sold:   43620<br />liquor_type: Gin","month: 2019-04-01<br />monthly_bottles_sold:   61102<br />liquor_type: Gin","month: 2019-05-01<br />monthly_bottles_sold:   63704<br />liquor_type: Gin","month: 2019-06-01<br />monthly_bottles_sold:   57669<br />liquor_type: Gin","month: 2019-07-01<br />monthly_bottles_sold:   67938<br />liquor_type: Gin","month: 2019-08-01<br />monthly_bottles_sold:   60400<br />liquor_type: Gin","month: 2019-09-01<br />monthly_bottles_sold:   50715<br />liquor_type: Gin","month: 2019-10-01<br />monthly_bottles_sold:   56924<br />liquor_type: Gin","month: 2019-11-01<br />monthly_bottles_sold:   52991<br />liquor_type: Gin","month: 2019-12-01<br />monthly_bottles_sold:   61656<br />liquor_type: Gin","month: 2020-01-01<br />monthly_bottles_sold:   46446<br />liquor_type: Gin","month: 2020-02-01<br />monthly_bottles_sold:   43900<br />liquor_type: Gin","month: 2020-03-01<br />monthly_bottles_sold:   56956<br />liquor_type: Gin","month: 2020-04-01<br />monthly_bottles_sold:   52520<br />liquor_type: Gin","month: 2020-05-01<br />monthly_bottles_sold:   58691<br />liquor_type: Gin","month: 2020-06-01<br />monthly_bottles_sold:   66320<br />liquor_type: Gin","month: 2020-07-01<br />monthly_bottles_sold:   61262<br />liquor_type: Gin","month: 2020-08-01<br />monthly_bottles_sold:   59982<br />liquor_type: Gin","month: 2020-09-01<br />monthly_bottles_sold:   62556<br />liquor_type: Gin","month: 2020-10-01<br />monthly_bottles_sold:   56150<br />liquor_type: Gin","month: 2020-11-01<br />monthly_bottles_sold:   52440<br />liquor_type: Gin","month: 2020-12-01<br />monthly_bottles_sold:   60073<br />liquor_type: Gin","month: 2021-01-01<br />monthly_bottles_sold:   49406<br />liquor_type: Gin","month: 2021-02-01<br />monthly_bottles_sold:   49239<br />liquor_type: Gin","month: 2021-03-01<br />monthly_bottles_sold:   57158<br />liquor_type: Gin","month: 2021-04-01<br />monthly_bottles_sold:   62914<br />liquor_type: Gin","month: 2021-05-01<br />monthly_bottles_sold:   54239<br />liquor_type: Gin","month: 2021-06-01<br />monthly_bottles_sold:   68847<br />liquor_type: Gin","month: 2021-07-01<br />monthly_bottles_sold:   66091<br />liquor_type: Gin","month: 2021-08-01<br />monthly_bottles_sold:   61616<br />liquor_type: Gin","month: 2021-09-01<br />monthly_bottles_sold:   59359<br />liquor_type: Gin","month: 2021-10-01<br />monthly_bottles_sold:   50838<br />liquor_type: Gin","month: 2021-11-01<br />monthly_bottles_sold:   50152<br />liquor_type: Gin","month: 2021-12-01<br />monthly_bottles_sold:   58260<br />liquor_type: Gin","month: 2022-01-01<br />monthly_bottles_sold:   34028<br />liquor_type: Gin","month: 2022-02-01<br />monthly_bottles_sold:   36952<br />liquor_type: Gin","month: 2022-03-01<br />monthly_bottles_sold:   33049<br />liquor_type: Gin","month: 2022-04-01<br />monthly_bottles_sold:   53399<br />liquor_type: Gin","month: 2022-05-01<br />monthly_bottles_sold:   52881<br />liquor_type: Gin","month: 2022-06-01<br />monthly_bottles_sold:   65017<br />liquor_type: Gin","month: 2022-07-01<br />monthly_bottles_sold:   55662<br />liquor_type: Gin","month: 2022-08-01<br />monthly_bottles_sold:   68029<br />liquor_type: Gin","month: 2022-09-01<br />monthly_bottles_sold:   49710<br />liquor_type: Gin","month: 2022-10-01<br />monthly_bottles_sold:   48459<br />liquor_type: Gin","month: 2022-11-01<br />monthly_bottles_sold:   49535<br />liquor_type: Gin","month: 2022-12-01<br />monthly_bottles_sold:   50527<br />liquor_type: Gin","month: 2023-01-01<br />monthly_bottles_sold:   43346<br />liquor_type: Gin","month: 2023-02-01<br />monthly_bottles_sold:   39999<br />liquor_type: Gin","month: 2023-03-01<br />monthly_bottles_sold:   47475<br />liquor_type: Gin","month: 2023-04-01<br />monthly_bottles_sold:   52431<br />liquor_type: Gin","month: 2023-05-01<br />monthly_bottles_sold:   54038<br />liquor_type: Gin","month: 2023-06-01<br />monthly_bottles_sold:   60672<br />liquor_type: Gin","month: 2023-07-01<br />monthly_bottles_sold:   49447<br />liquor_type: Gin","month: 2023-08-01<br />monthly_bottles_sold:   56324<br />liquor_type: Gin","month: 2023-09-01<br />monthly_bottles_sold:   50336<br />liquor_type: Gin","month: 2023-10-01<br />monthly_bottles_sold:   53758<br />liquor_type: Gin","month: 2023-11-01<br />monthly_bottles_sold:   46799<br />liquor_type: Gin","month: 2023-12-01<br />monthly_bottles_sold:   50188<br />liquor_type: Gin","month: 2024-01-01<br />monthly_bottles_sold:   41954<br />liquor_type: Gin","month: 2024-02-01<br />monthly_bottles_sold:   46790<br />liquor_type: Gin","month: 2024-03-01<br />monthly_bottles_sold:   43024<br />liquor_type: Gin","month: 2024-04-01<br />monthly_bottles_sold:   51642<br />liquor_type: Gin","month: 2024-05-01<br />monthly_bottles_sold:   56171<br />liquor_type: Gin","month: 2024-06-01<br />monthly_bottles_sold:   53640<br />liquor_type: Gin","month: 2024-07-01<br />monthly_bottles_sold:   55292<br />liquor_type: Gin","month: 2024-08-01<br />monthly_bottles_sold:   55385<br />liquor_type: Gin","month: 2024-09-01<br />monthly_bottles_sold:   49215<br />liquor_type: Gin","month: 2024-10-01<br />monthly_bottles_sold:   50507<br />liquor_type: Gin","month: 2024-11-01<br />monthly_bottles_sold:   42526<br />liquor_type: Gin"],"type":"scatter","mode":"lines+markers","line":{"width":1.8897637795275593,"color":"rgba(163,165,0,1)","dash":"solid"},"hoveron":"points","name":"Gin","legendgroup":"Gin","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(163,165,0,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(163,165,0,1)"}},"frame":null},{"x":[1470009600,1472688000,1475280000,1477958400,1480550400,1483228800,1485907200,1488326400,1491004800,1493596800,1496275200,1498867200,1501545600,1504224000,1506816000,1509494400,1512086400,1514764800,1517443200,1519862400,1522540800,1525132800,1527811200,1530403200,1533081600,1535760000,1538352000,1541030400,1543622400,1546300800,1548979200,1551398400,1554076800,1556668800,1559347200,1561939200,1564617600,1567296000,1569888000,1572566400,1575158400,1577836800,1580515200,1583020800,1585699200,1588291200,1590969600,1593561600,1596240000,1598918400,1601510400,1604188800,1606780800,1609459200,1612137600,1614556800,1617235200,1619827200,1622505600,1625097600,1627776000,1630454400,1633046400,1635724800,1638316800,1640995200,1643673600,1646092800,1648771200,1651363200,1654041600,1656633600,1659312000,1661990400,1664582400,1667260800,1669852800,1672531200,1675209600,1677628800,1680307200,1682899200,1685577600,1688169600,1690848000,1693526400,1696118400,1698796800,1701388800,1704067200,1706745600,1709251200,1711929600,1714521600,1717200000,1719792000,1722470400,1725148800,1727740800,1730419200],"y":[16,133,100,161,372,220,242,378,251,356,350,267,291,282,232,190,313,234,225,228,403,433,372,361,282,312,429,380,517,334,252,310,503,559,363,592,402,496,602,572,695,561,712,518,590,659,679,815,555,724,1686,677,844,633,782,1008,1126,901,1188,1152,1380,1173,1442,1345,1108,735,1366,1071,1210,1608,1385,1524,1459,1282,1269,1267,1284,1145,1055,1334,1290,1555,1299,1425,1241,1280,1357,1258,1328,951,1123,1178,1281,1512,1201,1403,1298,996,1223,1055],"text":["month: 2016-08-01<br />monthly_bottles_sold:      16<br />liquor_type: Mezcal","month: 2016-09-01<br />monthly_bottles_sold:     133<br />liquor_type: Mezcal","month: 2016-10-01<br />monthly_bottles_sold:     100<br />liquor_type: Mezcal","month: 2016-11-01<br />monthly_bottles_sold:     161<br />liquor_type: Mezcal","month: 2016-12-01<br />monthly_bottles_sold:     372<br />liquor_type: Mezcal","month: 2017-01-01<br />monthly_bottles_sold:     220<br />liquor_type: Mezcal","month: 2017-02-01<br />monthly_bottles_sold:     242<br />liquor_type: Mezcal","month: 2017-03-01<br />monthly_bottles_sold:     378<br />liquor_type: Mezcal","month: 2017-04-01<br />monthly_bottles_sold:     251<br />liquor_type: Mezcal","month: 2017-05-01<br />monthly_bottles_sold:     356<br />liquor_type: Mezcal","month: 2017-06-01<br />monthly_bottles_sold:     350<br />liquor_type: Mezcal","month: 2017-07-01<br />monthly_bottles_sold:     267<br />liquor_type: Mezcal","month: 2017-08-01<br />monthly_bottles_sold:     291<br />liquor_type: Mezcal","month: 2017-09-01<br />monthly_bottles_sold:     282<br />liquor_type: Mezcal","month: 2017-10-01<br />monthly_bottles_sold:     232<br />liquor_type: Mezcal","month: 2017-11-01<br />monthly_bottles_sold:     190<br />liquor_type: Mezcal","month: 2017-12-01<br />monthly_bottles_sold:     313<br />liquor_type: Mezcal","month: 2018-01-01<br />monthly_bottles_sold:     234<br />liquor_type: Mezcal","month: 2018-02-01<br />monthly_bottles_sold:     225<br />liquor_type: Mezcal","month: 2018-03-01<br />monthly_bottles_sold:     228<br />liquor_type: Mezcal","month: 2018-04-01<br />monthly_bottles_sold:     403<br />liquor_type: Mezcal","month: 2018-05-01<br />monthly_bottles_sold:     433<br />liquor_type: Mezcal","month: 2018-06-01<br />monthly_bottles_sold:     372<br />liquor_type: Mezcal","month: 2018-07-01<br />monthly_bottles_sold:     361<br />liquor_type: Mezcal","month: 2018-08-01<br />monthly_bottles_sold:     282<br />liquor_type: Mezcal","month: 2018-09-01<br />monthly_bottles_sold:     312<br />liquor_type: Mezcal","month: 2018-10-01<br />monthly_bottles_sold:     429<br />liquor_type: Mezcal","month: 2018-11-01<br />monthly_bottles_sold:     380<br />liquor_type: Mezcal","month: 2018-12-01<br />monthly_bottles_sold:     517<br />liquor_type: Mezcal","month: 2019-01-01<br />monthly_bottles_sold:     334<br />liquor_type: Mezcal","month: 2019-02-01<br />monthly_bottles_sold:     252<br />liquor_type: Mezcal","month: 2019-03-01<br />monthly_bottles_sold:     310<br />liquor_type: Mezcal","month: 2019-04-01<br />monthly_bottles_sold:     503<br />liquor_type: Mezcal","month: 2019-05-01<br />monthly_bottles_sold:     559<br />liquor_type: Mezcal","month: 2019-06-01<br />monthly_bottles_sold:     363<br />liquor_type: Mezcal","month: 2019-07-01<br />monthly_bottles_sold:     592<br />liquor_type: Mezcal","month: 2019-08-01<br />monthly_bottles_sold:     402<br />liquor_type: Mezcal","month: 2019-09-01<br />monthly_bottles_sold:     496<br />liquor_type: Mezcal","month: 2019-10-01<br />monthly_bottles_sold:     602<br />liquor_type: Mezcal","month: 2019-11-01<br />monthly_bottles_sold:     572<br />liquor_type: Mezcal","month: 2019-12-01<br />monthly_bottles_sold:     695<br />liquor_type: Mezcal","month: 2020-01-01<br />monthly_bottles_sold:     561<br />liquor_type: Mezcal","month: 2020-02-01<br />monthly_bottles_sold:     712<br />liquor_type: Mezcal","month: 2020-03-01<br />monthly_bottles_sold:     518<br />liquor_type: Mezcal","month: 2020-04-01<br />monthly_bottles_sold:     590<br />liquor_type: Mezcal","month: 2020-05-01<br />monthly_bottles_sold:     659<br />liquor_type: Mezcal","month: 2020-06-01<br />monthly_bottles_sold:     679<br />liquor_type: Mezcal","month: 2020-07-01<br />monthly_bottles_sold:     815<br />liquor_type: Mezcal","month: 2020-08-01<br />monthly_bottles_sold:     555<br />liquor_type: Mezcal","month: 2020-09-01<br />monthly_bottles_sold:     724<br />liquor_type: Mezcal","month: 2020-10-01<br />monthly_bottles_sold:    1686<br />liquor_type: Mezcal","month: 2020-11-01<br />monthly_bottles_sold:     677<br />liquor_type: Mezcal","month: 2020-12-01<br />monthly_bottles_sold:     844<br />liquor_type: Mezcal","month: 2021-01-01<br />monthly_bottles_sold:     633<br />liquor_type: Mezcal","month: 2021-02-01<br />monthly_bottles_sold:     782<br />liquor_type: Mezcal","month: 2021-03-01<br />monthly_bottles_sold:    1008<br />liquor_type: Mezcal","month: 2021-04-01<br />monthly_bottles_sold:    1126<br />liquor_type: Mezcal","month: 2021-05-01<br />monthly_bottles_sold:     901<br />liquor_type: Mezcal","month: 2021-06-01<br />monthly_bottles_sold:    1188<br />liquor_type: Mezcal","month: 2021-07-01<br />monthly_bottles_sold:    1152<br />liquor_type: Mezcal","month: 2021-08-01<br />monthly_bottles_sold:    1380<br />liquor_type: Mezcal","month: 2021-09-01<br />monthly_bottles_sold:    1173<br />liquor_type: Mezcal","month: 2021-10-01<br />monthly_bottles_sold:    1442<br />liquor_type: Mezcal","month: 2021-11-01<br />monthly_bottles_sold:    1345<br />liquor_type: Mezcal","month: 2021-12-01<br />monthly_bottles_sold:    1108<br />liquor_type: Mezcal","month: 2022-01-01<br />monthly_bottles_sold:     735<br />liquor_type: Mezcal","month: 2022-02-01<br />monthly_bottles_sold:    1366<br />liquor_type: Mezcal","month: 2022-03-01<br />monthly_bottles_sold:    1071<br />liquor_type: Mezcal","month: 2022-04-01<br />monthly_bottles_sold:    1210<br />liquor_type: Mezcal","month: 2022-05-01<br />monthly_bottles_sold:    1608<br />liquor_type: Mezcal","month: 2022-06-01<br />monthly_bottles_sold:    1385<br />liquor_type: Mezcal","month: 2022-07-01<br />monthly_bottles_sold:    1524<br />liquor_type: Mezcal","month: 2022-08-01<br />monthly_bottles_sold:    1459<br />liquor_type: Mezcal","month: 2022-09-01<br />monthly_bottles_sold:    1282<br />liquor_type: Mezcal","month: 2022-10-01<br />monthly_bottles_sold:    1269<br />liquor_type: Mezcal","month: 2022-11-01<br />monthly_bottles_sold:    1267<br />liquor_type: Mezcal","month: 2022-12-01<br />monthly_bottles_sold:    1284<br />liquor_type: Mezcal","month: 2023-01-01<br />monthly_bottles_sold:    1145<br />liquor_type: Mezcal","month: 2023-02-01<br />monthly_bottles_sold:    1055<br />liquor_type: Mezcal","month: 2023-03-01<br />monthly_bottles_sold:    1334<br />liquor_type: Mezcal","month: 2023-04-01<br />monthly_bottles_sold:    1290<br />liquor_type: Mezcal","month: 2023-05-01<br />monthly_bottles_sold:    1555<br />liquor_type: Mezcal","month: 2023-06-01<br />monthly_bottles_sold:    1299<br />liquor_type: Mezcal","month: 2023-07-01<br />monthly_bottles_sold:    1425<br />liquor_type: Mezcal","month: 2023-08-01<br />monthly_bottles_sold:    1241<br />liquor_type: Mezcal","month: 2023-09-01<br />monthly_bottles_sold:    1280<br />liquor_type: Mezcal","month: 2023-10-01<br />monthly_bottles_sold:    1357<br />liquor_type: Mezcal","month: 2023-11-01<br />monthly_bottles_sold:    1258<br />liquor_type: Mezcal","month: 2023-12-01<br />monthly_bottles_sold:    1328<br />liquor_type: Mezcal","month: 2024-01-01<br />monthly_bottles_sold:     951<br />liquor_type: Mezcal","month: 2024-02-01<br />monthly_bottles_sold:    1123<br />liquor_type: Mezcal","month: 2024-03-01<br />monthly_bottles_sold:    1178<br />liquor_type: Mezcal","month: 2024-04-01<br />monthly_bottles_sold:    1281<br />liquor_type: Mezcal","month: 2024-05-01<br />monthly_bottles_sold:    1512<br />liquor_type: Mezcal","month: 2024-06-01<br />monthly_bottles_sold:    1201<br />liquor_type: Mezcal","month: 2024-07-01<br />monthly_bottles_sold:    1403<br />liquor_type: Mezcal","month: 2024-08-01<br />monthly_bottles_sold:    1298<br />liquor_type: Mezcal","month: 2024-09-01<br />monthly_bottles_sold:     996<br />liquor_type: Mezcal","month: 2024-10-01<br />monthly_bottles_sold:    1223<br />liquor_type: Mezcal","month: 2024-11-01<br />monthly_bottles_sold:    1055<br />liquor_type: Mezcal"],"type":"scatter","mode":"lines+markers","line":{"width":1.8897637795275593,"color":"rgba(57,182,0,1)","dash":"solid"},"hoveron":"points","name":"Mezcal","legendgroup":"Mezcal","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(57,182,0,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(57,182,0,1)"}},"frame":null},{"x":[1325376000,1328054400,1330560000,1333238400,1335830400,1338508800,1341100800,1343779200,1346457600,1349049600,1351728000,1354320000,1356998400,1359676800,1362096000,1364774400,1367366400,1370044800,1372636800,1375315200,1377993600,1380585600,1383264000,1385856000,1388534400,1391212800,1393632000,1396310400,1398902400,1401580800,1404172800,1406851200,1409529600,1412121600,1414800000,1417392000,1420070400,1422748800,1425168000,1427846400,1430438400,1433116800,1435708800,1438387200,1441065600,1443657600,1446336000,1448928000,1451606400,1454284800,1456790400,1459468800,1462060800,1464739200,1467331200,1470009600,1472688000,1475280000,1477958400,1480550400,1483228800,1485907200,1488326400,1491004800,1493596800,1496275200,1498867200,1501545600,1504224000,1506816000,1509494400,1512086400,1514764800,1517443200,1519862400,1522540800,1525132800,1527811200,1530403200,1533081600,1535760000,1538352000,1541030400,1543622400,1546300800,1548979200,1551398400,1554076800,1556668800,1559347200,1561939200,1564617600,1567296000,1569888000,1572566400,1575158400,1577836800,1580515200,1583020800,1585699200,1588291200,1590969600,1593561600,1596240000,1598918400,1601510400,1604188800,1606780800,1609459200,1612137600,1614556800,1617235200,1619827200,1622505600,1625097600,1627776000,1630454400,1633046400,1635724800,1638316800,1640995200,1643673600,1646092800,1648771200,1651363200,1654041600,1656633600,1659312000,1661990400,1664582400,1667260800,1669852800,1672531200,1675209600,1677628800,1680307200,1682899200,1685577600,1688169600,1690848000,1693526400,1696118400,1698796800,1701388800,1704067200,1706745600,1709251200,1711929600,1714521600,1717200000,1719792000,1722470400,1725148800,1727740800,1730419200],"y":[138041,148163,147223,189308,183443,199074,177243,171041,121965,281677,153394,198823,126478,125665,136914,189586,165569,162705,190421,155764,131424,266600,130010,176308,132169,126215,127106,164015,161854,170872,161491,142960,151552,185464,161981,215588,117362,129328,137996,165369,147162,185389,147684,134776,133433,173548,152452,192687,114648,158420,136101,160672,155841,172769,130765,130996,181685,229991,220410,263381,171097,175200,221251,248570,256171,286199,223500,256991,196950,302451,252395,266430,220128,208468,246937,304204,319941,300369,270880,310863,240927,234831,184284,211771,142833,143626,170068,240175,237871,181245,207318,181846,182404,234660,216771,227820,156514,167846,216403,278320,275120,320827,259793,274118,265163,298184,256615,287789,210354,193571,288667,311969,269848,321794,258679,250776,282471,279398,304087,319246,197095,208575,258492,330489,270605,290842,269188,285661,316617,318017,300465,311068,229260,208010,253787,256807,275629,289484,238696,269549,275757,303327,272692,281570,237571,216826,255058,318803,288069,266217,264100,247737,305823,342305,330562],"text":["month: 2012-01-01<br />monthly_bottles_sold:  138041<br />liquor_type: Other","month: 2012-02-01<br />monthly_bottles_sold:  148163<br />liquor_type: Other","month: 2012-03-01<br />monthly_bottles_sold:  147223<br />liquor_type: Other","month: 2012-04-01<br />monthly_bottles_sold:  189308<br />liquor_type: Other","month: 2012-05-01<br />monthly_bottles_sold:  183443<br />liquor_type: Other","month: 2012-06-01<br />monthly_bottles_sold:  199074<br />liquor_type: Other","month: 2012-07-01<br />monthly_bottles_sold:  177243<br />liquor_type: Other","month: 2012-08-01<br />monthly_bottles_sold:  171041<br />liquor_type: Other","month: 2012-09-01<br />monthly_bottles_sold:  121965<br />liquor_type: Other","month: 2012-10-01<br />monthly_bottles_sold:  281677<br />liquor_type: Other","month: 2012-11-01<br />monthly_bottles_sold:  153394<br />liquor_type: Other","month: 2012-12-01<br />monthly_bottles_sold:  198823<br />liquor_type: Other","month: 2013-01-01<br />monthly_bottles_sold:  126478<br />liquor_type: Other","month: 2013-02-01<br />monthly_bottles_sold:  125665<br />liquor_type: Other","month: 2013-03-01<br />monthly_bottles_sold:  136914<br />liquor_type: Other","month: 2013-04-01<br />monthly_bottles_sold:  189586<br />liquor_type: Other","month: 2013-05-01<br />monthly_bottles_sold:  165569<br />liquor_type: Other","month: 2013-06-01<br />monthly_bottles_sold:  162705<br />liquor_type: Other","month: 2013-07-01<br />monthly_bottles_sold:  190421<br />liquor_type: Other","month: 2013-08-01<br />monthly_bottles_sold:  155764<br />liquor_type: Other","month: 2013-09-01<br />monthly_bottles_sold:  131424<br />liquor_type: Other","month: 2013-10-01<br />monthly_bottles_sold:  266600<br />liquor_type: Other","month: 2013-11-01<br />monthly_bottles_sold:  130010<br />liquor_type: Other","month: 2013-12-01<br />monthly_bottles_sold:  176308<br />liquor_type: Other","month: 2014-01-01<br />monthly_bottles_sold:  132169<br />liquor_type: Other","month: 2014-02-01<br />monthly_bottles_sold:  126215<br />liquor_type: Other","month: 2014-03-01<br />monthly_bottles_sold:  127106<br />liquor_type: Other","month: 2014-04-01<br />monthly_bottles_sold:  164015<br />liquor_type: Other","month: 2014-05-01<br />monthly_bottles_sold:  161854<br />liquor_type: Other","month: 2014-06-01<br />monthly_bottles_sold:  170872<br />liquor_type: Other","month: 2014-07-01<br />monthly_bottles_sold:  161491<br />liquor_type: Other","month: 2014-08-01<br />monthly_bottles_sold:  142960<br />liquor_type: Other","month: 2014-09-01<br />monthly_bottles_sold:  151552<br />liquor_type: Other","month: 2014-10-01<br />monthly_bottles_sold:  185464<br />liquor_type: Other","month: 2014-11-01<br />monthly_bottles_sold:  161981<br />liquor_type: Other","month: 2014-12-01<br />monthly_bottles_sold:  215588<br />liquor_type: Other","month: 2015-01-01<br />monthly_bottles_sold:  117362<br />liquor_type: Other","month: 2015-02-01<br />monthly_bottles_sold:  129328<br />liquor_type: Other","month: 2015-03-01<br />monthly_bottles_sold:  137996<br />liquor_type: Other","month: 2015-04-01<br />monthly_bottles_sold:  165369<br />liquor_type: Other","month: 2015-05-01<br />monthly_bottles_sold:  147162<br />liquor_type: Other","month: 2015-06-01<br />monthly_bottles_sold:  185389<br />liquor_type: Other","month: 2015-07-01<br />monthly_bottles_sold:  147684<br />liquor_type: Other","month: 2015-08-01<br />monthly_bottles_sold:  134776<br />liquor_type: Other","month: 2015-09-01<br />monthly_bottles_sold:  133433<br />liquor_type: Other","month: 2015-10-01<br />monthly_bottles_sold:  173548<br />liquor_type: Other","month: 2015-11-01<br />monthly_bottles_sold:  152452<br />liquor_type: Other","month: 2015-12-01<br />monthly_bottles_sold:  192687<br />liquor_type: Other","month: 2016-01-01<br />monthly_bottles_sold:  114648<br />liquor_type: Other","month: 2016-02-01<br />monthly_bottles_sold:  158420<br />liquor_type: Other","month: 2016-03-01<br />monthly_bottles_sold:  136101<br />liquor_type: Other","month: 2016-04-01<br />monthly_bottles_sold:  160672<br />liquor_type: Other","month: 2016-05-01<br />monthly_bottles_sold:  155841<br />liquor_type: Other","month: 2016-06-01<br />monthly_bottles_sold:  172769<br />liquor_type: Other","month: 2016-07-01<br />monthly_bottles_sold:  130765<br />liquor_type: Other","month: 2016-08-01<br />monthly_bottles_sold:  130996<br />liquor_type: Other","month: 2016-09-01<br />monthly_bottles_sold:  181685<br />liquor_type: Other","month: 2016-10-01<br />monthly_bottles_sold:  229991<br />liquor_type: Other","month: 2016-11-01<br />monthly_bottles_sold:  220410<br />liquor_type: Other","month: 2016-12-01<br />monthly_bottles_sold:  263381<br />liquor_type: Other","month: 2017-01-01<br />monthly_bottles_sold:  171097<br />liquor_type: Other","month: 2017-02-01<br />monthly_bottles_sold:  175200<br />liquor_type: Other","month: 2017-03-01<br />monthly_bottles_sold:  221251<br />liquor_type: Other","month: 2017-04-01<br />monthly_bottles_sold:  248570<br />liquor_type: Other","month: 2017-05-01<br />monthly_bottles_sold:  256171<br />liquor_type: Other","month: 2017-06-01<br />monthly_bottles_sold:  286199<br />liquor_type: Other","month: 2017-07-01<br />monthly_bottles_sold:  223500<br />liquor_type: Other","month: 2017-08-01<br />monthly_bottles_sold:  256991<br />liquor_type: Other","month: 2017-09-01<br />monthly_bottles_sold:  196950<br />liquor_type: Other","month: 2017-10-01<br />monthly_bottles_sold:  302451<br />liquor_type: Other","month: 2017-11-01<br />monthly_bottles_sold:  252395<br />liquor_type: Other","month: 2017-12-01<br />monthly_bottles_sold:  266430<br />liquor_type: Other","month: 2018-01-01<br />monthly_bottles_sold:  220128<br />liquor_type: Other","month: 2018-02-01<br />monthly_bottles_sold:  208468<br />liquor_type: Other","month: 2018-03-01<br />monthly_bottles_sold:  246937<br />liquor_type: Other","month: 2018-04-01<br />monthly_bottles_sold:  304204<br />liquor_type: Other","month: 2018-05-01<br />monthly_bottles_sold:  319941<br />liquor_type: Other","month: 2018-06-01<br />monthly_bottles_sold:  300369<br />liquor_type: Other","month: 2018-07-01<br />monthly_bottles_sold:  270880<br />liquor_type: Other","month: 2018-08-01<br />monthly_bottles_sold:  310863<br />liquor_type: Other","month: 2018-09-01<br />monthly_bottles_sold:  240927<br />liquor_type: Other","month: 2018-10-01<br />monthly_bottles_sold:  234831<br />liquor_type: Other","month: 2018-11-01<br />monthly_bottles_sold:  184284<br />liquor_type: Other","month: 2018-12-01<br />monthly_bottles_sold:  211771<br />liquor_type: Other","month: 2019-01-01<br />monthly_bottles_sold:  142833<br />liquor_type: Other","month: 2019-02-01<br />monthly_bottles_sold:  143626<br />liquor_type: Other","month: 2019-03-01<br />monthly_bottles_sold:  170068<br />liquor_type: Other","month: 2019-04-01<br />monthly_bottles_sold:  240175<br />liquor_type: Other","month: 2019-05-01<br />monthly_bottles_sold:  237871<br />liquor_type: Other","month: 2019-06-01<br />monthly_bottles_sold:  181245<br />liquor_type: Other","month: 2019-07-01<br />monthly_bottles_sold:  207318<br />liquor_type: Other","month: 2019-08-01<br />monthly_bottles_sold:  181846<br />liquor_type: Other","month: 2019-09-01<br />monthly_bottles_sold:  182404<br />liquor_type: Other","month: 2019-10-01<br />monthly_bottles_sold:  234660<br />liquor_type: Other","month: 2019-11-01<br />monthly_bottles_sold:  216771<br />liquor_type: Other","month: 2019-12-01<br />monthly_bottles_sold:  227820<br />liquor_type: Other","month: 2020-01-01<br />monthly_bottles_sold:  156514<br />liquor_type: Other","month: 2020-02-01<br />monthly_bottles_sold:  167846<br />liquor_type: Other","month: 2020-03-01<br />monthly_bottles_sold:  216403<br />liquor_type: Other","month: 2020-04-01<br />monthly_bottles_sold:  278320<br />liquor_type: Other","month: 2020-05-01<br />monthly_bottles_sold:  275120<br />liquor_type: Other","month: 2020-06-01<br />monthly_bottles_sold:  320827<br />liquor_type: Other","month: 2020-07-01<br />monthly_bottles_sold:  259793<br />liquor_type: Other","month: 2020-08-01<br />monthly_bottles_sold:  274118<br />liquor_type: Other","month: 2020-09-01<br />monthly_bottles_sold:  265163<br />liquor_type: Other","month: 2020-10-01<br />monthly_bottles_sold:  298184<br />liquor_type: Other","month: 2020-11-01<br />monthly_bottles_sold:  256615<br />liquor_type: Other","month: 2020-12-01<br />monthly_bottles_sold:  287789<br />liquor_type: Other","month: 2021-01-01<br />monthly_bottles_sold:  210354<br />liquor_type: Other","month: 2021-02-01<br />monthly_bottles_sold:  193571<br />liquor_type: Other","month: 2021-03-01<br />monthly_bottles_sold:  288667<br />liquor_type: Other","month: 2021-04-01<br />monthly_bottles_sold:  311969<br />liquor_type: Other","month: 2021-05-01<br />monthly_bottles_sold:  269848<br />liquor_type: Other","month: 2021-06-01<br />monthly_bottles_sold:  321794<br />liquor_type: Other","month: 2021-07-01<br />monthly_bottles_sold:  258679<br />liquor_type: Other","month: 2021-08-01<br />monthly_bottles_sold:  250776<br />liquor_type: Other","month: 2021-09-01<br />monthly_bottles_sold:  282471<br />liquor_type: Other","month: 2021-10-01<br />monthly_bottles_sold:  279398<br />liquor_type: Other","month: 2021-11-01<br />monthly_bottles_sold:  304087<br />liquor_type: Other","month: 2021-12-01<br />monthly_bottles_sold:  319246<br />liquor_type: Other","month: 2022-01-01<br />monthly_bottles_sold:  197095<br />liquor_type: Other","month: 2022-02-01<br />monthly_bottles_sold:  208575<br />liquor_type: Other","month: 2022-03-01<br />monthly_bottles_sold:  258492<br />liquor_type: Other","month: 2022-04-01<br />monthly_bottles_sold:  330489<br />liquor_type: Other","month: 2022-05-01<br />monthly_bottles_sold:  270605<br />liquor_type: Other","month: 2022-06-01<br />monthly_bottles_sold:  290842<br />liquor_type: Other","month: 2022-07-01<br />monthly_bottles_sold:  269188<br />liquor_type: Other","month: 2022-08-01<br />monthly_bottles_sold:  285661<br />liquor_type: Other","month: 2022-09-01<br />monthly_bottles_sold:  316617<br />liquor_type: Other","month: 2022-10-01<br />monthly_bottles_sold:  318017<br />liquor_type: Other","month: 2022-11-01<br />monthly_bottles_sold:  300465<br />liquor_type: Other","month: 2022-12-01<br />monthly_bottles_sold:  311068<br />liquor_type: Other","month: 2023-01-01<br />monthly_bottles_sold:  229260<br />liquor_type: Other","month: 2023-02-01<br />monthly_bottles_sold:  208010<br />liquor_type: Other","month: 2023-03-01<br />monthly_bottles_sold:  253787<br />liquor_type: Other","month: 2023-04-01<br />monthly_bottles_sold:  256807<br />liquor_type: Other","month: 2023-05-01<br />monthly_bottles_sold:  275629<br />liquor_type: Other","month: 2023-06-01<br />monthly_bottles_sold:  289484<br />liquor_type: Other","month: 2023-07-01<br />monthly_bottles_sold:  238696<br />liquor_type: Other","month: 2023-08-01<br />monthly_bottles_sold:  269549<br />liquor_type: Other","month: 2023-09-01<br />monthly_bottles_sold:  275757<br />liquor_type: Other","month: 2023-10-01<br />monthly_bottles_sold:  303327<br />liquor_type: Other","month: 2023-11-01<br />monthly_bottles_sold:  272692<br />liquor_type: Other","month: 2023-12-01<br />monthly_bottles_sold:  281570<br />liquor_type: Other","month: 2024-01-01<br />monthly_bottles_sold:  237571<br />liquor_type: Other","month: 2024-02-01<br />monthly_bottles_sold:  216826<br />liquor_type: Other","month: 2024-03-01<br />monthly_bottles_sold:  255058<br />liquor_type: Other","month: 2024-04-01<br />monthly_bottles_sold:  318803<br />liquor_type: Other","month: 2024-05-01<br />monthly_bottles_sold:  288069<br />liquor_type: Other","month: 2024-06-01<br />monthly_bottles_sold:  266217<br />liquor_type: Other","month: 2024-07-01<br />monthly_bottles_sold:  264100<br />liquor_type: Other","month: 2024-08-01<br />monthly_bottles_sold:  247737<br />liquor_type: Other","month: 2024-09-01<br />monthly_bottles_sold:  305823<br />liquor_type: Other","month: 2024-10-01<br />monthly_bottles_sold:  342305<br />liquor_type: Other","month: 2024-11-01<br />monthly_bottles_sold:  330562<br />liquor_type: Other"],"type":"scatter","mode":"lines+markers","line":{"width":1.8897637795275593,"color":"rgba(0,191,125,1)","dash":"solid"},"hoveron":"points","name":"Other","legendgroup":"Other","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(0,191,125,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,125,1)"}},"frame":null},{"x":[1325376000,1328054400,1330560000,1333238400,1335830400,1338508800,1341100800,1343779200,1346457600,1349049600,1351728000,1354320000,1356998400,1359676800,1362096000,1364774400,1367366400,1370044800,1372636800,1375315200,1377993600,1380585600,1383264000,1385856000,1388534400,1391212800,1393632000,1396310400,1398902400,1401580800,1404172800,1406851200,1409529600,1412121600,1414800000,1417392000,1420070400,1422748800,1425168000,1427846400,1430438400,1433116800,1435708800,1438387200,1441065600,1443657600,1446336000,1448928000,1451606400,1454284800,1456790400,1459468800,1462060800,1464739200,1467331200,1470009600,1472688000,1475280000,1477958400,1480550400,1483228800,1485907200,1488326400,1491004800,1493596800,1496275200,1498867200,1501545600,1504224000,1506816000,1509494400,1512086400,1514764800,1517443200,1519862400,1522540800,1525132800,1527811200,1530403200,1533081600,1535760000,1538352000,1541030400,1543622400,1546300800,1548979200,1551398400,1554076800,1556668800,1559347200,1561939200,1564617600,1567296000,1569888000,1572566400,1575158400,1577836800,1580515200,1583020800,1585699200,1588291200,1590969600,1593561600,1596240000,1598918400,1601510400,1604188800,1606780800,1609459200,1612137600,1614556800,1617235200,1619827200,1622505600,1625097600,1627776000,1630454400,1633046400,1635724800,1638316800,1640995200,1643673600,1646092800,1648771200,1651363200,1654041600,1656633600,1659312000,1661990400,1664582400,1667260800,1669852800,1672531200,1675209600,1677628800,1680307200,1682899200,1685577600,1688169600,1690848000,1693526400,1696118400,1698796800,1701388800,1704067200,1706745600,1709251200,1711929600,1714521600,1717200000,1719792000,1722470400,1725148800,1727740800,1730419200],"y":[180254,195347,208190,214784,258237,263647,228995,226326,211837,297514,206307,273794,193775,175897,191208,238732,248508,215594,255209,217931,190682,304552,177362,263435,207230,181066,204815,228121,216576,249442,225592,218118,224940,245834,179778,277159,181833,205722,215047,221646,210794,258296,226340,214399,232060,230119,201475,273155,175008,202736,217426,203546,246702,257846,211715,205196,221761,223883,219142,264108,177191,183087,227909,195961,248050,254804,232709,241731,202717,238157,211305,244854,197642,185060,228413,198361,268484,249358,206583,273249,177774,249761,215983,247974,192293,190664,223169,209917,262881,222425,246032,218369,199476,254088,207187,239956,193137,183955,229950,239212,216352,252539,258031,222083,247849,240986,221147,250708,196455,194788,247329,235475,219606,260350,268075,237728,240455,242066,255984,278896,178742,174937,208733,200837,230817,249191,212542,245154,228939,210274,247650,231624,200921,175853,264507,191091,231900,259606,212837,214570,199280,202061,259622,202972,184901,174604,210508,187301,218547,217926,209742,193647,178891,205951,243080],"text":["month: 2012-01-01<br />monthly_bottles_sold:  180254<br />liquor_type: Rum","month: 2012-02-01<br />monthly_bottles_sold:  195347<br />liquor_type: Rum","month: 2012-03-01<br />monthly_bottles_sold:  208190<br />liquor_type: Rum","month: 2012-04-01<br />monthly_bottles_sold:  214784<br />liquor_type: Rum","month: 2012-05-01<br />monthly_bottles_sold:  258237<br />liquor_type: Rum","month: 2012-06-01<br />monthly_bottles_sold:  263647<br />liquor_type: Rum","month: 2012-07-01<br />monthly_bottles_sold:  228995<br />liquor_type: Rum","month: 2012-08-01<br />monthly_bottles_sold:  226326<br />liquor_type: Rum","month: 2012-09-01<br />monthly_bottles_sold:  211837<br />liquor_type: Rum","month: 2012-10-01<br />monthly_bottles_sold:  297514<br />liquor_type: Rum","month: 2012-11-01<br />monthly_bottles_sold:  206307<br />liquor_type: Rum","month: 2012-12-01<br />monthly_bottles_sold:  273794<br />liquor_type: Rum","month: 2013-01-01<br />monthly_bottles_sold:  193775<br />liquor_type: Rum","month: 2013-02-01<br />monthly_bottles_sold:  175897<br />liquor_type: Rum","month: 2013-03-01<br />monthly_bottles_sold:  191208<br />liquor_type: Rum","month: 2013-04-01<br />monthly_bottles_sold:  238732<br />liquor_type: Rum","month: 2013-05-01<br />monthly_bottles_sold:  248508<br />liquor_type: Rum","month: 2013-06-01<br />monthly_bottles_sold:  215594<br />liquor_type: Rum","month: 2013-07-01<br />monthly_bottles_sold:  255209<br />liquor_type: Rum","month: 2013-08-01<br />monthly_bottles_sold:  217931<br />liquor_type: Rum","month: 2013-09-01<br />monthly_bottles_sold:  190682<br />liquor_type: Rum","month: 2013-10-01<br />monthly_bottles_sold:  304552<br />liquor_type: Rum","month: 2013-11-01<br />monthly_bottles_sold:  177362<br />liquor_type: Rum","month: 2013-12-01<br />monthly_bottles_sold:  263435<br />liquor_type: Rum","month: 2014-01-01<br />monthly_bottles_sold:  207230<br />liquor_type: Rum","month: 2014-02-01<br />monthly_bottles_sold:  181066<br />liquor_type: Rum","month: 2014-03-01<br />monthly_bottles_sold:  204815<br />liquor_type: Rum","month: 2014-04-01<br />monthly_bottles_sold:  228121<br />liquor_type: Rum","month: 2014-05-01<br />monthly_bottles_sold:  216576<br />liquor_type: Rum","month: 2014-06-01<br />monthly_bottles_sold:  249442<br />liquor_type: Rum","month: 2014-07-01<br />monthly_bottles_sold:  225592<br />liquor_type: Rum","month: 2014-08-01<br />monthly_bottles_sold:  218118<br />liquor_type: Rum","month: 2014-09-01<br />monthly_bottles_sold:  224940<br />liquor_type: Rum","month: 2014-10-01<br />monthly_bottles_sold:  245834<br />liquor_type: Rum","month: 2014-11-01<br />monthly_bottles_sold:  179778<br />liquor_type: Rum","month: 2014-12-01<br />monthly_bottles_sold:  277159<br />liquor_type: Rum","month: 2015-01-01<br />monthly_bottles_sold:  181833<br />liquor_type: Rum","month: 2015-02-01<br />monthly_bottles_sold:  205722<br />liquor_type: Rum","month: 2015-03-01<br />monthly_bottles_sold:  215047<br />liquor_type: Rum","month: 2015-04-01<br />monthly_bottles_sold:  221646<br />liquor_type: Rum","month: 2015-05-01<br />monthly_bottles_sold:  210794<br />liquor_type: Rum","month: 2015-06-01<br />monthly_bottles_sold:  258296<br />liquor_type: Rum","month: 2015-07-01<br />monthly_bottles_sold:  226340<br />liquor_type: Rum","month: 2015-08-01<br />monthly_bottles_sold:  214399<br />liquor_type: Rum","month: 2015-09-01<br />monthly_bottles_sold:  232060<br />liquor_type: Rum","month: 2015-10-01<br />monthly_bottles_sold:  230119<br />liquor_type: Rum","month: 2015-11-01<br />monthly_bottles_sold:  201475<br />liquor_type: Rum","month: 2015-12-01<br />monthly_bottles_sold:  273155<br />liquor_type: Rum","month: 2016-01-01<br />monthly_bottles_sold:  175008<br />liquor_type: Rum","month: 2016-02-01<br />monthly_bottles_sold:  202736<br />liquor_type: Rum","month: 2016-03-01<br />monthly_bottles_sold:  217426<br />liquor_type: Rum","month: 2016-04-01<br />monthly_bottles_sold:  203546<br />liquor_type: Rum","month: 2016-05-01<br />monthly_bottles_sold:  246702<br />liquor_type: Rum","month: 2016-06-01<br />monthly_bottles_sold:  257846<br />liquor_type: Rum","month: 2016-07-01<br />monthly_bottles_sold:  211715<br />liquor_type: Rum","month: 2016-08-01<br />monthly_bottles_sold:  205196<br />liquor_type: Rum","month: 2016-09-01<br />monthly_bottles_sold:  221761<br />liquor_type: Rum","month: 2016-10-01<br />monthly_bottles_sold:  223883<br />liquor_type: Rum","month: 2016-11-01<br />monthly_bottles_sold:  219142<br />liquor_type: Rum","month: 2016-12-01<br />monthly_bottles_sold:  264108<br />liquor_type: Rum","month: 2017-01-01<br />monthly_bottles_sold:  177191<br />liquor_type: Rum","month: 2017-02-01<br />monthly_bottles_sold:  183087<br />liquor_type: Rum","month: 2017-03-01<br />monthly_bottles_sold:  227909<br />liquor_type: Rum","month: 2017-04-01<br />monthly_bottles_sold:  195961<br />liquor_type: Rum","month: 2017-05-01<br />monthly_bottles_sold:  248050<br />liquor_type: Rum","month: 2017-06-01<br />monthly_bottles_sold:  254804<br />liquor_type: Rum","month: 2017-07-01<br />monthly_bottles_sold:  232709<br />liquor_type: Rum","month: 2017-08-01<br />monthly_bottles_sold:  241731<br />liquor_type: Rum","month: 2017-09-01<br />monthly_bottles_sold:  202717<br />liquor_type: Rum","month: 2017-10-01<br />monthly_bottles_sold:  238157<br />liquor_type: Rum","month: 2017-11-01<br />monthly_bottles_sold:  211305<br />liquor_type: Rum","month: 2017-12-01<br />monthly_bottles_sold:  244854<br />liquor_type: Rum","month: 2018-01-01<br />monthly_bottles_sold:  197642<br />liquor_type: Rum","month: 2018-02-01<br />monthly_bottles_sold:  185060<br />liquor_type: Rum","month: 2018-03-01<br />monthly_bottles_sold:  228413<br />liquor_type: Rum","month: 2018-04-01<br />monthly_bottles_sold:  198361<br />liquor_type: Rum","month: 2018-05-01<br />monthly_bottles_sold:  268484<br />liquor_type: Rum","month: 2018-06-01<br />monthly_bottles_sold:  249358<br />liquor_type: Rum","month: 2018-07-01<br />monthly_bottles_sold:  206583<br />liquor_type: Rum","month: 2018-08-01<br />monthly_bottles_sold:  273249<br />liquor_type: Rum","month: 2018-09-01<br />monthly_bottles_sold:  177774<br />liquor_type: Rum","month: 2018-10-01<br />monthly_bottles_sold:  249761<br />liquor_type: Rum","month: 2018-11-01<br />monthly_bottles_sold:  215983<br />liquor_type: Rum","month: 2018-12-01<br />monthly_bottles_sold:  247974<br />liquor_type: Rum","month: 2019-01-01<br />monthly_bottles_sold:  192293<br />liquor_type: Rum","month: 2019-02-01<br />monthly_bottles_sold:  190664<br />liquor_type: Rum","month: 2019-03-01<br />monthly_bottles_sold:  223169<br />liquor_type: Rum","month: 2019-04-01<br />monthly_bottles_sold:  209917<br />liquor_type: Rum","month: 2019-05-01<br />monthly_bottles_sold:  262881<br />liquor_type: Rum","month: 2019-06-01<br />monthly_bottles_sold:  222425<br />liquor_type: Rum","month: 2019-07-01<br />monthly_bottles_sold:  246032<br />liquor_type: Rum","month: 2019-08-01<br />monthly_bottles_sold:  218369<br />liquor_type: Rum","month: 2019-09-01<br />monthly_bottles_sold:  199476<br />liquor_type: Rum","month: 2019-10-01<br />monthly_bottles_sold:  254088<br />liquor_type: Rum","month: 2019-11-01<br />monthly_bottles_sold:  207187<br />liquor_type: Rum","month: 2019-12-01<br />monthly_bottles_sold:  239956<br />liquor_type: Rum","month: 2020-01-01<br />monthly_bottles_sold:  193137<br />liquor_type: Rum","month: 2020-02-01<br />monthly_bottles_sold:  183955<br />liquor_type: Rum","month: 2020-03-01<br />monthly_bottles_sold:  229950<br />liquor_type: Rum","month: 2020-04-01<br />monthly_bottles_sold:  239212<br />liquor_type: Rum","month: 2020-05-01<br />monthly_bottles_sold:  216352<br />liquor_type: Rum","month: 2020-06-01<br />monthly_bottles_sold:  252539<br />liquor_type: Rum","month: 2020-07-01<br />monthly_bottles_sold:  258031<br />liquor_type: Rum","month: 2020-08-01<br />monthly_bottles_sold:  222083<br />liquor_type: Rum","month: 2020-09-01<br />monthly_bottles_sold:  247849<br />liquor_type: Rum","month: 2020-10-01<br />monthly_bottles_sold:  240986<br />liquor_type: Rum","month: 2020-11-01<br />monthly_bottles_sold:  221147<br />liquor_type: Rum","month: 2020-12-01<br />monthly_bottles_sold:  250708<br />liquor_type: Rum","month: 2021-01-01<br />monthly_bottles_sold:  196455<br />liquor_type: Rum","month: 2021-02-01<br />monthly_bottles_sold:  194788<br />liquor_type: Rum","month: 2021-03-01<br />monthly_bottles_sold:  247329<br />liquor_type: Rum","month: 2021-04-01<br />monthly_bottles_sold:  235475<br />liquor_type: Rum","month: 2021-05-01<br />monthly_bottles_sold:  219606<br />liquor_type: Rum","month: 2021-06-01<br />monthly_bottles_sold:  260350<br />liquor_type: Rum","month: 2021-07-01<br />monthly_bottles_sold:  268075<br />liquor_type: Rum","month: 2021-08-01<br />monthly_bottles_sold:  237728<br />liquor_type: Rum","month: 2021-09-01<br />monthly_bottles_sold:  240455<br />liquor_type: Rum","month: 2021-10-01<br />monthly_bottles_sold:  242066<br />liquor_type: Rum","month: 2021-11-01<br />monthly_bottles_sold:  255984<br />liquor_type: Rum","month: 2021-12-01<br />monthly_bottles_sold:  278896<br />liquor_type: Rum","month: 2022-01-01<br />monthly_bottles_sold:  178742<br />liquor_type: Rum","month: 2022-02-01<br />monthly_bottles_sold:  174937<br />liquor_type: Rum","month: 2022-03-01<br />monthly_bottles_sold:  208733<br />liquor_type: Rum","month: 2022-04-01<br />monthly_bottles_sold:  200837<br />liquor_type: Rum","month: 2022-05-01<br />monthly_bottles_sold:  230817<br />liquor_type: Rum","month: 2022-06-01<br />monthly_bottles_sold:  249191<br />liquor_type: Rum","month: 2022-07-01<br />monthly_bottles_sold:  212542<br />liquor_type: Rum","month: 2022-08-01<br />monthly_bottles_sold:  245154<br />liquor_type: Rum","month: 2022-09-01<br />monthly_bottles_sold:  228939<br />liquor_type: Rum","month: 2022-10-01<br />monthly_bottles_sold:  210274<br />liquor_type: Rum","month: 2022-11-01<br />monthly_bottles_sold:  247650<br />liquor_type: Rum","month: 2022-12-01<br />monthly_bottles_sold:  231624<br />liquor_type: Rum","month: 2023-01-01<br />monthly_bottles_sold:  200921<br />liquor_type: Rum","month: 2023-02-01<br />monthly_bottles_sold:  175853<br />liquor_type: Rum","month: 2023-03-01<br />monthly_bottles_sold:  264507<br />liquor_type: Rum","month: 2023-04-01<br />monthly_bottles_sold:  191091<br />liquor_type: Rum","month: 2023-05-01<br />monthly_bottles_sold:  231900<br />liquor_type: Rum","month: 2023-06-01<br />monthly_bottles_sold:  259606<br />liquor_type: Rum","month: 2023-07-01<br />monthly_bottles_sold:  212837<br />liquor_type: Rum","month: 2023-08-01<br />monthly_bottles_sold:  214570<br />liquor_type: Rum","month: 2023-09-01<br />monthly_bottles_sold:  199280<br />liquor_type: Rum","month: 2023-10-01<br />monthly_bottles_sold:  202061<br />liquor_type: Rum","month: 2023-11-01<br />monthly_bottles_sold:  259622<br />liquor_type: Rum","month: 2023-12-01<br />monthly_bottles_sold:  202972<br />liquor_type: Rum","month: 2024-01-01<br />monthly_bottles_sold:  184901<br />liquor_type: Rum","month: 2024-02-01<br />monthly_bottles_sold:  174604<br />liquor_type: Rum","month: 2024-03-01<br />monthly_bottles_sold:  210508<br />liquor_type: Rum","month: 2024-04-01<br />monthly_bottles_sold:  187301<br />liquor_type: Rum","month: 2024-05-01<br />monthly_bottles_sold:  218547<br />liquor_type: Rum","month: 2024-06-01<br />monthly_bottles_sold:  217926<br />liquor_type: Rum","month: 2024-07-01<br />monthly_bottles_sold:  209742<br />liquor_type: Rum","month: 2024-08-01<br />monthly_bottles_sold:  193647<br />liquor_type: Rum","month: 2024-09-01<br />monthly_bottles_sold:  178891<br />liquor_type: Rum","month: 2024-10-01<br />monthly_bottles_sold:  205951<br />liquor_type: Rum","month: 2024-11-01<br />monthly_bottles_sold:  243080<br />liquor_type: Rum"],"type":"scatter","mode":"lines+markers","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Rum","legendgroup":"Rum","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"frame":null},{"x":[1325376000,1328054400,1330560000,1333238400,1335830400,1338508800,1341100800,1343779200,1346457600,1349049600,1351728000,1354320000,1356998400,1359676800,1362096000,1364774400,1367366400,1370044800,1372636800,1375315200,1377993600,1380585600,1383264000,1385856000,1388534400,1391212800,1393632000,1396310400,1398902400,1401580800,1404172800,1406851200,1409529600,1412121600,1414800000,1417392000,1420070400,1422748800,1425168000,1427846400,1430438400,1433116800,1435708800,1438387200,1441065600,1443657600,1446336000,1448928000,1451606400,1454284800,1456790400,1459468800,1462060800,1464739200,1467331200,1470009600,1472688000,1475280000,1477958400,1480550400,1483228800,1485907200,1488326400,1491004800,1493596800,1496275200,1498867200,1501545600,1504224000,1506816000,1509494400,1512086400,1514764800,1517443200,1519862400,1522540800,1525132800,1527811200,1530403200,1533081600,1535760000,1538352000,1541030400,1543622400,1546300800,1548979200,1551398400,1554076800,1556668800,1559347200,1561939200,1564617600,1567296000,1569888000,1572566400,1575158400,1577836800,1580515200,1583020800,1585699200,1588291200,1590969600,1593561600,1596240000,1598918400,1601510400,1604188800,1606780800,1609459200,1612137600,1614556800,1617235200,1619827200,1622505600,1625097600,1627776000,1630454400,1633046400,1635724800,1638316800,1640995200,1643673600,1646092800,1648771200,1651363200,1654041600,1656633600,1659312000,1661990400,1664582400,1667260800,1669852800,1672531200,1675209600,1677628800,1680307200,1682899200,1685577600,1688169600,1690848000,1693526400,1696118400,1698796800,1701388800,1704067200,1706745600,1709251200,1711929600,1714521600,1717200000,1719792000,1722470400,1725148800,1727740800,1730419200],"y":[83489,81681,82690,81478,84511,76449,81880,85097,67428,107777,88702,101991,77128,66988,78576,75262,71425,69656,79092,71475,67064,91159,73170,94789,71668,63844,68347,74685,60638,76854,72768,63959,69565,74296,71691,98330,66401,64587,79996,65065,61671,82867,65587,64282,72909,70251,85074,93350,65434,72180,85036,67091,77704,85701,65559,68207,69396,70021,81922,93284,67311,57862,73554,61045,71969,72697,68099,73073,60281,71181,77456,80188,77779,60964,68154,65787,72939,69182,63834,71553,59272,87137,83307,94623,80227,66149,71439,79595,83694,74333,84785,76835,72101,86780,85863,99055,79695,69528,76626,61821,77658,95975,90689,92029,90188,94840,92213,103758,92357,84657,102407,105923,94873,110381,97260,95456,93067,99207,102784,105439,83145,80020,93820,93776,95227,104764,90465,104832,102541,97055,100962,122653,108386,98684,120926,107844,107024,114244,101177,109653,99031,107078,111516,118140,107143,105012,107616,115896,119264,112649,119127,117034,112208,126954,114480],"text":["month: 2012-01-01<br />monthly_bottles_sold:   83489<br />liquor_type: Schnapps","month: 2012-02-01<br />monthly_bottles_sold:   81681<br />liquor_type: Schnapps","month: 2012-03-01<br />monthly_bottles_sold:   82690<br />liquor_type: Schnapps","month: 2012-04-01<br />monthly_bottles_sold:   81478<br />liquor_type: Schnapps","month: 2012-05-01<br />monthly_bottles_sold:   84511<br />liquor_type: Schnapps","month: 2012-06-01<br />monthly_bottles_sold:   76449<br />liquor_type: Schnapps","month: 2012-07-01<br />monthly_bottles_sold:   81880<br />liquor_type: Schnapps","month: 2012-08-01<br />monthly_bottles_sold:   85097<br />liquor_type: Schnapps","month: 2012-09-01<br />monthly_bottles_sold:   67428<br />liquor_type: Schnapps","month: 2012-10-01<br />monthly_bottles_sold:  107777<br />liquor_type: Schnapps","month: 2012-11-01<br />monthly_bottles_sold:   88702<br />liquor_type: Schnapps","month: 2012-12-01<br />monthly_bottles_sold:  101991<br />liquor_type: Schnapps","month: 2013-01-01<br />monthly_bottles_sold:   77128<br />liquor_type: Schnapps","month: 2013-02-01<br />monthly_bottles_sold:   66988<br />liquor_type: Schnapps","month: 2013-03-01<br />monthly_bottles_sold:   78576<br />liquor_type: Schnapps","month: 2013-04-01<br />monthly_bottles_sold:   75262<br />liquor_type: Schnapps","month: 2013-05-01<br />monthly_bottles_sold:   71425<br />liquor_type: Schnapps","month: 2013-06-01<br />monthly_bottles_sold:   69656<br />liquor_type: Schnapps","month: 2013-07-01<br />monthly_bottles_sold:   79092<br />liquor_type: Schnapps","month: 2013-08-01<br />monthly_bottles_sold:   71475<br />liquor_type: Schnapps","month: 2013-09-01<br />monthly_bottles_sold:   67064<br />liquor_type: Schnapps","month: 2013-10-01<br />monthly_bottles_sold:   91159<br />liquor_type: Schnapps","month: 2013-11-01<br />monthly_bottles_sold:   73170<br />liquor_type: Schnapps","month: 2013-12-01<br />monthly_bottles_sold:   94789<br />liquor_type: Schnapps","month: 2014-01-01<br />monthly_bottles_sold:   71668<br />liquor_type: Schnapps","month: 2014-02-01<br />monthly_bottles_sold:   63844<br />liquor_type: Schnapps","month: 2014-03-01<br />monthly_bottles_sold:   68347<br />liquor_type: Schnapps","month: 2014-04-01<br />monthly_bottles_sold:   74685<br />liquor_type: Schnapps","month: 2014-05-01<br />monthly_bottles_sold:   60638<br />liquor_type: Schnapps","month: 2014-06-01<br />monthly_bottles_sold:   76854<br />liquor_type: Schnapps","month: 2014-07-01<br />monthly_bottles_sold:   72768<br />liquor_type: Schnapps","month: 2014-08-01<br />monthly_bottles_sold:   63959<br />liquor_type: Schnapps","month: 2014-09-01<br />monthly_bottles_sold:   69565<br />liquor_type: Schnapps","month: 2014-10-01<br />monthly_bottles_sold:   74296<br />liquor_type: Schnapps","month: 2014-11-01<br />monthly_bottles_sold:   71691<br />liquor_type: Schnapps","month: 2014-12-01<br />monthly_bottles_sold:   98330<br />liquor_type: Schnapps","month: 2015-01-01<br />monthly_bottles_sold:   66401<br />liquor_type: Schnapps","month: 2015-02-01<br />monthly_bottles_sold:   64587<br />liquor_type: Schnapps","month: 2015-03-01<br />monthly_bottles_sold:   79996<br />liquor_type: Schnapps","month: 2015-04-01<br />monthly_bottles_sold:   65065<br />liquor_type: Schnapps","month: 2015-05-01<br />monthly_bottles_sold:   61671<br />liquor_type: Schnapps","month: 2015-06-01<br />monthly_bottles_sold:   82867<br />liquor_type: Schnapps","month: 2015-07-01<br />monthly_bottles_sold:   65587<br />liquor_type: Schnapps","month: 2015-08-01<br />monthly_bottles_sold:   64282<br />liquor_type: Schnapps","month: 2015-09-01<br />monthly_bottles_sold:   72909<br />liquor_type: Schnapps","month: 2015-10-01<br />monthly_bottles_sold:   70251<br />liquor_type: Schnapps","month: 2015-11-01<br />monthly_bottles_sold:   85074<br />liquor_type: Schnapps","month: 2015-12-01<br />monthly_bottles_sold:   93350<br />liquor_type: Schnapps","month: 2016-01-01<br />monthly_bottles_sold:   65434<br />liquor_type: Schnapps","month: 2016-02-01<br />monthly_bottles_sold:   72180<br />liquor_type: Schnapps","month: 2016-03-01<br />monthly_bottles_sold:   85036<br />liquor_type: Schnapps","month: 2016-04-01<br />monthly_bottles_sold:   67091<br />liquor_type: Schnapps","month: 2016-05-01<br />monthly_bottles_sold:   77704<br />liquor_type: Schnapps","month: 2016-06-01<br />monthly_bottles_sold:   85701<br />liquor_type: Schnapps","month: 2016-07-01<br />monthly_bottles_sold:   65559<br />liquor_type: Schnapps","month: 2016-08-01<br />monthly_bottles_sold:   68207<br />liquor_type: Schnapps","month: 2016-09-01<br />monthly_bottles_sold:   69396<br />liquor_type: Schnapps","month: 2016-10-01<br />monthly_bottles_sold:   70021<br />liquor_type: Schnapps","month: 2016-11-01<br />monthly_bottles_sold:   81922<br />liquor_type: Schnapps","month: 2016-12-01<br />monthly_bottles_sold:   93284<br />liquor_type: Schnapps","month: 2017-01-01<br />monthly_bottles_sold:   67311<br />liquor_type: Schnapps","month: 2017-02-01<br />monthly_bottles_sold:   57862<br />liquor_type: Schnapps","month: 2017-03-01<br />monthly_bottles_sold:   73554<br />liquor_type: Schnapps","month: 2017-04-01<br />monthly_bottles_sold:   61045<br />liquor_type: Schnapps","month: 2017-05-01<br />monthly_bottles_sold:   71969<br />liquor_type: Schnapps","month: 2017-06-01<br />monthly_bottles_sold:   72697<br />liquor_type: Schnapps","month: 2017-07-01<br />monthly_bottles_sold:   68099<br />liquor_type: Schnapps","month: 2017-08-01<br />monthly_bottles_sold:   73073<br />liquor_type: Schnapps","month: 2017-09-01<br />monthly_bottles_sold:   60281<br />liquor_type: Schnapps","month: 2017-10-01<br />monthly_bottles_sold:   71181<br />liquor_type: Schnapps","month: 2017-11-01<br />monthly_bottles_sold:   77456<br />liquor_type: Schnapps","month: 2017-12-01<br />monthly_bottles_sold:   80188<br />liquor_type: Schnapps","month: 2018-01-01<br />monthly_bottles_sold:   77779<br />liquor_type: Schnapps","month: 2018-02-01<br />monthly_bottles_sold:   60964<br />liquor_type: Schnapps","month: 2018-03-01<br />monthly_bottles_sold:   68154<br />liquor_type: Schnapps","month: 2018-04-01<br />monthly_bottles_sold:   65787<br />liquor_type: Schnapps","month: 2018-05-01<br />monthly_bottles_sold:   72939<br />liquor_type: Schnapps","month: 2018-06-01<br />monthly_bottles_sold:   69182<br />liquor_type: Schnapps","month: 2018-07-01<br />monthly_bottles_sold:   63834<br />liquor_type: Schnapps","month: 2018-08-01<br />monthly_bottles_sold:   71553<br />liquor_type: Schnapps","month: 2018-09-01<br />monthly_bottles_sold:   59272<br />liquor_type: Schnapps","month: 2018-10-01<br />monthly_bottles_sold:   87137<br />liquor_type: Schnapps","month: 2018-11-01<br />monthly_bottles_sold:   83307<br />liquor_type: Schnapps","month: 2018-12-01<br />monthly_bottles_sold:   94623<br />liquor_type: Schnapps","month: 2019-01-01<br />monthly_bottles_sold:   80227<br />liquor_type: Schnapps","month: 2019-02-01<br />monthly_bottles_sold:   66149<br />liquor_type: Schnapps","month: 2019-03-01<br />monthly_bottles_sold:   71439<br />liquor_type: Schnapps","month: 2019-04-01<br />monthly_bottles_sold:   79595<br />liquor_type: Schnapps","month: 2019-05-01<br />monthly_bottles_sold:   83694<br />liquor_type: Schnapps","month: 2019-06-01<br />monthly_bottles_sold:   74333<br />liquor_type: Schnapps","month: 2019-07-01<br />monthly_bottles_sold:   84785<br />liquor_type: Schnapps","month: 2019-08-01<br />monthly_bottles_sold:   76835<br />liquor_type: Schnapps","month: 2019-09-01<br />monthly_bottles_sold:   72101<br />liquor_type: Schnapps","month: 2019-10-01<br />monthly_bottles_sold:   86780<br />liquor_type: Schnapps","month: 2019-11-01<br />monthly_bottles_sold:   85863<br />liquor_type: Schnapps","month: 2019-12-01<br />monthly_bottles_sold:   99055<br />liquor_type: Schnapps","month: 2020-01-01<br />monthly_bottles_sold:   79695<br />liquor_type: Schnapps","month: 2020-02-01<br />monthly_bottles_sold:   69528<br />liquor_type: Schnapps","month: 2020-03-01<br />monthly_bottles_sold:   76626<br />liquor_type: Schnapps","month: 2020-04-01<br />monthly_bottles_sold:   61821<br />liquor_type: Schnapps","month: 2020-05-01<br />monthly_bottles_sold:   77658<br />liquor_type: Schnapps","month: 2020-06-01<br />monthly_bottles_sold:   95975<br />liquor_type: Schnapps","month: 2020-07-01<br />monthly_bottles_sold:   90689<br />liquor_type: Schnapps","month: 2020-08-01<br />monthly_bottles_sold:   92029<br />liquor_type: Schnapps","month: 2020-09-01<br />monthly_bottles_sold:   90188<br />liquor_type: Schnapps","month: 2020-10-01<br />monthly_bottles_sold:   94840<br />liquor_type: Schnapps","month: 2020-11-01<br />monthly_bottles_sold:   92213<br />liquor_type: Schnapps","month: 2020-12-01<br />monthly_bottles_sold:  103758<br />liquor_type: Schnapps","month: 2021-01-01<br />monthly_bottles_sold:   92357<br />liquor_type: Schnapps","month: 2021-02-01<br />monthly_bottles_sold:   84657<br />liquor_type: Schnapps","month: 2021-03-01<br />monthly_bottles_sold:  102407<br />liquor_type: Schnapps","month: 2021-04-01<br />monthly_bottles_sold:  105923<br />liquor_type: Schnapps","month: 2021-05-01<br />monthly_bottles_sold:   94873<br />liquor_type: Schnapps","month: 2021-06-01<br />monthly_bottles_sold:  110381<br />liquor_type: Schnapps","month: 2021-07-01<br />monthly_bottles_sold:   97260<br />liquor_type: Schnapps","month: 2021-08-01<br />monthly_bottles_sold:   95456<br />liquor_type: Schnapps","month: 2021-09-01<br />monthly_bottles_sold:   93067<br />liquor_type: Schnapps","month: 2021-10-01<br />monthly_bottles_sold:   99207<br />liquor_type: Schnapps","month: 2021-11-01<br />monthly_bottles_sold:  102784<br />liquor_type: Schnapps","month: 2021-12-01<br />monthly_bottles_sold:  105439<br />liquor_type: Schnapps","month: 2022-01-01<br />monthly_bottles_sold:   83145<br />liquor_type: Schnapps","month: 2022-02-01<br />monthly_bottles_sold:   80020<br />liquor_type: Schnapps","month: 2022-03-01<br />monthly_bottles_sold:   93820<br />liquor_type: Schnapps","month: 2022-04-01<br />monthly_bottles_sold:   93776<br />liquor_type: Schnapps","month: 2022-05-01<br />monthly_bottles_sold:   95227<br />liquor_type: Schnapps","month: 2022-06-01<br />monthly_bottles_sold:  104764<br />liquor_type: Schnapps","month: 2022-07-01<br />monthly_bottles_sold:   90465<br />liquor_type: Schnapps","month: 2022-08-01<br />monthly_bottles_sold:  104832<br />liquor_type: Schnapps","month: 2022-09-01<br />monthly_bottles_sold:  102541<br />liquor_type: Schnapps","month: 2022-10-01<br />monthly_bottles_sold:   97055<br />liquor_type: Schnapps","month: 2022-11-01<br />monthly_bottles_sold:  100962<br />liquor_type: Schnapps","month: 2022-12-01<br />monthly_bottles_sold:  122653<br />liquor_type: Schnapps","month: 2023-01-01<br />monthly_bottles_sold:  108386<br />liquor_type: Schnapps","month: 2023-02-01<br />monthly_bottles_sold:   98684<br />liquor_type: Schnapps","month: 2023-03-01<br />monthly_bottles_sold:  120926<br />liquor_type: Schnapps","month: 2023-04-01<br />monthly_bottles_sold:  107844<br />liquor_type: Schnapps","month: 2023-05-01<br />monthly_bottles_sold:  107024<br />liquor_type: Schnapps","month: 2023-06-01<br />monthly_bottles_sold:  114244<br />liquor_type: Schnapps","month: 2023-07-01<br />monthly_bottles_sold:  101177<br />liquor_type: Schnapps","month: 2023-08-01<br />monthly_bottles_sold:  109653<br />liquor_type: Schnapps","month: 2023-09-01<br />monthly_bottles_sold:   99031<br />liquor_type: Schnapps","month: 2023-10-01<br />monthly_bottles_sold:  107078<br />liquor_type: Schnapps","month: 2023-11-01<br />monthly_bottles_sold:  111516<br />liquor_type: Schnapps","month: 2023-12-01<br />monthly_bottles_sold:  118140<br />liquor_type: Schnapps","month: 2024-01-01<br />monthly_bottles_sold:  107143<br />liquor_type: Schnapps","month: 2024-02-01<br />monthly_bottles_sold:  105012<br />liquor_type: Schnapps","month: 2024-03-01<br />monthly_bottles_sold:  107616<br />liquor_type: Schnapps","month: 2024-04-01<br />monthly_bottles_sold:  115896<br />liquor_type: Schnapps","month: 2024-05-01<br />monthly_bottles_sold:  119264<br />liquor_type: Schnapps","month: 2024-06-01<br />monthly_bottles_sold:  112649<br />liquor_type: Schnapps","month: 2024-07-01<br />monthly_bottles_sold:  119127<br />liquor_type: Schnapps","month: 2024-08-01<br />monthly_bottles_sold:  117034<br />liquor_type: Schnapps","month: 2024-09-01<br />monthly_bottles_sold:  112208<br />liquor_type: Schnapps","month: 2024-10-01<br />monthly_bottles_sold:  126954<br />liquor_type: Schnapps","month: 2024-11-01<br />monthly_bottles_sold:  114480<br />liquor_type: Schnapps"],"type":"scatter","mode":"lines+markers","line":{"width":1.8897637795275593,"color":"rgba(0,176,246,1)","dash":"solid"},"hoveron":"points","name":"Schnapps","legendgroup":"Schnapps","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(0,176,246,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,176,246,1)"}},"frame":null},{"x":[1325376000,1328054400,1330560000,1333238400,1335830400,1338508800,1341100800,1343779200,1346457600,1349049600,1351728000,1354320000,1356998400,1359676800,1362096000,1364774400,1367366400,1370044800,1372636800,1375315200,1377993600,1380585600,1383264000,1385856000,1388534400,1391212800,1393632000,1396310400,1398902400,1401580800,1404172800,1406851200,1409529600,1412121600,1414800000,1417392000,1420070400,1422748800,1425168000,1427846400,1430438400,1433116800,1435708800,1438387200,1441065600,1443657600,1446336000,1448928000,1451606400,1454284800,1456790400,1459468800,1462060800,1464739200,1467331200,1470009600,1472688000,1475280000,1477958400,1480550400,1483228800,1485907200,1488326400,1491004800,1493596800,1496275200,1498867200,1501545600,1504224000,1506816000,1509494400,1512086400,1514764800,1517443200,1519862400,1522540800,1525132800,1527811200,1530403200,1533081600,1535760000,1538352000,1541030400,1543622400,1546300800,1548979200,1551398400,1554076800,1556668800,1559347200,1561939200,1564617600,1567296000,1569888000,1572566400,1575158400,1577836800,1580515200,1583020800,1585699200,1588291200,1590969600,1593561600,1596240000,1598918400,1601510400,1604188800,1606780800,1609459200,1612137600,1614556800,1617235200,1619827200,1622505600,1625097600,1627776000,1630454400,1633046400,1635724800,1638316800,1640995200,1643673600,1646092800,1648771200,1651363200,1654041600,1656633600,1659312000,1661990400,1664582400,1667260800,1669852800,1672531200,1675209600,1677628800,1680307200,1682899200,1685577600,1688169600,1690848000,1693526400,1696118400,1698796800,1701388800,1704067200,1706745600,1709251200,1711929600,1714521600,1717200000,1719792000,1722470400,1725148800,1727740800,1730419200],"y":[51814,60387,61047,79944,84798,80350,77645,74589,55513,78690,57906,70869,53892,55032,60908,80221,76855,61036,85049,70706,63040,79107,54483,71299,55097,63319,61845,84871,79505,83736,82488,74833,66828,69327,54930,84063,61555,63999,72051,95186,80063,93170,84240,73170,74462,71084,68635,82256,58693,74542,80192,91695,95210,99433,78120,78568,74883,76430,79770,83692,65088,71857,83848,95527,101923,98291,88214,97691,72395,82070,80454,80564,69540,71341,84348,102483,107090,88940,99544,112100,71874,110678,79691,91275,74117,77406,82544,128294,118161,104525,109620,103084,79899,111998,82795,105055,79821,84176,99504,134343,125763,147436,140653,137126,109180,124849,89334,131033,96546,107584,129020,145995,140780,153193,138302,150150,128423,136111,129555,161213,93886,124423,118592,160990,150363,160912,141242,177568,137153,159515,133212,147511,131327,136423,140683,158738,184663,189512,158648,182604,151103,166263,143167,169284,127054,154558,139695,189543,184671,192367,170650,172111,149824,169687,149691],"text":["month: 2012-01-01<br />monthly_bottles_sold:   51814<br />liquor_type: Tequila","month: 2012-02-01<br />monthly_bottles_sold:   60387<br />liquor_type: Tequila","month: 2012-03-01<br />monthly_bottles_sold:   61047<br />liquor_type: Tequila","month: 2012-04-01<br />monthly_bottles_sold:   79944<br />liquor_type: Tequila","month: 2012-05-01<br />monthly_bottles_sold:   84798<br />liquor_type: Tequila","month: 2012-06-01<br />monthly_bottles_sold:   80350<br />liquor_type: Tequila","month: 2012-07-01<br />monthly_bottles_sold:   77645<br />liquor_type: Tequila","month: 2012-08-01<br />monthly_bottles_sold:   74589<br />liquor_type: Tequila","month: 2012-09-01<br />monthly_bottles_sold:   55513<br />liquor_type: Tequila","month: 2012-10-01<br />monthly_bottles_sold:   78690<br />liquor_type: Tequila","month: 2012-11-01<br />monthly_bottles_sold:   57906<br />liquor_type: Tequila","month: 2012-12-01<br />monthly_bottles_sold:   70869<br />liquor_type: Tequila","month: 2013-01-01<br />monthly_bottles_sold:   53892<br />liquor_type: Tequila","month: 2013-02-01<br />monthly_bottles_sold:   55032<br />liquor_type: Tequila","month: 2013-03-01<br />monthly_bottles_sold:   60908<br />liquor_type: Tequila","month: 2013-04-01<br />monthly_bottles_sold:   80221<br />liquor_type: Tequila","month: 2013-05-01<br />monthly_bottles_sold:   76855<br />liquor_type: Tequila","month: 2013-06-01<br />monthly_bottles_sold:   61036<br />liquor_type: Tequila","month: 2013-07-01<br />monthly_bottles_sold:   85049<br />liquor_type: Tequila","month: 2013-08-01<br />monthly_bottles_sold:   70706<br />liquor_type: Tequila","month: 2013-09-01<br />monthly_bottles_sold:   63040<br />liquor_type: Tequila","month: 2013-10-01<br />monthly_bottles_sold:   79107<br />liquor_type: Tequila","month: 2013-11-01<br />monthly_bottles_sold:   54483<br />liquor_type: Tequila","month: 2013-12-01<br />monthly_bottles_sold:   71299<br />liquor_type: Tequila","month: 2014-01-01<br />monthly_bottles_sold:   55097<br />liquor_type: Tequila","month: 2014-02-01<br />monthly_bottles_sold:   63319<br />liquor_type: Tequila","month: 2014-03-01<br />monthly_bottles_sold:   61845<br />liquor_type: Tequila","month: 2014-04-01<br />monthly_bottles_sold:   84871<br />liquor_type: Tequila","month: 2014-05-01<br />monthly_bottles_sold:   79505<br />liquor_type: Tequila","month: 2014-06-01<br />monthly_bottles_sold:   83736<br />liquor_type: Tequila","month: 2014-07-01<br />monthly_bottles_sold:   82488<br />liquor_type: Tequila","month: 2014-08-01<br />monthly_bottles_sold:   74833<br />liquor_type: Tequila","month: 2014-09-01<br />monthly_bottles_sold:   66828<br />liquor_type: Tequila","month: 2014-10-01<br />monthly_bottles_sold:   69327<br />liquor_type: Tequila","month: 2014-11-01<br />monthly_bottles_sold:   54930<br />liquor_type: Tequila","month: 2014-12-01<br />monthly_bottles_sold:   84063<br />liquor_type: Tequila","month: 2015-01-01<br />monthly_bottles_sold:   61555<br />liquor_type: Tequila","month: 2015-02-01<br />monthly_bottles_sold:   63999<br />liquor_type: Tequila","month: 2015-03-01<br />monthly_bottles_sold:   72051<br />liquor_type: Tequila","month: 2015-04-01<br />monthly_bottles_sold:   95186<br />liquor_type: Tequila","month: 2015-05-01<br />monthly_bottles_sold:   80063<br />liquor_type: Tequila","month: 2015-06-01<br />monthly_bottles_sold:   93170<br />liquor_type: Tequila","month: 2015-07-01<br />monthly_bottles_sold:   84240<br />liquor_type: Tequila","month: 2015-08-01<br />monthly_bottles_sold:   73170<br />liquor_type: Tequila","month: 2015-09-01<br />monthly_bottles_sold:   74462<br />liquor_type: Tequila","month: 2015-10-01<br />monthly_bottles_sold:   71084<br />liquor_type: Tequila","month: 2015-11-01<br />monthly_bottles_sold:   68635<br />liquor_type: Tequila","month: 2015-12-01<br />monthly_bottles_sold:   82256<br />liquor_type: Tequila","month: 2016-01-01<br />monthly_bottles_sold:   58693<br />liquor_type: Tequila","month: 2016-02-01<br />monthly_bottles_sold:   74542<br />liquor_type: Tequila","month: 2016-03-01<br />monthly_bottles_sold:   80192<br />liquor_type: Tequila","month: 2016-04-01<br />monthly_bottles_sold:   91695<br />liquor_type: Tequila","month: 2016-05-01<br />monthly_bottles_sold:   95210<br />liquor_type: Tequila","month: 2016-06-01<br />monthly_bottles_sold:   99433<br />liquor_type: Tequila","month: 2016-07-01<br />monthly_bottles_sold:   78120<br />liquor_type: Tequila","month: 2016-08-01<br />monthly_bottles_sold:   78568<br />liquor_type: Tequila","month: 2016-09-01<br />monthly_bottles_sold:   74883<br />liquor_type: Tequila","month: 2016-10-01<br />monthly_bottles_sold:   76430<br />liquor_type: Tequila","month: 2016-11-01<br />monthly_bottles_sold:   79770<br />liquor_type: Tequila","month: 2016-12-01<br />monthly_bottles_sold:   83692<br />liquor_type: Tequila","month: 2017-01-01<br />monthly_bottles_sold:   65088<br />liquor_type: Tequila","month: 2017-02-01<br />monthly_bottles_sold:   71857<br />liquor_type: Tequila","month: 2017-03-01<br />monthly_bottles_sold:   83848<br />liquor_type: Tequila","month: 2017-04-01<br />monthly_bottles_sold:   95527<br />liquor_type: Tequila","month: 2017-05-01<br />monthly_bottles_sold:  101923<br />liquor_type: Tequila","month: 2017-06-01<br />monthly_bottles_sold:   98291<br />liquor_type: Tequila","month: 2017-07-01<br />monthly_bottles_sold:   88214<br />liquor_type: Tequila","month: 2017-08-01<br />monthly_bottles_sold:   97691<br />liquor_type: Tequila","month: 2017-09-01<br />monthly_bottles_sold:   72395<br />liquor_type: Tequila","month: 2017-10-01<br />monthly_bottles_sold:   82070<br />liquor_type: Tequila","month: 2017-11-01<br />monthly_bottles_sold:   80454<br />liquor_type: Tequila","month: 2017-12-01<br />monthly_bottles_sold:   80564<br />liquor_type: Tequila","month: 2018-01-01<br />monthly_bottles_sold:   69540<br />liquor_type: Tequila","month: 2018-02-01<br />monthly_bottles_sold:   71341<br />liquor_type: Tequila","month: 2018-03-01<br />monthly_bottles_sold:   84348<br />liquor_type: Tequila","month: 2018-04-01<br />monthly_bottles_sold:  102483<br />liquor_type: Tequila","month: 2018-05-01<br />monthly_bottles_sold:  107090<br />liquor_type: Tequila","month: 2018-06-01<br />monthly_bottles_sold:   88940<br />liquor_type: Tequila","month: 2018-07-01<br />monthly_bottles_sold:   99544<br />liquor_type: Tequila","month: 2018-08-01<br />monthly_bottles_sold:  112100<br />liquor_type: Tequila","month: 2018-09-01<br />monthly_bottles_sold:   71874<br />liquor_type: Tequila","month: 2018-10-01<br />monthly_bottles_sold:  110678<br />liquor_type: Tequila","month: 2018-11-01<br />monthly_bottles_sold:   79691<br />liquor_type: Tequila","month: 2018-12-01<br />monthly_bottles_sold:   91275<br />liquor_type: Tequila","month: 2019-01-01<br />monthly_bottles_sold:   74117<br />liquor_type: Tequila","month: 2019-02-01<br />monthly_bottles_sold:   77406<br />liquor_type: Tequila","month: 2019-03-01<br />monthly_bottles_sold:   82544<br />liquor_type: Tequila","month: 2019-04-01<br />monthly_bottles_sold:  128294<br />liquor_type: Tequila","month: 2019-05-01<br />monthly_bottles_sold:  118161<br />liquor_type: Tequila","month: 2019-06-01<br />monthly_bottles_sold:  104525<br />liquor_type: Tequila","month: 2019-07-01<br />monthly_bottles_sold:  109620<br />liquor_type: Tequila","month: 2019-08-01<br />monthly_bottles_sold:  103084<br />liquor_type: Tequila","month: 2019-09-01<br />monthly_bottles_sold:   79899<br />liquor_type: Tequila","month: 2019-10-01<br />monthly_bottles_sold:  111998<br />liquor_type: Tequila","month: 2019-11-01<br />monthly_bottles_sold:   82795<br />liquor_type: Tequila","month: 2019-12-01<br />monthly_bottles_sold:  105055<br />liquor_type: Tequila","month: 2020-01-01<br />monthly_bottles_sold:   79821<br />liquor_type: Tequila","month: 2020-02-01<br />monthly_bottles_sold:   84176<br />liquor_type: Tequila","month: 2020-03-01<br />monthly_bottles_sold:   99504<br />liquor_type: Tequila","month: 2020-04-01<br />monthly_bottles_sold:  134343<br />liquor_type: Tequila","month: 2020-05-01<br />monthly_bottles_sold:  125763<br />liquor_type: Tequila","month: 2020-06-01<br />monthly_bottles_sold:  147436<br />liquor_type: Tequila","month: 2020-07-01<br />monthly_bottles_sold:  140653<br />liquor_type: Tequila","month: 2020-08-01<br />monthly_bottles_sold:  137126<br />liquor_type: Tequila","month: 2020-09-01<br />monthly_bottles_sold:  109180<br />liquor_type: Tequila","month: 2020-10-01<br />monthly_bottles_sold:  124849<br />liquor_type: Tequila","month: 2020-11-01<br />monthly_bottles_sold:   89334<br />liquor_type: Tequila","month: 2020-12-01<br />monthly_bottles_sold:  131033<br />liquor_type: Tequila","month: 2021-01-01<br />monthly_bottles_sold:   96546<br />liquor_type: Tequila","month: 2021-02-01<br />monthly_bottles_sold:  107584<br />liquor_type: Tequila","month: 2021-03-01<br />monthly_bottles_sold:  129020<br />liquor_type: Tequila","month: 2021-04-01<br />monthly_bottles_sold:  145995<br />liquor_type: Tequila","month: 2021-05-01<br />monthly_bottles_sold:  140780<br />liquor_type: Tequila","month: 2021-06-01<br />monthly_bottles_sold:  153193<br />liquor_type: Tequila","month: 2021-07-01<br />monthly_bottles_sold:  138302<br />liquor_type: Tequila","month: 2021-08-01<br />monthly_bottles_sold:  150150<br />liquor_type: Tequila","month: 2021-09-01<br />monthly_bottles_sold:  128423<br />liquor_type: Tequila","month: 2021-10-01<br />monthly_bottles_sold:  136111<br />liquor_type: Tequila","month: 2021-11-01<br />monthly_bottles_sold:  129555<br />liquor_type: Tequila","month: 2021-12-01<br />monthly_bottles_sold:  161213<br />liquor_type: Tequila","month: 2022-01-01<br />monthly_bottles_sold:   93886<br />liquor_type: Tequila","month: 2022-02-01<br />monthly_bottles_sold:  124423<br />liquor_type: Tequila","month: 2022-03-01<br />monthly_bottles_sold:  118592<br />liquor_type: Tequila","month: 2022-04-01<br />monthly_bottles_sold:  160990<br />liquor_type: Tequila","month: 2022-05-01<br />monthly_bottles_sold:  150363<br />liquor_type: Tequila","month: 2022-06-01<br />monthly_bottles_sold:  160912<br />liquor_type: Tequila","month: 2022-07-01<br />monthly_bottles_sold:  141242<br />liquor_type: Tequila","month: 2022-08-01<br />monthly_bottles_sold:  177568<br />liquor_type: Tequila","month: 2022-09-01<br />monthly_bottles_sold:  137153<br />liquor_type: Tequila","month: 2022-10-01<br />monthly_bottles_sold:  159515<br />liquor_type: Tequila","month: 2022-11-01<br />monthly_bottles_sold:  133212<br />liquor_type: Tequila","month: 2022-12-01<br />monthly_bottles_sold:  147511<br />liquor_type: Tequila","month: 2023-01-01<br />monthly_bottles_sold:  131327<br />liquor_type: Tequila","month: 2023-02-01<br />monthly_bottles_sold:  136423<br />liquor_type: Tequila","month: 2023-03-01<br />monthly_bottles_sold:  140683<br />liquor_type: Tequila","month: 2023-04-01<br />monthly_bottles_sold:  158738<br />liquor_type: Tequila","month: 2023-05-01<br />monthly_bottles_sold:  184663<br />liquor_type: Tequila","month: 2023-06-01<br />monthly_bottles_sold:  189512<br />liquor_type: Tequila","month: 2023-07-01<br />monthly_bottles_sold:  158648<br />liquor_type: Tequila","month: 2023-08-01<br />monthly_bottles_sold:  182604<br />liquor_type: Tequila","month: 2023-09-01<br />monthly_bottles_sold:  151103<br />liquor_type: Tequila","month: 2023-10-01<br />monthly_bottles_sold:  166263<br />liquor_type: Tequila","month: 2023-11-01<br />monthly_bottles_sold:  143167<br />liquor_type: Tequila","month: 2023-12-01<br />monthly_bottles_sold:  169284<br />liquor_type: Tequila","month: 2024-01-01<br />monthly_bottles_sold:  127054<br />liquor_type: Tequila","month: 2024-02-01<br />monthly_bottles_sold:  154558<br />liquor_type: Tequila","month: 2024-03-01<br />monthly_bottles_sold:  139695<br />liquor_type: Tequila","month: 2024-04-01<br />monthly_bottles_sold:  189543<br />liquor_type: Tequila","month: 2024-05-01<br />monthly_bottles_sold:  184671<br />liquor_type: Tequila","month: 2024-06-01<br />monthly_bottles_sold:  192367<br />liquor_type: Tequila","month: 2024-07-01<br />monthly_bottles_sold:  170650<br />liquor_type: Tequila","month: 2024-08-01<br />monthly_bottles_sold:  172111<br />liquor_type: Tequila","month: 2024-09-01<br />monthly_bottles_sold:  149824<br />liquor_type: Tequila","month: 2024-10-01<br />monthly_bottles_sold:  169687<br />liquor_type: Tequila","month: 2024-11-01<br />monthly_bottles_sold:  149691<br />liquor_type: Tequila"],"type":"scatter","mode":"lines+markers","line":{"width":1.8897637795275593,"color":"rgba(149,144,255,1)","dash":"solid"},"hoveron":"points","name":"Tequila","legendgroup":"Tequila","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(149,144,255,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(149,144,255,1)"}},"frame":null},{"x":[1325376000,1328054400,1330560000,1333238400,1335830400,1338508800,1341100800,1343779200,1346457600,1349049600,1351728000,1354320000,1356998400,1359676800,1362096000,1364774400,1367366400,1370044800,1372636800,1375315200,1377993600,1380585600,1383264000,1385856000,1388534400,1391212800,1393632000,1396310400,1398902400,1401580800,1404172800,1406851200,1409529600,1412121600,1414800000,1417392000,1420070400,1422748800,1425168000,1427846400,1430438400,1433116800,1435708800,1438387200,1441065600,1443657600,1446336000,1448928000,1451606400,1454284800,1456790400,1459468800,1462060800,1464739200,1467331200,1470009600,1472688000,1475280000,1477958400,1480550400,1483228800,1485907200,1488326400,1491004800,1493596800,1496275200,1498867200,1501545600,1504224000,1506816000,1509494400,1512086400,1514764800,1517443200,1519862400,1522540800,1525132800,1527811200,1530403200,1533081600,1535760000,1538352000,1541030400,1543622400,1546300800,1548979200,1551398400,1554076800,1556668800,1559347200,1561939200,1564617600,1567296000,1569888000,1572566400,1575158400,1577836800,1580515200,1583020800,1585699200,1588291200,1590969600,1593561600,1596240000,1598918400,1601510400,1604188800,1606780800,1609459200,1612137600,1614556800,1617235200,1619827200,1622505600,1625097600,1627776000,1630454400,1633046400,1635724800,1638316800,1640995200,1643673600,1646092800,1648771200,1651363200,1654041600,1656633600,1659312000,1661990400,1664582400,1667260800,1669852800,1672531200,1675209600,1677628800,1680307200,1682899200,1685577600,1688169600,1690848000,1693526400,1696118400,1698796800,1701388800,1704067200,1706745600,1709251200,1711929600,1714521600,1717200000,1719792000,1722470400,1725148800,1727740800,1730419200],"y":[365226,377666,412089,443737,501372,490519,487286,550966,401174,641949,402871,470680,426662,374439,388512,516522,510642,460863,547087,527455,452802,617664,385967,495321,466693,410391,425210,523421,470778,579147,540484,543081,522083,573002,424647,603957,446288,427210,526000,528352,489272,669766,550595,581620,582230,543391,507304,626842,445357,499989,555661,517608,604760,715213,551470,598973,593712,592031,571587,647916,477733,526968,591230,550098,634411,721525,635101,732737,590977,647934,580113,641689,544154,513717,576673,603417,711315,694173,683222,737411,581723,692874,644617,688742,569339,531195,524232,612228,746576,713144,716067,734085,634309,714360,636234,658363,580134,563373,674911,676796,672923,751793,706847,722914,762693,689504,606450,710171,571486,567581,691935,680257,654059,801175,721986,754295,705633,680543,721240,720948,559774,550231,581910,674449,733112,801694,677192,832990,705547,738996,681557,694469,629276,612547,706142,656049,775337,844464,694707,831574,663710,737083,712670,666494,648113,648304,648651,713232,758523,737604,742739,795920,643087,788841,705464],"text":["month: 2012-01-01<br />monthly_bottles_sold:  365226<br />liquor_type: Vodka","month: 2012-02-01<br />monthly_bottles_sold:  377666<br />liquor_type: Vodka","month: 2012-03-01<br />monthly_bottles_sold:  412089<br />liquor_type: Vodka","month: 2012-04-01<br />monthly_bottles_sold:  443737<br />liquor_type: Vodka","month: 2012-05-01<br />monthly_bottles_sold:  501372<br />liquor_type: Vodka","month: 2012-06-01<br />monthly_bottles_sold:  490519<br />liquor_type: Vodka","month: 2012-07-01<br />monthly_bottles_sold:  487286<br />liquor_type: Vodka","month: 2012-08-01<br />monthly_bottles_sold:  550966<br />liquor_type: Vodka","month: 2012-09-01<br />monthly_bottles_sold:  401174<br />liquor_type: Vodka","month: 2012-10-01<br />monthly_bottles_sold:  641949<br />liquor_type: Vodka","month: 2012-11-01<br />monthly_bottles_sold:  402871<br />liquor_type: Vodka","month: 2012-12-01<br />monthly_bottles_sold:  470680<br />liquor_type: Vodka","month: 2013-01-01<br />monthly_bottles_sold:  426662<br />liquor_type: Vodka","month: 2013-02-01<br />monthly_bottles_sold:  374439<br />liquor_type: Vodka","month: 2013-03-01<br />monthly_bottles_sold:  388512<br />liquor_type: Vodka","month: 2013-04-01<br />monthly_bottles_sold:  516522<br />liquor_type: Vodka","month: 2013-05-01<br />monthly_bottles_sold:  510642<br />liquor_type: Vodka","month: 2013-06-01<br />monthly_bottles_sold:  460863<br />liquor_type: Vodka","month: 2013-07-01<br />monthly_bottles_sold:  547087<br />liquor_type: Vodka","month: 2013-08-01<br />monthly_bottles_sold:  527455<br />liquor_type: Vodka","month: 2013-09-01<br />monthly_bottles_sold:  452802<br />liquor_type: Vodka","month: 2013-10-01<br />monthly_bottles_sold:  617664<br />liquor_type: Vodka","month: 2013-11-01<br />monthly_bottles_sold:  385967<br />liquor_type: Vodka","month: 2013-12-01<br />monthly_bottles_sold:  495321<br />liquor_type: Vodka","month: 2014-01-01<br />monthly_bottles_sold:  466693<br />liquor_type: Vodka","month: 2014-02-01<br />monthly_bottles_sold:  410391<br />liquor_type: Vodka","month: 2014-03-01<br />monthly_bottles_sold:  425210<br />liquor_type: Vodka","month: 2014-04-01<br />monthly_bottles_sold:  523421<br />liquor_type: Vodka","month: 2014-05-01<br />monthly_bottles_sold:  470778<br />liquor_type: Vodka","month: 2014-06-01<br />monthly_bottles_sold:  579147<br />liquor_type: Vodka","month: 2014-07-01<br />monthly_bottles_sold:  540484<br />liquor_type: Vodka","month: 2014-08-01<br />monthly_bottles_sold:  543081<br />liquor_type: Vodka","month: 2014-09-01<br />monthly_bottles_sold:  522083<br />liquor_type: Vodka","month: 2014-10-01<br />monthly_bottles_sold:  573002<br />liquor_type: Vodka","month: 2014-11-01<br />monthly_bottles_sold:  424647<br />liquor_type: Vodka","month: 2014-12-01<br />monthly_bottles_sold:  603957<br />liquor_type: Vodka","month: 2015-01-01<br />monthly_bottles_sold:  446288<br />liquor_type: Vodka","month: 2015-02-01<br />monthly_bottles_sold:  427210<br />liquor_type: Vodka","month: 2015-03-01<br />monthly_bottles_sold:  526000<br />liquor_type: Vodka","month: 2015-04-01<br />monthly_bottles_sold:  528352<br />liquor_type: Vodka","month: 2015-05-01<br />monthly_bottles_sold:  489272<br />liquor_type: Vodka","month: 2015-06-01<br />monthly_bottles_sold:  669766<br />liquor_type: Vodka","month: 2015-07-01<br />monthly_bottles_sold:  550595<br />liquor_type: Vodka","month: 2015-08-01<br />monthly_bottles_sold:  581620<br />liquor_type: Vodka","month: 2015-09-01<br />monthly_bottles_sold:  582230<br />liquor_type: Vodka","month: 2015-10-01<br />monthly_bottles_sold:  543391<br />liquor_type: Vodka","month: 2015-11-01<br />monthly_bottles_sold:  507304<br />liquor_type: Vodka","month: 2015-12-01<br />monthly_bottles_sold:  626842<br />liquor_type: Vodka","month: 2016-01-01<br />monthly_bottles_sold:  445357<br />liquor_type: Vodka","month: 2016-02-01<br />monthly_bottles_sold:  499989<br />liquor_type: Vodka","month: 2016-03-01<br />monthly_bottles_sold:  555661<br />liquor_type: Vodka","month: 2016-04-01<br />monthly_bottles_sold:  517608<br />liquor_type: Vodka","month: 2016-05-01<br />monthly_bottles_sold:  604760<br />liquor_type: Vodka","month: 2016-06-01<br />monthly_bottles_sold:  715213<br />liquor_type: Vodka","month: 2016-07-01<br />monthly_bottles_sold:  551470<br />liquor_type: Vodka","month: 2016-08-01<br />monthly_bottles_sold:  598973<br />liquor_type: Vodka","month: 2016-09-01<br />monthly_bottles_sold:  593712<br />liquor_type: Vodka","month: 2016-10-01<br />monthly_bottles_sold:  592031<br />liquor_type: Vodka","month: 2016-11-01<br />monthly_bottles_sold:  571587<br />liquor_type: Vodka","month: 2016-12-01<br />monthly_bottles_sold:  647916<br />liquor_type: Vodka","month: 2017-01-01<br />monthly_bottles_sold:  477733<br />liquor_type: Vodka","month: 2017-02-01<br />monthly_bottles_sold:  526968<br />liquor_type: Vodka","month: 2017-03-01<br />monthly_bottles_sold:  591230<br />liquor_type: Vodka","month: 2017-04-01<br />monthly_bottles_sold:  550098<br />liquor_type: Vodka","month: 2017-05-01<br />monthly_bottles_sold:  634411<br />liquor_type: Vodka","month: 2017-06-01<br />monthly_bottles_sold:  721525<br />liquor_type: Vodka","month: 2017-07-01<br />monthly_bottles_sold:  635101<br />liquor_type: Vodka","month: 2017-08-01<br />monthly_bottles_sold:  732737<br />liquor_type: Vodka","month: 2017-09-01<br />monthly_bottles_sold:  590977<br />liquor_type: Vodka","month: 2017-10-01<br />monthly_bottles_sold:  647934<br />liquor_type: Vodka","month: 2017-11-01<br />monthly_bottles_sold:  580113<br />liquor_type: Vodka","month: 2017-12-01<br />monthly_bottles_sold:  641689<br />liquor_type: Vodka","month: 2018-01-01<br />monthly_bottles_sold:  544154<br />liquor_type: Vodka","month: 2018-02-01<br />monthly_bottles_sold:  513717<br />liquor_type: Vodka","month: 2018-03-01<br />monthly_bottles_sold:  576673<br />liquor_type: Vodka","month: 2018-04-01<br />monthly_bottles_sold:  603417<br />liquor_type: Vodka","month: 2018-05-01<br />monthly_bottles_sold:  711315<br />liquor_type: Vodka","month: 2018-06-01<br />monthly_bottles_sold:  694173<br />liquor_type: Vodka","month: 2018-07-01<br />monthly_bottles_sold:  683222<br />liquor_type: Vodka","month: 2018-08-01<br />monthly_bottles_sold:  737411<br />liquor_type: Vodka","month: 2018-09-01<br />monthly_bottles_sold:  581723<br />liquor_type: Vodka","month: 2018-10-01<br />monthly_bottles_sold:  692874<br />liquor_type: Vodka","month: 2018-11-01<br />monthly_bottles_sold:  644617<br />liquor_type: Vodka","month: 2018-12-01<br />monthly_bottles_sold:  688742<br />liquor_type: Vodka","month: 2019-01-01<br />monthly_bottles_sold:  569339<br />liquor_type: Vodka","month: 2019-02-01<br />monthly_bottles_sold:  531195<br />liquor_type: Vodka","month: 2019-03-01<br />monthly_bottles_sold:  524232<br />liquor_type: Vodka","month: 2019-04-01<br />monthly_bottles_sold:  612228<br />liquor_type: Vodka","month: 2019-05-01<br />monthly_bottles_sold:  746576<br />liquor_type: Vodka","month: 2019-06-01<br />monthly_bottles_sold:  713144<br />liquor_type: Vodka","month: 2019-07-01<br />monthly_bottles_sold:  716067<br />liquor_type: Vodka","month: 2019-08-01<br />monthly_bottles_sold:  734085<br />liquor_type: Vodka","month: 2019-09-01<br />monthly_bottles_sold:  634309<br />liquor_type: Vodka","month: 2019-10-01<br />monthly_bottles_sold:  714360<br />liquor_type: Vodka","month: 2019-11-01<br />monthly_bottles_sold:  636234<br />liquor_type: Vodka","month: 2019-12-01<br />monthly_bottles_sold:  658363<br />liquor_type: Vodka","month: 2020-01-01<br />monthly_bottles_sold:  580134<br />liquor_type: Vodka","month: 2020-02-01<br />monthly_bottles_sold:  563373<br />liquor_type: Vodka","month: 2020-03-01<br />monthly_bottles_sold:  674911<br />liquor_type: Vodka","month: 2020-04-01<br />monthly_bottles_sold:  676796<br />liquor_type: Vodka","month: 2020-05-01<br />monthly_bottles_sold:  672923<br />liquor_type: Vodka","month: 2020-06-01<br />monthly_bottles_sold:  751793<br />liquor_type: Vodka","month: 2020-07-01<br />monthly_bottles_sold:  706847<br />liquor_type: Vodka","month: 2020-08-01<br />monthly_bottles_sold:  722914<br />liquor_type: Vodka","month: 2020-09-01<br />monthly_bottles_sold:  762693<br />liquor_type: Vodka","month: 2020-10-01<br />monthly_bottles_sold:  689504<br />liquor_type: Vodka","month: 2020-11-01<br />monthly_bottles_sold:  606450<br />liquor_type: Vodka","month: 2020-12-01<br />monthly_bottles_sold:  710171<br />liquor_type: Vodka","month: 2021-01-01<br />monthly_bottles_sold:  571486<br />liquor_type: Vodka","month: 2021-02-01<br />monthly_bottles_sold:  567581<br />liquor_type: Vodka","month: 2021-03-01<br />monthly_bottles_sold:  691935<br />liquor_type: Vodka","month: 2021-04-01<br />monthly_bottles_sold:  680257<br />liquor_type: Vodka","month: 2021-05-01<br />monthly_bottles_sold:  654059<br />liquor_type: Vodka","month: 2021-06-01<br />monthly_bottles_sold:  801175<br />liquor_type: Vodka","month: 2021-07-01<br />monthly_bottles_sold:  721986<br />liquor_type: Vodka","month: 2021-08-01<br />monthly_bottles_sold:  754295<br />liquor_type: Vodka","month: 2021-09-01<br />monthly_bottles_sold:  705633<br />liquor_type: Vodka","month: 2021-10-01<br />monthly_bottles_sold:  680543<br />liquor_type: Vodka","month: 2021-11-01<br />monthly_bottles_sold:  721240<br />liquor_type: Vodka","month: 2021-12-01<br />monthly_bottles_sold:  720948<br />liquor_type: Vodka","month: 2022-01-01<br />monthly_bottles_sold:  559774<br />liquor_type: Vodka","month: 2022-02-01<br />monthly_bottles_sold:  550231<br />liquor_type: Vodka","month: 2022-03-01<br />monthly_bottles_sold:  581910<br />liquor_type: Vodka","month: 2022-04-01<br />monthly_bottles_sold:  674449<br />liquor_type: Vodka","month: 2022-05-01<br />monthly_bottles_sold:  733112<br />liquor_type: Vodka","month: 2022-06-01<br />monthly_bottles_sold:  801694<br />liquor_type: Vodka","month: 2022-07-01<br />monthly_bottles_sold:  677192<br />liquor_type: Vodka","month: 2022-08-01<br />monthly_bottles_sold:  832990<br />liquor_type: Vodka","month: 2022-09-01<br />monthly_bottles_sold:  705547<br />liquor_type: Vodka","month: 2022-10-01<br />monthly_bottles_sold:  738996<br />liquor_type: Vodka","month: 2022-11-01<br />monthly_bottles_sold:  681557<br />liquor_type: Vodka","month: 2022-12-01<br />monthly_bottles_sold:  694469<br />liquor_type: Vodka","month: 2023-01-01<br />monthly_bottles_sold:  629276<br />liquor_type: Vodka","month: 2023-02-01<br />monthly_bottles_sold:  612547<br />liquor_type: Vodka","month: 2023-03-01<br />monthly_bottles_sold:  706142<br />liquor_type: Vodka","month: 2023-04-01<br />monthly_bottles_sold:  656049<br />liquor_type: Vodka","month: 2023-05-01<br />monthly_bottles_sold:  775337<br />liquor_type: Vodka","month: 2023-06-01<br />monthly_bottles_sold:  844464<br />liquor_type: Vodka","month: 2023-07-01<br />monthly_bottles_sold:  694707<br />liquor_type: Vodka","month: 2023-08-01<br />monthly_bottles_sold:  831574<br />liquor_type: Vodka","month: 2023-09-01<br />monthly_bottles_sold:  663710<br />liquor_type: Vodka","month: 2023-10-01<br />monthly_bottles_sold:  737083<br />liquor_type: Vodka","month: 2023-11-01<br />monthly_bottles_sold:  712670<br />liquor_type: Vodka","month: 2023-12-01<br />monthly_bottles_sold:  666494<br />liquor_type: Vodka","month: 2024-01-01<br />monthly_bottles_sold:  648113<br />liquor_type: Vodka","month: 2024-02-01<br />monthly_bottles_sold:  648304<br />liquor_type: Vodka","month: 2024-03-01<br />monthly_bottles_sold:  648651<br />liquor_type: Vodka","month: 2024-04-01<br />monthly_bottles_sold:  713232<br />liquor_type: Vodka","month: 2024-05-01<br />monthly_bottles_sold:  758523<br />liquor_type: Vodka","month: 2024-06-01<br />monthly_bottles_sold:  737604<br />liquor_type: Vodka","month: 2024-07-01<br />monthly_bottles_sold:  742739<br />liquor_type: Vodka","month: 2024-08-01<br />monthly_bottles_sold:  795920<br />liquor_type: Vodka","month: 2024-09-01<br />monthly_bottles_sold:  643087<br />liquor_type: Vodka","month: 2024-10-01<br />monthly_bottles_sold:  788841<br />liquor_type: Vodka","month: 2024-11-01<br />monthly_bottles_sold:  705464<br />liquor_type: Vodka"],"type":"scatter","mode":"lines+markers","line":{"width":1.8897637795275593,"color":"rgba(231,107,243,1)","dash":"solid"},"hoveron":"points","name":"Vodka","legendgroup":"Vodka","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(231,107,243,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(231,107,243,1)"}},"frame":null},{"x":[1325376000,1328054400,1330560000,1333238400,1335830400,1338508800,1341100800,1343779200,1346457600,1349049600,1351728000,1354320000,1356998400,1359676800,1362096000,1364774400,1367366400,1370044800,1372636800,1375315200,1377993600,1380585600,1383264000,1385856000,1388534400,1391212800,1393632000,1396310400,1398902400,1401580800,1404172800,1406851200,1409529600,1412121600,1414800000,1417392000,1420070400,1422748800,1425168000,1427846400,1430438400,1433116800,1435708800,1438387200,1441065600,1443657600,1446336000,1448928000,1451606400,1454284800,1456790400,1459468800,1462060800,1464739200,1467331200,1470009600,1472688000,1475280000,1477958400,1480550400,1483228800,1485907200,1488326400,1491004800,1493596800,1496275200,1498867200,1501545600,1504224000,1506816000,1509494400,1512086400,1514764800,1517443200,1519862400,1522540800,1525132800,1527811200,1530403200,1533081600,1535760000,1538352000,1541030400,1543622400,1546300800,1548979200,1551398400,1554076800,1556668800,1559347200,1561939200,1564617600,1567296000,1569888000,1572566400,1575158400,1577836800,1580515200,1583020800,1585699200,1588291200,1590969600,1593561600,1596240000,1598918400,1601510400,1604188800,1606780800,1609459200,1612137600,1614556800,1617235200,1619827200,1622505600,1625097600,1627776000,1630454400,1633046400,1635724800,1638316800,1640995200,1643673600,1646092800,1648771200,1651363200,1654041600,1656633600,1659312000,1661990400,1664582400,1667260800,1669852800,1672531200,1675209600,1677628800,1680307200,1682899200,1685577600,1688169600,1690848000,1693526400,1696118400,1698796800,1701388800,1704067200,1706745600,1709251200,1711929600,1714521600,1717200000,1719792000,1722470400,1725148800,1727740800,1730419200],"y":[340421,431452,373689,402901,468374,397343,406905,432613,388419,716685,436243,542227,398242,436404,390494,466792,497742,402744,464763,456756,438608,699566,398616,584169,464454,470462,448352,507374,469908,509044,478722,455402,523953,623405,465443,701260,428397,535361,531015,512995,531795,568603,481502,490904,560182,635448,560201,714296,456842,609432,569201,525373,610640,584727,492028,522967,576815,622016,595597,729586,470383,566946,547948,476788,625606,567383,524366,576189,545163,682925,588741,724965,528381,547407,541213,546566,656915,583248,533134,620793,524690,887929,739514,904397,650511,707418,665419,726040,843388,725659,823679,734599,764106,951696,832494,969397,725129,756638,872496,846408,893939,905941,881459,821476,956571,1010773,895853,1174763,811434,868082,993362,919280,906730,1010391,879420,908307,927926,1038702,887991,1118994,787864,792731,793211,912049,933731,978010,832757,999273,944003,1005654,915874,1139110,883846,893914,956559,851459,1018485,1025727,914194,986689,921393,1022836,959018,1079304,897664,975700,894207,943472,1010410,939058,991678,935630,911571,1089473,927984],"text":["month: 2012-01-01<br />monthly_bottles_sold:  340421<br />liquor_type: Whisky","month: 2012-02-01<br />monthly_bottles_sold:  431452<br />liquor_type: Whisky","month: 2012-03-01<br />monthly_bottles_sold:  373689<br />liquor_type: Whisky","month: 2012-04-01<br />monthly_bottles_sold:  402901<br />liquor_type: Whisky","month: 2012-05-01<br />monthly_bottles_sold:  468374<br />liquor_type: Whisky","month: 2012-06-01<br />monthly_bottles_sold:  397343<br />liquor_type: Whisky","month: 2012-07-01<br />monthly_bottles_sold:  406905<br />liquor_type: Whisky","month: 2012-08-01<br />monthly_bottles_sold:  432613<br />liquor_type: Whisky","month: 2012-09-01<br />monthly_bottles_sold:  388419<br />liquor_type: Whisky","month: 2012-10-01<br />monthly_bottles_sold:  716685<br />liquor_type: Whisky","month: 2012-11-01<br />monthly_bottles_sold:  436243<br />liquor_type: Whisky","month: 2012-12-01<br />monthly_bottles_sold:  542227<br />liquor_type: Whisky","month: 2013-01-01<br />monthly_bottles_sold:  398242<br />liquor_type: Whisky","month: 2013-02-01<br />monthly_bottles_sold:  436404<br />liquor_type: Whisky","month: 2013-03-01<br />monthly_bottles_sold:  390494<br />liquor_type: Whisky","month: 2013-04-01<br />monthly_bottles_sold:  466792<br />liquor_type: Whisky","month: 2013-05-01<br />monthly_bottles_sold:  497742<br />liquor_type: Whisky","month: 2013-06-01<br />monthly_bottles_sold:  402744<br />liquor_type: Whisky","month: 2013-07-01<br />monthly_bottles_sold:  464763<br />liquor_type: Whisky","month: 2013-08-01<br />monthly_bottles_sold:  456756<br />liquor_type: Whisky","month: 2013-09-01<br />monthly_bottles_sold:  438608<br />liquor_type: Whisky","month: 2013-10-01<br />monthly_bottles_sold:  699566<br />liquor_type: Whisky","month: 2013-11-01<br />monthly_bottles_sold:  398616<br />liquor_type: Whisky","month: 2013-12-01<br />monthly_bottles_sold:  584169<br />liquor_type: Whisky","month: 2014-01-01<br />monthly_bottles_sold:  464454<br />liquor_type: Whisky","month: 2014-02-01<br />monthly_bottles_sold:  470462<br />liquor_type: Whisky","month: 2014-03-01<br />monthly_bottles_sold:  448352<br />liquor_type: Whisky","month: 2014-04-01<br />monthly_bottles_sold:  507374<br />liquor_type: Whisky","month: 2014-05-01<br />monthly_bottles_sold:  469908<br />liquor_type: Whisky","month: 2014-06-01<br />monthly_bottles_sold:  509044<br />liquor_type: Whisky","month: 2014-07-01<br />monthly_bottles_sold:  478722<br />liquor_type: Whisky","month: 2014-08-01<br />monthly_bottles_sold:  455402<br />liquor_type: Whisky","month: 2014-09-01<br />monthly_bottles_sold:  523953<br />liquor_type: Whisky","month: 2014-10-01<br />monthly_bottles_sold:  623405<br />liquor_type: Whisky","month: 2014-11-01<br />monthly_bottles_sold:  465443<br />liquor_type: Whisky","month: 2014-12-01<br />monthly_bottles_sold:  701260<br />liquor_type: Whisky","month: 2015-01-01<br />monthly_bottles_sold:  428397<br />liquor_type: Whisky","month: 2015-02-01<br />monthly_bottles_sold:  535361<br />liquor_type: Whisky","month: 2015-03-01<br />monthly_bottles_sold:  531015<br />liquor_type: Whisky","month: 2015-04-01<br />monthly_bottles_sold:  512995<br />liquor_type: Whisky","month: 2015-05-01<br />monthly_bottles_sold:  531795<br />liquor_type: Whisky","month: 2015-06-01<br />monthly_bottles_sold:  568603<br />liquor_type: Whisky","month: 2015-07-01<br />monthly_bottles_sold:  481502<br />liquor_type: Whisky","month: 2015-08-01<br />monthly_bottles_sold:  490904<br />liquor_type: Whisky","month: 2015-09-01<br />monthly_bottles_sold:  560182<br />liquor_type: Whisky","month: 2015-10-01<br />monthly_bottles_sold:  635448<br />liquor_type: Whisky","month: 2015-11-01<br />monthly_bottles_sold:  560201<br />liquor_type: Whisky","month: 2015-12-01<br />monthly_bottles_sold:  714296<br />liquor_type: Whisky","month: 2016-01-01<br />monthly_bottles_sold:  456842<br />liquor_type: Whisky","month: 2016-02-01<br />monthly_bottles_sold:  609432<br />liquor_type: Whisky","month: 2016-03-01<br />monthly_bottles_sold:  569201<br />liquor_type: Whisky","month: 2016-04-01<br />monthly_bottles_sold:  525373<br />liquor_type: Whisky","month: 2016-05-01<br />monthly_bottles_sold:  610640<br />liquor_type: Whisky","month: 2016-06-01<br />monthly_bottles_sold:  584727<br />liquor_type: Whisky","month: 2016-07-01<br />monthly_bottles_sold:  492028<br />liquor_type: Whisky","month: 2016-08-01<br />monthly_bottles_sold:  522967<br />liquor_type: Whisky","month: 2016-09-01<br />monthly_bottles_sold:  576815<br />liquor_type: Whisky","month: 2016-10-01<br />monthly_bottles_sold:  622016<br />liquor_type: Whisky","month: 2016-11-01<br />monthly_bottles_sold:  595597<br />liquor_type: Whisky","month: 2016-12-01<br />monthly_bottles_sold:  729586<br />liquor_type: Whisky","month: 2017-01-01<br />monthly_bottles_sold:  470383<br />liquor_type: Whisky","month: 2017-02-01<br />monthly_bottles_sold:  566946<br />liquor_type: Whisky","month: 2017-03-01<br />monthly_bottles_sold:  547948<br />liquor_type: Whisky","month: 2017-04-01<br />monthly_bottles_sold:  476788<br />liquor_type: Whisky","month: 2017-05-01<br />monthly_bottles_sold:  625606<br />liquor_type: Whisky","month: 2017-06-01<br />monthly_bottles_sold:  567383<br />liquor_type: Whisky","month: 2017-07-01<br />monthly_bottles_sold:  524366<br />liquor_type: Whisky","month: 2017-08-01<br />monthly_bottles_sold:  576189<br />liquor_type: Whisky","month: 2017-09-01<br />monthly_bottles_sold:  545163<br />liquor_type: Whisky","month: 2017-10-01<br />monthly_bottles_sold:  682925<br />liquor_type: Whisky","month: 2017-11-01<br />monthly_bottles_sold:  588741<br />liquor_type: Whisky","month: 2017-12-01<br />monthly_bottles_sold:  724965<br />liquor_type: Whisky","month: 2018-01-01<br />monthly_bottles_sold:  528381<br />liquor_type: Whisky","month: 2018-02-01<br />monthly_bottles_sold:  547407<br />liquor_type: Whisky","month: 2018-03-01<br />monthly_bottles_sold:  541213<br />liquor_type: Whisky","month: 2018-04-01<br />monthly_bottles_sold:  546566<br />liquor_type: Whisky","month: 2018-05-01<br />monthly_bottles_sold:  656915<br />liquor_type: Whisky","month: 2018-06-01<br />monthly_bottles_sold:  583248<br />liquor_type: Whisky","month: 2018-07-01<br />monthly_bottles_sold:  533134<br />liquor_type: Whisky","month: 2018-08-01<br />monthly_bottles_sold:  620793<br />liquor_type: Whisky","month: 2018-09-01<br />monthly_bottles_sold:  524690<br />liquor_type: Whisky","month: 2018-10-01<br />monthly_bottles_sold:  887929<br />liquor_type: Whisky","month: 2018-11-01<br />monthly_bottles_sold:  739514<br />liquor_type: Whisky","month: 2018-12-01<br />monthly_bottles_sold:  904397<br />liquor_type: Whisky","month: 2019-01-01<br />monthly_bottles_sold:  650511<br />liquor_type: Whisky","month: 2019-02-01<br />monthly_bottles_sold:  707418<br />liquor_type: Whisky","month: 2019-03-01<br />monthly_bottles_sold:  665419<br />liquor_type: Whisky","month: 2019-04-01<br />monthly_bottles_sold:  726040<br />liquor_type: Whisky","month: 2019-05-01<br />monthly_bottles_sold:  843388<br />liquor_type: Whisky","month: 2019-06-01<br />monthly_bottles_sold:  725659<br />liquor_type: Whisky","month: 2019-07-01<br />monthly_bottles_sold:  823679<br />liquor_type: Whisky","month: 2019-08-01<br />monthly_bottles_sold:  734599<br />liquor_type: Whisky","month: 2019-09-01<br />monthly_bottles_sold:  764106<br />liquor_type: Whisky","month: 2019-10-01<br />monthly_bottles_sold:  951696<br />liquor_type: Whisky","month: 2019-11-01<br />monthly_bottles_sold:  832494<br />liquor_type: Whisky","month: 2019-12-01<br />monthly_bottles_sold:  969397<br />liquor_type: Whisky","month: 2020-01-01<br />monthly_bottles_sold:  725129<br />liquor_type: Whisky","month: 2020-02-01<br />monthly_bottles_sold:  756638<br />liquor_type: Whisky","month: 2020-03-01<br />monthly_bottles_sold:  872496<br />liquor_type: Whisky","month: 2020-04-01<br />monthly_bottles_sold:  846408<br />liquor_type: Whisky","month: 2020-05-01<br />monthly_bottles_sold:  893939<br />liquor_type: Whisky","month: 2020-06-01<br />monthly_bottles_sold:  905941<br />liquor_type: Whisky","month: 2020-07-01<br />monthly_bottles_sold:  881459<br />liquor_type: Whisky","month: 2020-08-01<br />monthly_bottles_sold:  821476<br />liquor_type: Whisky","month: 2020-09-01<br />monthly_bottles_sold:  956571<br />liquor_type: Whisky","month: 2020-10-01<br />monthly_bottles_sold: 1010773<br />liquor_type: Whisky","month: 2020-11-01<br />monthly_bottles_sold:  895853<br />liquor_type: Whisky","month: 2020-12-01<br />monthly_bottles_sold: 1174763<br />liquor_type: Whisky","month: 2021-01-01<br />monthly_bottles_sold:  811434<br />liquor_type: Whisky","month: 2021-02-01<br />monthly_bottles_sold:  868082<br />liquor_type: Whisky","month: 2021-03-01<br />monthly_bottles_sold:  993362<br />liquor_type: Whisky","month: 2021-04-01<br />monthly_bottles_sold:  919280<br />liquor_type: Whisky","month: 2021-05-01<br />monthly_bottles_sold:  906730<br />liquor_type: Whisky","month: 2021-06-01<br />monthly_bottles_sold: 1010391<br />liquor_type: Whisky","month: 2021-07-01<br />monthly_bottles_sold:  879420<br />liquor_type: Whisky","month: 2021-08-01<br />monthly_bottles_sold:  908307<br />liquor_type: Whisky","month: 2021-09-01<br />monthly_bottles_sold:  927926<br />liquor_type: Whisky","month: 2021-10-01<br />monthly_bottles_sold: 1038702<br />liquor_type: Whisky","month: 2021-11-01<br />monthly_bottles_sold:  887991<br />liquor_type: Whisky","month: 2021-12-01<br />monthly_bottles_sold: 1118994<br />liquor_type: Whisky","month: 2022-01-01<br />monthly_bottles_sold:  787864<br />liquor_type: Whisky","month: 2022-02-01<br />monthly_bottles_sold:  792731<br />liquor_type: Whisky","month: 2022-03-01<br />monthly_bottles_sold:  793211<br />liquor_type: Whisky","month: 2022-04-01<br />monthly_bottles_sold:  912049<br />liquor_type: Whisky","month: 2022-05-01<br />monthly_bottles_sold:  933731<br />liquor_type: Whisky","month: 2022-06-01<br />monthly_bottles_sold:  978010<br />liquor_type: Whisky","month: 2022-07-01<br />monthly_bottles_sold:  832757<br />liquor_type: Whisky","month: 2022-08-01<br />monthly_bottles_sold:  999273<br />liquor_type: Whisky","month: 2022-09-01<br />monthly_bottles_sold:  944003<br />liquor_type: Whisky","month: 2022-10-01<br />monthly_bottles_sold: 1005654<br />liquor_type: Whisky","month: 2022-11-01<br />monthly_bottles_sold:  915874<br />liquor_type: Whisky","month: 2022-12-01<br />monthly_bottles_sold: 1139110<br />liquor_type: Whisky","month: 2023-01-01<br />monthly_bottles_sold:  883846<br />liquor_type: Whisky","month: 2023-02-01<br />monthly_bottles_sold:  893914<br />liquor_type: Whisky","month: 2023-03-01<br />monthly_bottles_sold:  956559<br />liquor_type: Whisky","month: 2023-04-01<br />monthly_bottles_sold:  851459<br />liquor_type: Whisky","month: 2023-05-01<br />monthly_bottles_sold: 1018485<br />liquor_type: Whisky","month: 2023-06-01<br />monthly_bottles_sold: 1025727<br />liquor_type: Whisky","month: 2023-07-01<br />monthly_bottles_sold:  914194<br />liquor_type: Whisky","month: 2023-08-01<br />monthly_bottles_sold:  986689<br />liquor_type: Whisky","month: 2023-09-01<br />monthly_bottles_sold:  921393<br />liquor_type: Whisky","month: 2023-10-01<br />monthly_bottles_sold: 1022836<br />liquor_type: Whisky","month: 2023-11-01<br />monthly_bottles_sold:  959018<br />liquor_type: Whisky","month: 2023-12-01<br />monthly_bottles_sold: 1079304<br />liquor_type: Whisky","month: 2024-01-01<br />monthly_bottles_sold:  897664<br />liquor_type: Whisky","month: 2024-02-01<br />monthly_bottles_sold:  975700<br />liquor_type: Whisky","month: 2024-03-01<br />monthly_bottles_sold:  894207<br />liquor_type: Whisky","month: 2024-04-01<br />monthly_bottles_sold:  943472<br />liquor_type: Whisky","month: 2024-05-01<br />monthly_bottles_sold: 1010410<br />liquor_type: Whisky","month: 2024-06-01<br />monthly_bottles_sold:  939058<br />liquor_type: Whisky","month: 2024-07-01<br />monthly_bottles_sold:  991678<br />liquor_type: Whisky","month: 2024-08-01<br />monthly_bottles_sold:  935630<br />liquor_type: Whisky","month: 2024-09-01<br />monthly_bottles_sold:  911571<br />liquor_type: Whisky","month: 2024-10-01<br />monthly_bottles_sold: 1089473<br />liquor_type: Whisky","month: 2024-11-01<br />monthly_bottles_sold:  927984<br />liquor_type: Whisky"],"type":"scatter","mode":"lines+markers","line":{"width":1.8897637795275593,"color":"rgba(255,98,188,1)","dash":"solid"},"hoveron":"points","name":"Whisky","legendgroup":"Whisky","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(255,98,188,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(255,98,188,1)"}},"frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":40.182648401826491,"l":66.484018264840202},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Liquor bottles sold by month","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0.5,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1305123840,1750671360],"tickmode":"array","ticktext":["2015","2020","2025"],"tickvals":[1420070400,1577836800,1735689600],"categoryorder":"array","categoryarray":["2015","2020","2025"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Date","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-58721.350000000006,1233500.3500000001],"tickmode":"array","ticktext":["0","300000","600000","900000","1200000"],"tickvals":[0,300000,600000,900000,1200000],"categoryorder":"array","categoryarray":["0","300000","600000","900000","1200000"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Bottles sold","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Liquor type","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"2c0c3c854a4d":{"x":{},"y":{},"colour":{},"type":"scatter"},"2c0c171bc495":{"x":{},"y":{},"colour":{}}},"cur_data":"2c0c3c854a4d","visdat":{"2c0c3c854a4d":["function (y) ","x"],"2c0c171bc495":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Since this chart is interactive, you can zoom in to examine it further; to zoom out, double-click on the chart.</p>
<p>The most popular liquors in Iowa seem to be whisky and vodka. The good news for Mezcal adepts is that it has been available in stores since 2016. Let’s say we like mezcal and want to buy a bottle as a treat. However, as the chart shows, it is not the most popular drink, so now we want to know where to buy a bottle. Our quest will begin with a query to our DuckDB.</p>
<p>For this query, we will use a Common Table Expression (CTE) to retrieve the latest record for each store. We also filter the data to include only records from 2024 onward, where a geolocation is available, and the invoice corresponds to a mezcal purchase. Since the CTE ranks records by the most recent purchases, we can easily select the first record for each store in the main query.</p>
<div class="cell" data-output.var="bottles_sold_per_type">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> ranked_stores <span class="kw">AS</span> (</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">store</span>, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>      name, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>      address, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      store_location,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> <span class="kw">store</span> <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">date</span> <span class="kw">DESC</span>) <span class="kw">AS</span> row_num</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> iowa_liquor_sales</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> <span class="dt">YEAR</span>(<span class="dt">date</span>) <span class="op">&gt;=</span> <span class="dv">2024</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>          <span class="kw">AND</span> store_location <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>          <span class="kw">AND</span> liquor_type <span class="op">=</span> <span class="st">'Mezcal'</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">store</span>, name, address, store_location</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> ranked_stores</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> row_num <span class="op">=</span> <span class="dv">1</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting table is stored in <code>bottles_sold_per_type</code>, let’s examine it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>bottles_sold_per_type <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="pslmkasxtq" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#pslmkasxtq table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#pslmkasxtq thead, #pslmkasxtq tbody, #pslmkasxtq tfoot, #pslmkasxtq tr, #pslmkasxtq td, #pslmkasxtq th {
  border-style: none;
}

#pslmkasxtq p {
  margin: 0;
  padding: 0;
}

#pslmkasxtq .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pslmkasxtq .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#pslmkasxtq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pslmkasxtq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pslmkasxtq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pslmkasxtq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pslmkasxtq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pslmkasxtq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pslmkasxtq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pslmkasxtq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pslmkasxtq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pslmkasxtq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pslmkasxtq .gt_spanner_row {
  border-bottom-style: hidden;
}

#pslmkasxtq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#pslmkasxtq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pslmkasxtq .gt_from_md > :first-child {
  margin-top: 0;
}

#pslmkasxtq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pslmkasxtq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pslmkasxtq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#pslmkasxtq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#pslmkasxtq .gt_row_group_first td {
  border-top-width: 2px;
}

#pslmkasxtq .gt_row_group_first th {
  border-top-width: 2px;
}

#pslmkasxtq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pslmkasxtq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#pslmkasxtq .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#pslmkasxtq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pslmkasxtq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pslmkasxtq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pslmkasxtq .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#pslmkasxtq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pslmkasxtq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pslmkasxtq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pslmkasxtq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pslmkasxtq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pslmkasxtq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pslmkasxtq .gt_left {
  text-align: left;
}

#pslmkasxtq .gt_center {
  text-align: center;
}

#pslmkasxtq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pslmkasxtq .gt_font_normal {
  font-weight: normal;
}

#pslmkasxtq .gt_font_bold {
  font-weight: bold;
}

#pslmkasxtq .gt_font_italic {
  font-style: italic;
}

#pslmkasxtq .gt_super {
  font-size: 65%;
}

#pslmkasxtq .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#pslmkasxtq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#pslmkasxtq .gt_indent_1 {
  text-indent: 5px;
}

#pslmkasxtq .gt_indent_2 {
  text-indent: 10px;
}

#pslmkasxtq .gt_indent_3 {
  text-indent: 15px;
}

#pslmkasxtq .gt_indent_4 {
  text-indent: 20px;
}

#pslmkasxtq .gt_indent_5 {
  text-indent: 25px;
}

#pslmkasxtq .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#pslmkasxtq div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="store" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">store</th>
<th id="name" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">name</th>
<th id="address" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">address</th>
<th id="store_location" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">store_location</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="store">010065</td>
<td class="gt_row gt_left" headers="name">MADELLA WINE AND SPIRITS / BETTENDORF</td>
<td class="gt_row gt_left" headers="address">3263 MOENCKS COURT UNIT 3265</td>
<td class="gt_row gt_left" headers="store_location">POINT (-90.44919 41.55596)</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="store">010076</td>
<td class="gt_row gt_left" headers="name">HOMETOWN SPIRITS / TIFFIN</td>
<td class="gt_row gt_left" headers="address">119 WEST MARENGO ROAD</td>
<td class="gt_row gt_left" headers="store_location">POINT (-91.664284585 41.70668719)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="store">010121</td>
<td class="gt_row gt_left" headers="name">BIG 10 MART #18 / DAVENPORT</td>
<td class="gt_row gt_left" headers="address">5310 CORPORATE PARK DRIVE</td>
<td class="gt_row gt_left" headers="store_location">POINT (-90.517948014 41.575410995)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>It contains the:</p>
<ul>
<li>Store code (ID)</li>
<li>Store address</li>
<li>Store name</li>
<li>Geolocation</li>
</ul>
<p>All the information we need to get our bottle. But a table with more than 300 stores is not easy to digest. So let’s put that into a map; locating the stores closest to us would be easy.</p>
<p>We will begin by converting our retrieved information into a <a href="https://r-spatial.github.io/sf/articles/sf1.html">simple features</a> object (<code>sf</code>). The <code>sf</code> library greatly simplifies geospatial analysis, especially when working with geometry data types. First, we transform the <code>store_location</code> column (which is string type) into a <code>POINT</code> geometry type using the <code>st_as_sfc</code> function. Specifying the coordinate reference system (<code>crs = 4326</code>) is crucial here.</p>
<p>Although our dataset documentation does not explicitly mention the coordinate reference system, WGS84 CRS (EPSG:4326) is the most logical choice. This is because WGS84 is the standard and most widely used system for representing latitude-longitude coordinates, making it the most likely CRS for our data<a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>bottles_sold_per_type_0 <span class="ot">&lt;-</span> bottles_sold_per_type <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geometry =</span> <span class="fu">st_as_sfc</span>(store_location, <span class="at">crs =</span> <span class="dv">4326</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>store_location) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># To peep the contents of our sf object</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>bottles_sold_per_type_0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 343 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -96.43086 ymin: 40.40001 xmax: -90.1915 ymax: 43.44369
Geodetic CRS:  WGS 84
First 10 features:
    store                                    name                      address
1  010065   MADELLA WINE AND SPIRITS / BETTENDORF 3263 MOENCKS COURT UNIT 3265
2  010076               HOMETOWN SPIRITS / TIFFIN        119 WEST MARENGO ROAD
3  010121             BIG 10 MART #18 / DAVENPORT    5310 CORPORATE PARK DRIVE
4  010153               IOWA SPIRITS / BURLINGTON           2107 AGENCY STREET
5  010218       ABARROTES GASCA LLC / ROCK VALLEY           954 WESTVIEW DRIVE
6  010304 VINTON LIQUOR TOBACCO AND VAPE / VINTON                 411 A AVENUE
7  010320                    SUPER MART / OELWEIN   701 SOUTH FREDERICK AVENUE
8    2535       HY-VEE FOOD STORE #1 (1887) / WDM         1700 VALLEY WEST DR.
9    2576    HY-VEE WINE AND SPIRITS / STORM LAKE               1250 N LAKE ST
10   2588  HY-VEE FOOD AND DRUG #6 / CEDAR RAPIDS         4035 MT VERNON RD SE
                     geometry
1  POINT (-90.44919 41.55596)
2  POINT (-91.66428 41.70669)
3  POINT (-90.51795 41.57541)
4  POINT (-91.12961 40.81423)
5  POINT (-96.30885 43.19936)
6  POINT (-92.02559 42.16706)
7  POINT (-91.91348 42.66924)
8  POINT (-93.75334 41.59769)
9    POINT (-95.2033 42.6533)
10 POINT (-91.60966 41.97553)</code></pre>
</div>
</div>
<p>We displayed a print of the contents of our <code>sf</code> object so you can get a sense of what it is: a data frame with geospatial metadata and geometry types. DuckDB has some extensions that make geospatial types available, but we are not using them here to avoid adding more complexity to the upstream system.</p>
<p>Let’s continue with our map. We will create the map using the <code>leaflet</code> library; it is easy to use and has beautiful and usable results. We feed this visualization with the <code>sf</code> object we just created.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(<span class="at">data =</span> bottles_sold_per_type_0) <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(providers<span class="sc">$</span>CartoDB.Positron) <span class="sc">%&gt;%</span>  <span class="co"># Add a base map</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">lng =</span> <span class="sc">~</span><span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],  <span class="co"># Extract longitude</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="sc">~</span><span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>],  <span class="co"># Extract latitude</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">popup =</span> <span class="sc">~</span><span class="fu">paste0</span>(</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;strong&gt;Store:&lt;/strong&gt; "</span>, name, <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;strong&gt;Address:&lt;/strong&gt; "</span>, address, <span class="st">"&lt;br&gt;"</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">radius =</span> <span class="dv">5</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#ed7c65"</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillOpacity =</span> <span class="fl">0.7</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLegend</span>(</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Liquor stores that sell mezcal in Iowa"</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> <span class="st">"#ed7c65"</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="st">"Store locations"</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">opacity =</span> <span class="fl">0.7</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-40721d57f370410b7943" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-40721d57f370410b7943">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[41.55596,41.70668719,41.575410995,40.814232012,43.19936,42.16706,42.66924,41.59769,42.653299017,41.97553,41.00646,41.836589003,41.245741021,41.39695,41.65068,42.02126,42.48871599,41.828481984,41.702085986,41.03257,41.628444009,41.83847,42.792778999,41.73828,41.83334,41.80942,43.2615,42.77626,42.005652325,43.403774981,43.14276,41.576228985,42.51674,41.65195,43.33153601,41.791099995,42.03344,41.64315,41.35838,41.67308,42.470301996,43.077796019,41.598379003,41.59835,43.1523,42.51213201,41.295874986,41.826022985,41.56318,42.04434,41.336681988,43.331967007,42.51808,42.753054017,41.049663998,41.030861,41.60564,40.81585,41.02898601,41.95585,43.08174,41.55236,41.60562,41.692593983,42.043596991,41.602918366,41.615730003,41.015781721,41.3058,42.49784,41.73462,41.65099,41.36867,42.03599,41.57692,42.03062,41.61697,42.521562992,42.664579005,40.739415018,41.228713981,41.008547997,41.654283992,41.576127852,42.844741015,43.41662,41.71524,41.688753018,41.69897,41.5974,43.187063012,41.732228986,41.897244981,41.897301014,41.60775,42.10821,41.525557992,41.62996,41.631082004,43.13828,42.03513,41.62773,42.2678,42.064356336,41.917248979,42.033397011,41.59528,43.371432989,42.510790989,42.18766,41.69032,42.093190994,41.549773981,41.660256978,41.284808987,41.570836991,43.14835,41.64446,41.63057,41.554268986,41.32519,41.40387,42.46994,41.597293418,41.53699,42.71212,43.29116,42.4671,41.598374979,41.538506021,41.73676502,41.59604,42.72571,42.54203,41.699423013,41.00666,43.36181,43.37084,41.85442,43.18455,42.06352702,41.40905,41.584714992,41.833301998,42.012058991,42.512802017,43.16367,41.70052,42.477552007,41.015284993,41.66608,43.14635,41.59955599,41.55472,43.142923994,41.65096,42.02297,43.402611992,42.0348,41.964425988,41.028661002,42.0229,43.043388013,41.209447003,42.05011,41.53823,42.031895349,42.647124991,42.53326,42.167937999,41.76082,41.64434,41.019244641,42.52055,40.992144989,41.584168995,42.031846024,43.293545997,42.068018002,43.30328,41.732965001,42.46814198,42.458267008,41.65915,42.49183,42.49105,41.526557288,41.58429,41.28012,42.432101011,41.641334999,41.29623,43.421214997,41.578554,41.60575,43.419692006,42.016893002,41.406542008,40.40001,41.58609,40.960826008,42.01149,41.67627,41.56089,41.70491,41.9756,42.53909,41.771641994,41.644449379,41.752728355,41.978044809,41.528569987,41.545775017,41.554963007,43.06834,41.62968,41.557819979,42.99719,40.80939,41.59907,41.657327126,41.583797006,41.96359,42.03922,41.4508,41.66502,41.02657198,42.508306711,41.570897005,41.59111,42.46973,42.701639003,41.6866,41.74124,42.469141019,43.3015,43.30421,42.521043984,41.57154,41.66008,41.578782993,41.61825,41.65908699,42.561117989,40.404105992,42.51229,41.6636,41.64296,42.517663018,41.308237999,43.42284,41.642006012,42.48406,42.35012,43.185073986,42.457306987,42.02338,41.550358996,41.586633987,41.525087013,42.64746,41.61401,41.67179,42.3161,41.73168,43.14926,40.41614,43.067212986,43.147681017,41.226183987,41.23811,43.36166,42.495760979,40.99901,41.634223751,41.75189,41.62526,41.77242,42.04939,41.64755,41.58235,42.517074986,42.02028,43.42171,41.64404,41.561443015,42.07095,41.55535,41.60036,42.0429,43.148589992,41.973867687,41.570983004,42.53021299,42.049435993,41.557983007,41.573777991,42.271301994,41.977536321,41.691378984,43.30755,41.29656,41.72892,41.96759,42.51125,41.26138,42.470329992,41.42662,42.454405004,41.30041,41.042050003,41.848415994,41.047443003,41.599596013,41.734121997,41.62835,42.45998,41.5422,43.146646984,42.44631,42.48884,42.997976999,41.68238,41.557345982,42.002247009,42.51054,42.489821982,41.92012,42.749646012,41.652869001,43.061022993,42.050483018,42.49736,41.63036,41.71868,41.74573,42.50233,42.506613993,43.443689017,41.22245,42.458951013,42.021632005,42.51229],[-90.44919,-91.664284585,-90.517948014,-91.129609016,-96.30885000000001,-92.02558999999999,-91.91348000000001,-93.75333999999999,-95.20329803,-91.60966000000001,-91.97939,-90.191495014,-95.822889989,-92.8993,-95.33942999999999,-91.66464000000001,-95.54443503500001,-90.20451001399999,-93.59968296,-93.76567,-93.61715302499999,-94.08102,-96.17191302400001,-91.60827999999999,-94.10688,-90.53908,-93.63329,-96.17821000000001,-91.63428072400001,-95.751553958,-93.39664999999999,-93.613849968,-90.74393999999999,-93.50942000000001,-95.149544969,-92.072554013,-91.66808,-93.77516,-93.56585,-91.56558,-96.35281897,-96.177822014,-93.599255985,-93.75978000000001,-93.20865000000001,-90.72123297100001,-92.63150801499999,-90.534765967,-93.81059999999999,-92.89304,-94.01431903,-95.149188989,-92.45578999999999,-93.202850219,-94.367469984,-93.77636803,-93.62003,-91.13678,-93.77315398899999,-91.65732,-94.23491,-90.48372999999999,-93.85193,-94.35720802,-91.689646967,-90.34381174400001,-93.867468002,-93.308495814,-94.45328000000001,-92.33538,-93.60196999999999,-91.50075,-93.55701999999999,-91.57201000000001,-90.51390000000001,-91.70140000000001,-93.85435,-93.262667001,-93.901580001,-95.027259036,-95.848022958,-91.170863989,-90.581520978,-93.708885998,-91.808784991,-95.1268,-93.60048999999999,-93.793817979,-93.03507,-93.51982,-95.831661986,-93.599585981,-92.277701009,-92.27721896600001,-93.73587999999999,-91.29085000000001,-90.50689102600001,-93.70587999999999,-93.541625959,-95.14512200599999,-91.63809000000001,-93.60758,-93.92731999999999,-94.862375875,-91.42304100600001,-91.55303895999999,-93.5971,-92.106556041,-92.345643962,-92.71643,-93.77731,-92.67879401899999,-90.500173015,-91.53059566,-95.92894998200001,-93.703726015,-93.2216,-93.73648,-93.75648,-93.59478097100001,-93.10948,-94.99042,-93.82476,-93.808788647,-90.61232,-92.47395,-91.79731,-92.32131,-93.71410499,-90.59905902,-95.702833978,-93.58651999999999,-92.47887,-96.35847,-93.035735019,-91.96541999999999,-91.21922000000001,-95.12597,-95.60229,-95.85478999999999,-93.876907031,-91.06337000000001,-93.654115961,-90.224458021,-95.360099969,-90.66634600499999,-93.20108999999999,-93.46326999999999,-92.28774303199999,-92.44006601700001,-91.5021,-95.14509,-93.673259976,-93.59524,-93.37843198,-93.6972,-93.56332,-94.82899601299999,-91.66913,-92.484654245,-92.808752997,-93.61906999999999,-91.390506984,-93.843053027,-92.90803,-90.59742,-96.097096049,-95.19858497,-96.37094999999999,-95.79214500099999,-93.61239999999999,-93.47702,-95.23285749199999,-96.41897,-94.73261502299999,-92.52644395999999,-91.679633107,-94.21824201699999,-90.681439969,-91.78559,-93.59958003,-91.894997979,-92.35573501899999,-93.77446999999999,-90.70516000000001,-90.72265,-93.628774995,-93.62247000000001,-91.3592,-96.37104499900001,-93.504225991,-92.64815,-95.106907988,-91.260266039,-93.61378000000001,-93.535372975,-93.163901024,-95.013438032,-91.38773999999999,-93.66455000000001,-91.529627969,-91.65919,-91.51917,-93.77432,-93.62318999999999,-91.65976999999999,-92.4747,-91.12743802,-93.737581695,-91.606805181,-91.715411261,-90.481897029,-90.620151996,-93.597559991,-94.22686,-93.70716,-90.62426399,-96.05219,-91.14118999999999,-93.7366,-91.530453587,-93.78913098699999,-91.71559000000001,-92.91279,-91.0365,-93.69898000000001,-92.400860001,-94.176547339,-93.597361005,-93.77168,-91.1165,-92.479642011,-93.778782018,-92.72735,-93.827403008,-96.43086,-91.78668,-92.436903022,-93.77255,-91.53395,-93.702869971,-94.01967999999999,-93.772949974,-92.45665397099999,-91.391593028,-92.42917,-91.52983999999999,-91.52938,-90.73821504199999,-93.110557,-95.12549,-91.525221351,-91.44506,-95.46737,-95.477375032,-91.888685986,-93.61060999999999,-90.484845028,-93.664461995,-90.56202399999999,-95.20241,-93.72265,-91.57379,-92.19051,-93.58566999999999,-93.23538000000001,-91.40268,-92.675145042,-93.214273999,-95.846917972,-95.87857,-95.14021,-92.31519703399999,-92.41042,-91.497024713,-91.62284,-93.69825,-93.71316,-91.6391,-91.54362,-93.71460999999999,-92.45617502899999,-93.61869,-95.11185,-93.46496,-90.609028037,-94.87692,-90.54886999999999,-93.71556,-91.55137000000001,-93.221655019,-91.69843254200001,-93.729528027,-92.338871971,-92.910379969,-95.899250971,-90.598528027,-93.92744303400001,-91.642487613,-93.578036024,-91.79695,-91.70457,-93.60857,-91.73299,-92.43651,-95.87951,-92.357867962,-91.04434999999999,-92.352287039,-91.69222000000001,-95.744128011,-90.193580012,-94.37373202000001,-93.834537013,-92.727773,-93.56973000000001,-92.32785,-93.64348,-93.17067796000001,-96.34779,-96.36328,-96.041738966,-91.592,-90.526633007,-93.614294964,-96.42021,-96.371914035,-91.41231000000001,-95.547190247,-93.601114002,-92.68288497499999,-90.66659603799999,-90.66656999999999,-93.73889,-91.60636,-92.72579,-94.19243,-94.153157041,-93.218049041,-93.24162,-92.35812000599999,-93.650866967,-92.42917],5,null,null,{"interactive":true,"className":"","stroke":true,"color":"#ed7c65","weight":5,"opacity":0.5,"fill":true,"fillColor":"#ed7c65","fillOpacity":0.7},null,null,["<strong>Store:<\/strong> MADELLA WINE AND SPIRITS / BETTENDORF<br><strong>Address:<\/strong> 3263 MOENCKS COURT UNIT 3265<br>","<strong>Store:<\/strong> HOMETOWN SPIRITS / TIFFIN<br><strong>Address:<\/strong> 119 WEST MARENGO ROAD<br>","<strong>Store:<\/strong> BIG 10 MART #18 / DAVENPORT<br><strong>Address:<\/strong> 5310 CORPORATE PARK DRIVE<br>","<strong>Store:<\/strong> IOWA SPIRITS / BURLINGTON<br><strong>Address:<\/strong> 2107 AGENCY STREET<br>","<strong>Store:<\/strong> ABARROTES GASCA LLC / ROCK VALLEY<br><strong>Address:<\/strong> 954 WESTVIEW DRIVE<br>","<strong>Store:<\/strong> VINTON LIQUOR TOBACCO AND VAPE / VINTON<br><strong>Address:<\/strong> 411 A AVENUE<br>","<strong>Store:<\/strong> SUPER MART / OELWEIN<br><strong>Address:<\/strong> 701 SOUTH FREDERICK AVENUE<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #1 (1887) / WDM<br><strong>Address:<\/strong> 1700 VALLEY WEST DR.<br>","<strong>Store:<\/strong> HY-VEE WINE AND SPIRITS / STORM LAKE<br><strong>Address:<\/strong> 1250 N LAKE ST<br>","<strong>Store:<\/strong> HY-VEE FOOD AND DRUG #6 / CEDAR RAPIDS<br><strong>Address:<\/strong> 4035 MT VERNON RD SE<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE / FAIRFIELD<br><strong>Address:<\/strong> 1300 WEST BURLINGTON AVE<br>","<strong>Store:<\/strong> HY-VEE FOOD AND DRUG / CLINTON<br><strong>Address:<\/strong> 901 SOUTH 4TH ST<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #2 / COUNCIL BLUFFS<br><strong>Address:<\/strong> 1745 MADISON AVE<br>","<strong>Store:<\/strong> HY-VEE WINE AND SPIRITS / PELLA<br><strong>Address:<\/strong> 512 E OSKALOOSA<br>","<strong>Store:<\/strong> HY-VEE WINE AND SPIRITS / HARLAN<br><strong>Address:<\/strong> 1808 23RD ST<br>","<strong>Store:<\/strong> CVS PHARMACY #8526 / CEDAR RAPIDS<br><strong>Address:<\/strong> 4116 CENTER POINT RD NE<br>","<strong>Store:<\/strong> SPIRITS, STOGIES AND STUFF<br><strong>Address:<\/strong> 118 SOUTH MAIN ST.<br>","<strong>Store:<\/strong> SMOKIN' JOE'S #11 TOBACCO AND LIQUOR OUTLET<br><strong>Address:<\/strong> 1606 CAMANCHE AVE<br>","<strong>Store:<\/strong> FAREWAY STORES #909 / ANKENY<br><strong>Address:<\/strong> 109 SE ORALABOR ROAD<br>","<strong>Store:<\/strong> FAREWAY STORES #699 / OSCEOLA<br><strong>Address:<\/strong> 215 S MAIN ST<br>","<strong>Store:<\/strong> WALGREENS #07453 / DES MOINES<br><strong>Address:<\/strong> 104 E EUCLID AVE<br>","<strong>Store:<\/strong> BLUEJAY MARKET<br><strong>Address:<\/strong> 2810 WILLS AVE<br>","<strong>Store:<\/strong> BREW COFFEE WINE SPIRIT AND CIGARS<br><strong>Address:<\/strong> 346 PLYMOUTH ST SW<br>","<strong>Store:<\/strong> JOHNCY'S LIQUOR STORE<br><strong>Address:<\/strong> 585 HWY 965 STE D & E<br>","<strong>Store:<\/strong> JMC SUPERMARKET / PERRY<br><strong>Address:<\/strong> 605 1ST AVE<br>","<strong>Store:<\/strong> ANOTHER ROUND / DEWITT<br><strong>Address:<\/strong> 622 S 6TH AVE<br>","<strong>Store:<\/strong> UPTOWN LIQUOR, LLC<br><strong>Address:<\/strong> 306 HWY 69 SOUTH<br>","<strong>Store:<\/strong> CORK IT!<br><strong>Address:<\/strong> 769 PROSPECT ST SW<br>","<strong>Store:<\/strong> WALGREENS #03875 / CEDAR RAPIDS<br><strong>Address:<\/strong> 2821 1ST AVE SE<br>","<strong>Store:<\/strong> SCHOTTSY'S LIQUOR<br><strong>Address:<\/strong> 109 5TH ST<br>","<strong>Store:<\/strong> LAKE LIQUORS WINE AND SPIRITS<br><strong>Address:<\/strong> 910 N 8TH ST W<br>","<strong>Store:<\/strong> BEST TRIP<br><strong>Address:<\/strong> 1516, SE  1ST ST<br>","<strong>Store:<\/strong> HY-VEE #2 / DUBUQUE<br><strong>Address:<\/strong> 2395 NW ARTERIAL RD<br>","<strong>Store:<\/strong> HY-VEE FAST & FRESH/ALTOONA<br><strong>Address:<\/strong> 3950 PRARIE FIRE NW<br>","<strong>Store:<\/strong> OKOBOJI AVENUE LIQUOR<br><strong>Address:<\/strong> 1610 OKOBOJI AVENUE<br>","<strong>Store:<\/strong> BIG G FOOD STORE<br><strong>Address:<\/strong> PO BOX 261  310 W DILLON<br>","<strong>Store:<\/strong> BIG DISCOUNT LIQUOR / CEDAR RAPIDS<br><strong>Address:<\/strong> 5427  CENTER POINT RD<br>","<strong>Store:<\/strong> CASEY'S GENERAL STORE #3932 / URBANDALE<br><strong>Address:<\/strong> 4580 114TH STREET<br>","<strong>Store:<\/strong> I TOWNER STOP / INDIANOLA<br><strong>Address:<\/strong> 403 W 2ND AVE<br>","<strong>Store:<\/strong> BOOTLEGGING BARZINIS<br><strong>Address:<\/strong> 412 FIRST AVE<br>","<strong>Store:<\/strong> HELLO MART LLC / SIOUX CITY<br><strong>Address:<\/strong> 4218 MORNINGSIDE AVENUE<br>","<strong>Store:<\/strong> FAREWAY STORES #912 / SIOUX CENTER<br><strong>Address:<\/strong> 115  1ST AVE NW<br>","<strong>Store:<\/strong> OASIS<br><strong>Address:<\/strong> 1401, BUCHANAN ST<br>","<strong>Store:<\/strong> WHOLE FOODS MARKET<br><strong>Address:<\/strong> 4100 UNIVERSITY AVE<br>","<strong>Store:<\/strong> LIQUOR TOBACCO & GROCERY - MASON CITY<br><strong>Address:<\/strong> 18 NORTH MONROE AVENUE<br>","<strong>Store:<\/strong> DUBUQUE WINE & SPIRITS<br><strong>Address:<\/strong> 3305 ASBURY RD<br>","<strong>Store:<\/strong> HOMETOWN WINE & SPIRITS / OSKALOOSA<br><strong>Address:<\/strong> 1202 A AVE E<br>","<strong>Store:<\/strong> DT LIQUOR LLC / DEWITT<br><strong>Address:<\/strong> 301 11TH STREET<br>","<strong>Store:<\/strong> WALL TO WALL WINE AND SPIRITS / WEST DES MOINES<br><strong>Address:<\/strong> 375 SOUTH JORDAN CREEK PARKWAY<br>","<strong>Store:<\/strong> EASTSIDE LIQUOR AND GROCERY / MARSHALLTOWN<br><strong>Address:<\/strong> 1116 EAST NEVADA STREET<br>","<strong>Store:<\/strong> OASIS WINE AND SPIRITS - WINTERSET<br><strong>Address:<\/strong> 53 EAST GREEN STREET<br>","<strong>Store:<\/strong> SUNSHINE FOODS / MILFORD<br><strong>Address:<\/strong> 1704 OKOBOJI AVE.<br>","<strong>Store:<\/strong> BANI'S / CEDAR FALLS<br><strong>Address:<\/strong> 2128 COLLEGE STREET<br>","<strong>Store:<\/strong> ONE STOP / HAMPTON<br><strong>Address:<\/strong> 1208 4TH ST. NE<br>","<strong>Store:<\/strong> DISCOUNT LIQUOR TOBACCO & VAPE / CRESTON<br><strong>Address:<\/strong> 509 WEST TAYLOR STREET SUITE B<br>","<strong>Store:<\/strong> OSCEOLA LIQUOR LLC / OSCEOLA<br><strong>Address:<\/strong> 715 W MCLANE ST<br>","<strong>Store:<\/strong> CENTRAL CITY LIQUOR, INC.<br><strong>Address:<\/strong> 1460 2ND AVE<br>","<strong>Store:<\/strong> HY-VEE #2 (1044) / BURLINGTON<br><strong>Address:<\/strong> 3140 AGENCY<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE (1473) / OSCEOLA<br><strong>Address:<\/strong> 510 WEST MCLANE<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #3 (1056) / CEDAR RAPIDS<br><strong>Address:<\/strong> 20 WILSON AVENUE WEST<br>","<strong>Store:<\/strong> HY-VEE WINE AND SPIRITS (1010) / ALGONA<br><strong>Address:<\/strong> 1502 HIGHWAY 169 N SUITE 1<br>","<strong>Store:<\/strong> HY-VEE WINE AND SPIRITS / BETTENDORF<br><strong>Address:<\/strong> 2890 DEVILS GLEN ROAD<br>","<strong>Store:<\/strong> WAUKEE LIQUOR & FOOD MART / WAUKEE<br><strong>Address:<\/strong> 763 SE ALICE'S ROAD<br>","<strong>Store:<\/strong> LOCAL LIQUOR / PANORA<br><strong>Address:<\/strong> 603 EAST MAIN STREET<br>","<strong>Store:<\/strong> BIG 10 MART #19 / HIAWATHA<br><strong>Address:<\/strong> 1225 BOYSON ROAD<br>","<strong>Store:<\/strong> LE CLAIRE GROCERY STORE / LE CLAIRE<br><strong>Address:<\/strong> 536 NORTH CODY ROAD<br>","<strong>Store:<\/strong> STAR LIQUOR TOBACCO AND VAPE / WAUKEE<br><strong>Address:<\/strong> 23 NORTHEAST CAREFREE LANE<br>","<strong>Store:<\/strong> HURRIBAK IV DISTRIBUTION / CHARITON<br><strong>Address:<\/strong> 213 NORTH MAIN STREET<br>","<strong>Store:<\/strong> HIWAY 25 LIQUOR / GREENFIELD<br><strong>Address:<\/strong> 108 NORTHEAST 6TH STREET<br>","<strong>Store:<\/strong> SYCAMORE CONVENIENCE<br><strong>Address:<\/strong> 617 SYCAMORE<br>","<strong>Store:<\/strong> HY-VEE WINE AND SPIRITS (1022) / ANKENY<br><strong>Address:<\/strong> 410 NORTH ANKENY BLVD<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #2 (1285) / IOWA CITY<br><strong>Address:<\/strong> 812 S 1ST AVE<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE (1271) / INDIANOLA<br><strong>Address:<\/strong> 910 N JEFFERSON<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE (1396) / MARION<br><strong>Address:<\/strong> 3600 BUSINESS HWY 151 EAST<br>","<strong>Store:<\/strong> HY-VEE #4 / DAVENPORT<br><strong>Address:<\/strong> 4064 E 53RD ST<br>","<strong>Store:<\/strong> HY-VEE #7 / CEDAR RAPIDS<br><strong>Address:<\/strong> 5050 EDGEWOOD RD<br>","<strong>Store:<\/strong> HY-VEE / WAUKEE<br><strong>Address:<\/strong> 1005 E HICKMAN RD<br>","<strong>Store:<\/strong> ROCK C LIQUOR & WINE & TOBACCO / IOWA FALLS<br><strong>Address:<\/strong> 418 ROCKSYLVANIA AVENUE<br>","<strong>Store:<\/strong> EL VALLE TIENDA Y CARNICERIA / EAGLE GROVE<br><strong>Address:<\/strong> 101 W BROADWAY ST.<br>","<strong>Store:<\/strong> DING'S HONK'N HOLLER<br><strong>Address:<\/strong> 900, E  WASHINGTON  ST<br>","<strong>Store:<\/strong> TOBACCO HUT & LIQUOR<br><strong>Address:<\/strong> 3134 MANAWA CENTER DR. # 9<br>","<strong>Store:<\/strong> MEPO FOODS / MEDIAPOLIS<br><strong>Address:<\/strong> 111 WAPELLO ST N<br>","<strong>Store:<\/strong> ELDRIDGE MART<br><strong>Address:<\/strong> 209 E. LE CLAIRE RD<br>","<strong>Store:<\/strong> BLIND PIG COCKTAIL BODEGA WEST DES MOINES<br><strong>Address:<\/strong> 222 1 HALF 5TH STREET VALLEY JUNCTION<br>","<strong>Store:<\/strong> THE PUMPER / FAYETTE<br><strong>Address:<\/strong> 515 W. WATER STREET<br>","<strong>Store:<\/strong> FORBES MEAT / SPIRIT LAKE<br><strong>Address:<\/strong> 2508 ENTERPRISE AVENUE<br>","<strong>Store:<\/strong> LIQUOR LOVERS  / ANKENY<br><strong>Address:<\/strong> 1510 SOUTH ANKENY BOULEVARD PRAIRIE TRAIL SUITE 107-108<br>","<strong>Store:<\/strong> SPIRIT LIQUOR - 1 / GRIMES<br><strong>Address:<\/strong> 109 1ST STREET<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #1 (1449) / NEWTON<br><strong>Address:<\/strong> 1501 FIRST AVENUE EAST<br>","<strong>Store:<\/strong> HY-VEE (1530) / PLEASANT HILL<br><strong>Address:<\/strong> 4815 MAPLE DRIVE<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE / SHELDON<br><strong>Address:<\/strong> 1989 PARK ST<br>","<strong>Store:<\/strong> CVS PHARMACY #10114 / ANKENY<br><strong>Address:<\/strong> 104 E FIRST ST<br>","<strong>Store:<\/strong> KARAM KAUR KHASRIYA LLC<br><strong>Address:<\/strong> 702 13TH ST<br>","<strong>Store:<\/strong> GRIEDER BEVERAGE DEPOT<br><strong>Address:<\/strong> 708  13TH ST<br>","<strong>Store:<\/strong> WORLD LIQUOR & TOBACCO<br><strong>Address:<\/strong> 1775 NW 86TH ST<br>","<strong>Store:<\/strong> GIGGLE JUICE LIQUOR STATION, LLC<br><strong>Address:<\/strong> 600 W. MAIN ST.<br>","<strong>Store:<\/strong> EXPO LIQUOR<br><strong>Address:<\/strong> 1810 STATE STREET<br>","<strong>Store:<\/strong> URBANDALE LIQUOR<br><strong>Address:<\/strong> 6401 DOUGLAS AVE. STE 1<br>","<strong>Store:<\/strong> EAST END LIQUOR / DES MOINES<br><strong>Address:<\/strong> 3804 HUBBELL AVE<br>","<strong>Store:<\/strong> BREW OIL #32 / SPENCER<br><strong>Address:<\/strong> 15 GRAND AVE<br>","<strong>Store:<\/strong> QUICK STOP / CEDAR RAPIDS<br><strong>Address:<\/strong> 380 BLAIRS FERRY ROAD NORTHEAST<br>","<strong>Store:<\/strong> 821 SQ LIQUOR / DES MOINES<br><strong>Address:<\/strong> 821 EAST EUCLID AVENUE<br>","<strong>Store:<\/strong> KC STORE / STRATFORD<br><strong>Address:<\/strong> 810 IA-175<br>","<strong>Store:<\/strong> BEER THIRTY CARROLL / CARROLL<br><strong>Address:<\/strong> 430 EAST 6TH STREET<br>","<strong>Store:<\/strong> GARY'S FOODS / MT VERNON<br><strong>Address:<\/strong> 715  1ST AVE S<br>","<strong>Store:<\/strong> WAL-MART 3630 / MARION<br><strong>Address:<\/strong> 5491 BUSINESS HWY 151<br>","<strong>Store:<\/strong> TEQUILA'S LIQUOR STORE<br><strong>Address:<\/strong> 1434 DES MOINES ST STE 5<br>","<strong>Store:<\/strong> THE OX & WREN SPIRITS AND GIFTS<br><strong>Address:<\/strong> 708 2ND  AVE  SE<br>","<strong>Store:<\/strong> KWIK STOP 4<br><strong>Address:<\/strong> 515 BROADWAY ST<br>","<strong>Store:<\/strong> HOMETOWN FAMILY MARKET<br><strong>Address:<\/strong> 310 2ND ST<br>","<strong>Store:<\/strong> HY-VEE / GRIMES<br><strong>Address:<\/strong> 351 NORTHEAST GATEWAY DRIVE<br>","<strong>Store:<\/strong> RAYMOND'S STATION / GARWIN<br><strong>Address:<\/strong> 501 FRONT STREET<br>","<strong>Store:<\/strong> RIVERSIDE #4 / BETTENDORF<br><strong>Address:<\/strong> 2320 SPRUCE HILLS DRIVE<br>","<strong>Store:<\/strong> THE CROWN LIQUOR / IOWA CITY<br><strong>Address:<\/strong> 324 EAST WASHINGTON STREET<br>","<strong>Store:<\/strong> DUAL STOP CARTER LAKE / CARTER LAKE<br><strong>Address:<\/strong> 109 EAST LOCUST STREET<br>","<strong>Store:<\/strong> BREW OIL #80 / WEST DES MOINES<br><strong>Address:<\/strong> 136 1ST STREET<br>","<strong>Store:<\/strong> MALIK'S #3 / MASON CITY<br><strong>Address:<\/strong> 1303 4TH ST SW<br>","<strong>Store:<\/strong> ABC SMOKE / URBANDALE<br><strong>Address:<\/strong> 4635 86TH STREET<br>","<strong>Store:<\/strong> LIQUOR GARDEN / URBANDALE<br><strong>Address:<\/strong> 3838 100TH STREET<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #3 (1142) / DES MOINES<br><strong>Address:<\/strong> 3221 SE 14TH ST<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE (1353) / KNOXVILLE<br><strong>Address:<\/strong> 813 N LINCOLN STE 1<br>","<strong>Store:<\/strong> HY-VEE WINE AND SPIRITS / ATLANTIC<br><strong>Address:<\/strong> 1602 E 7TH ST<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE / WEBSTER CITY<br><strong>Address:<\/strong> 823  2ND ST<br>","<strong>Store:<\/strong> HY-VEE WINE AND SPIRITS / WDM<br><strong>Address:<\/strong> 1725  74TH ST<br>","<strong>Store:<\/strong> HY-VEE #5 / DAVENPORT<br><strong>Address:<\/strong> 2351 W LOCUST<br>","<strong>Store:<\/strong> HY-VEE / WAVERLY<br><strong>Address:<\/strong> 1311 4 STREET SW<br>","<strong>Store:<\/strong> HY-VEE / DECORAH<br><strong>Address:<\/strong> 915 SHORT ST #107<br>","<strong>Store:<\/strong> CVS PHARMACY #8544 / WATERLOO<br><strong>Address:<\/strong> 1825 E. SAN MARNAN DRIVE<br>","<strong>Store:<\/strong> SAM'S CLUB 6344 / WINDSOR HEIGHTS<br><strong>Address:<\/strong> 1101  73RD ST<br>","<strong>Store:<\/strong> SMOKIN' JOE'S #2 TOBACCO AND LIQUOR OUTLET<br><strong>Address:<\/strong> 1606 W LOCUST ST<br>","<strong>Store:<\/strong> FOODLAND SUPER MARKETS / WOODBINE<br><strong>Address:<\/strong> 62 5TH ST<br>","<strong>Store:<\/strong> SUPER QUICK 2 / HUBBELL<br><strong>Address:<\/strong> 1824 HUBBELL AVE<br>","<strong>Store:<\/strong> LIQUOR AND TOBACCO OUTLET /<br><strong>Address:<\/strong> 620 W BREMER AVE<br>","<strong>Store:<\/strong> SELECT MART / SIOUX CITY<br><strong>Address:<\/strong> 4103 FLOYD BLVD<br>","<strong>Store:<\/strong> PIT STOP LIQUORS / NEWTON<br><strong>Address:<\/strong> 1324, 1ST AVE E<br>","<strong>Store:<\/strong> QUALITY QUICK STOP / FAIRFIELD<br><strong>Address:<\/strong> 201 WEST BURLINGTIN AVE.<br>","<strong>Store:<\/strong> LANSING IGA<br><strong>Address:<\/strong> 417 MAIN ST<br>","<strong>Store:<\/strong> THE BOONEDOCKS<br><strong>Address:<\/strong> 228, N HWY 71<br>","<strong>Store:<\/strong> CROSSROADS WINE & SPIRITS LLC<br><strong>Address:<\/strong> 117 IOWA AVE<br>","<strong>Store:<\/strong> STAMMER LIQUOR CORP<br><strong>Address:<\/strong> 615 2ND AVE<br>","<strong>Store:<\/strong> WORLD LIQUOR & TOBACCO + VAPORS<br><strong>Address:<\/strong> 1030 8TH ST<br>","<strong>Store:<\/strong> GRANDVIEW MART<br><strong>Address:<\/strong> 714 GRANDVIEW AVE<br>","<strong>Store:<\/strong> EASYGO<br><strong>Address:<\/strong> 2723 GRAND AVE<br>","<strong>Store:<\/strong> AMBYSURE INC / CLINTON<br><strong>Address:<\/strong> 1641 S BLUFF BLVD<br>","<strong>Store:<\/strong> BEER THIRTY DENISON<br><strong>Address:<\/strong> 923 4TH AVENUE SOUTH<br>","<strong>Store:<\/strong> BIG 10 MART #12 / DUBUQUE<br><strong>Address:<\/strong> 405 RHOMBERG<br>","<strong>Store:<\/strong> NORTHSIDE LIQUOR AND GROCERY / MASON CITY<br><strong>Address:<\/strong> 1303 N FEDERAL<br>","<strong>Store:<\/strong> WORLD CLASS LIQUOR AND TOBACCO / BONDURANT<br><strong>Address:<\/strong> 96 PAINE CIRCLE SE 1 & 2<br>","<strong>Store:<\/strong> EVANSDALE MARKET PLACE / EVANSDALE<br><strong>Address:<\/strong> 3601 LAFAYETTE RD<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #1 (1504) / OTTUMWA<br><strong>Address:<\/strong> 1025 NORTH QUINCY AVE<br>","<strong>Store:<\/strong> HY-VEE DRUGSTORE (7042) / IOWA CITY<br><strong>Address:<\/strong> 310 N 1ST ST<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE (1636) / SPENCER<br><strong>Address:<\/strong> 819 N GRAND AVE<br>","<strong>Store:<\/strong> HY-VEE DRUGSTORE / UNIVERSITY / DSM<br><strong>Address:<\/strong> 4100 UNIVERSITY AVE<br>","<strong>Store:<\/strong> HY-VEE #3 / BDI / DES MOINES<br><strong>Address:<\/strong> 3221 SE 14TH ST<br>","<strong>Store:<\/strong> QUICK SHOP LIQUOR AND VAPE / CLEAR LAKE<br><strong>Address:<\/strong> 904 NORTH 8TH STREET<br>","<strong>Store:<\/strong> LIQUOR LAND / DES MOINES<br><strong>Address:<\/strong> 4995 MERLE HAY ROAD<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #1 (1013) / AMES<br><strong>Address:<\/strong> 3800 W LINCOLN WAY<br>","<strong>Store:<\/strong> HY-VEE WINE AND SPIRITS (1170) / ESTHERVILLE<br><strong>Address:<\/strong> 1221 E CENTRAL AVENUE<br>","<strong>Store:<\/strong> HY-VEE DRUGSTORE #5 / CEDAR RAPIDS<br><strong>Address:<\/strong> 2001 BLAIRS FERRY RD NE<br>","<strong>Store:<\/strong> TWIN TOWN LIQUOR<br><strong>Address:<\/strong> 104 HIGHWAY 30 WEST<br>","<strong>Store:<\/strong> JIM AND CHARLIES AFFILIATED<br><strong>Address:<\/strong> 121 NORTH CLINTON<br>","<strong>Store:<\/strong> CYCLONE LIQUORS<br><strong>Address:<\/strong> 626 LINCOLN WAY<br>","<strong>Store:<\/strong> QUILLINS QUALITY FOODS MONONA<br><strong>Address:<\/strong> 808 S MAIN ST<br>","<strong>Store:<\/strong> UMIYA FOODMART INC<br><strong>Address:<\/strong> 318 E NORTH ST.<br>","<strong>Store:<\/strong> MARSHALL BEER WINE SPIRITS<br><strong>Address:<\/strong> 11 N 3RD AVE<br>","<strong>Store:<\/strong> RIVERSIDE LIQUOR 2 / DAVENPORT<br><strong>Address:<\/strong> 1528 W LOCUST<br>","<strong>Store:<\/strong> THE HUT 23<br><strong>Address:<\/strong> 603 10TH STREET<br>","<strong>Store:<\/strong> BEER THIRTY STORM LAKE / STORM LAKE<br><strong>Address:<\/strong> 208 E MILWAUKEE<br>","<strong>Store:<\/strong> BEER ON FLOYD / SIOUX CITY<br><strong>Address:<\/strong> 3132 FLOYD BLVD<br>","<strong>Store:<\/strong> MAPLETON FOOD LAND / MAPLETON<br><strong>Address:<\/strong> 405 HEISLER STREET<br>","<strong>Store:<\/strong> SIP & BURN / ANKENY<br><strong>Address:<\/strong> 1200 NW 36TH ST STE 101<br>","<strong>Store:<\/strong> ALTOONA LIQUOR AND TOBACCO / ALTOONA<br><strong>Address:<\/strong> 1005 8TH STREET SOUTHWEST STE D<br>","<strong>Store:<\/strong> HY-VEE WINE AND SPIRITS (1544) / RED OAK<br><strong>Address:<\/strong> 1607 NORTH BROADWAY<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #4 / SIOUX CITY<br><strong>Address:<\/strong> 2827 HAMILTON BLVD<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE / CORNING<br><strong>Address:<\/strong> 300  10TH ST<br>","<strong>Store:<\/strong> MONTEZUMA SUPER VALU<br><strong>Address:<\/strong> 201 S FRONT ST<br>","<strong>Store:<\/strong> SAM'S CLUB 8162 / CEDAR RAPIDS<br><strong>Address:<\/strong> 2605 BLAIRS FERRY RD NE<br>","<strong>Store:<\/strong> BANCROFT LIQUOR STORE<br><strong>Address:<\/strong> 107 NORTH PORTLAND STREET<br>","<strong>Store:<\/strong> FAREWAY STORES #639 / MAQUOKETA<br><strong>Address:<\/strong> 110 WESTGATE DR<br>","<strong>Store:<\/strong> FAREWAY STORES #589 / DECORAH<br><strong>Address:<\/strong> 103 E MAIN<br>","<strong>Store:<\/strong> BRAVIM MART INCORPORATED / ANKENY<br><strong>Address:<\/strong> 121 N. ANKENY BLVD.<br>","<strong>Store:<\/strong> THE SPOT SMOKE SHOP / INDEPENDENCE<br><strong>Address:<\/strong> 112 2ND AVE SW BLDG 01<br>","<strong>Store:<\/strong> THE SPOT #3 / WATERLOO<br><strong>Address:<\/strong> 117 E SAN MARNAN DR<br>","<strong>Store:<\/strong> THE SPOT TRUCK STOP / GRIMES<br><strong>Address:<\/strong> 1905 SE 37TH ST<br>","<strong>Store:<\/strong> SID'S BEVERAGE SHOP<br><strong>Address:<\/strong> 2727 DODGE ST<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #1 (1159) / DUBUQUE<br><strong>Address:<\/strong> 3500 DODGE ST<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #5 (1151) / DES MOINES<br><strong>Address:<\/strong> 1107 SE ARMY POST RD<br>","<strong>Store:<\/strong> HY-VEE # 6/ DES MOINES<br><strong>Address:<\/strong> 420 COURT AVE<br>","<strong>Store:<\/strong> ECON-O-MART / COLUMBUS JUNCTION<br><strong>Address:<\/strong> 103 WALNUT ST. E<br>","<strong>Store:<\/strong> SAM'S CLUB 6432 / SIOUX CITY<br><strong>Address:<\/strong> 4201 S. YORK ST.<br>","<strong>Store:<\/strong> TARGET STORE T-1939 / ALTOONA<br><strong>Address:<\/strong> 3414 8TH ST SW<br>","<strong>Store:<\/strong> CORK AND BOTTLE / OSKALOOSA<br><strong>Address:<\/strong> 309 A AVE WEST<br>","<strong>Store:<\/strong> FAREWAY STORES #850 / SPIRIT LAKE<br><strong>Address:<\/strong> 1906 KEOKUK<br>","<strong>Store:<\/strong> GIRI'S LIQUOR STORE / WEST LIBERTY<br><strong>Address:<\/strong> 1006 N. COLUMBUS STREET SUITE A<br>","<strong>Store:<\/strong> CENTRAL CITY 2<br><strong>Address:<\/strong> 1501 MICHIGAN AVE<br>","<strong>Store:<\/strong> MILL STREET WINE AND SPIRITS / LAKE MILLS<br><strong>Address:<\/strong> 107 NORTH MILL STREET<br>","<strong>Store:<\/strong> BLUE LIQUOR AND TOBACCO STORE / STATE CENTER<br><strong>Address:<\/strong> 101 WEST MAIN STREET<br>","<strong>Store:<\/strong> ATLANTIC LIQUOR / ATLANTIC<br><strong>Address:<\/strong> 411 CHESTNUT STREET<br>","<strong>Store:<\/strong> KEOKUK SPIRITS<br><strong>Address:<\/strong> 1013 MAIN<br>","<strong>Store:<\/strong> INGERSOLL LIQUOR AND BEVERAGE<br><strong>Address:<\/strong> 3500 INGERSOLL AVE<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE (1433) / MOUNT PLEASANT<br><strong>Address:<\/strong> 1700 E WASHINGTON<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #5 / CEDAR RAPIDS<br><strong>Address:<\/strong> 3235 OAKLAND ROAD NE<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE / IOWA CITY<br><strong>Address:<\/strong> 1125 N DODGE ST<br>","<strong>Store:<\/strong> HY-VEE #4 / WDM<br><strong>Address:<\/strong> 555 S 51ST ST<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #2 / STATE ANKENY<br><strong>Address:<\/strong> 2510 SW STATE ST<br>","<strong>Store:<\/strong> BENZ DISTRIBUTING<br><strong>Address:<\/strong> 501 7TH AVE SE<br>","<strong>Store:<\/strong> FAREWAY STORES #974 / CEDAR FALLS<br><strong>Address:<\/strong> 214 N MAGNOLIA DR<br>","<strong>Store:<\/strong> TIPTON FAMILY FOODS<br><strong>Address:<\/strong> 610 CEDAR ST<br>","<strong>Store:<\/strong> WALGREENS #03773 / URBANDALE<br><strong>Address:<\/strong> 4600 86TH ST<br>","<strong>Store:<\/strong> WALGREENS #11710 / NORTH LIBERTY<br><strong>Address:<\/strong> 625 PACHA PARKWAY<br>","<strong>Store:<\/strong> SMOKIN' JOE'S #15 TOBACCO AND LIQUOR OUTLET<br><strong>Address:<\/strong> 455 EDGEWOOD RD NW<br>","<strong>Store:<\/strong> STATE FOOD MART<br><strong>Address:<\/strong> 3715 STATE ST.<br>","<strong>Store:<\/strong> DHAKALS LLC<br><strong>Address:<\/strong> 3108 W CENTRAL PARK AVE<br>","<strong>Store:<\/strong> WORLD LIQUOR & TOBACCO + VAPORS / DES MOINES<br><strong>Address:<\/strong> 3200 SOUTHEAST 14TH STREET<br>","<strong>Store:<\/strong> WINE & SPIRITS SHOPPE OF ALGONA / ALGONA<br><strong>Address:<\/strong> 111 SOUTH PHILLIPS STREET<br>","<strong>Store:<\/strong> TOBACCO MART / URBANDALE<br><strong>Address:<\/strong> 6535 DOUGLAS AVE<br>","<strong>Store:<\/strong> HY-VEE WINE & SPIRITS #2 / DAVENPORT<br><strong>Address:<\/strong> 3301 W KIMBERLY RD<br>","<strong>Store:<\/strong> FAREWAY STORES #058 / ORANGE CITY<br><strong>Address:<\/strong> 512  8TH SE<br>","<strong>Store:<\/strong> SMOKIN' JOE'S #17 TOBACCO AND LIQUOR OUTLET<br><strong>Address:<\/strong> 110 S ROOSEVELT HWY 61<br>","<strong>Store:<\/strong> SUPER QUICK LIQUOR / WDM<br><strong>Address:<\/strong> 1800 22ND ST<br>","<strong>Store:<\/strong> LIQUOR DOWNTOWN / IOWA CITY<br><strong>Address:<\/strong> 315 S GILBERT ST<br>","<strong>Store:<\/strong> ALLCOOL LIQUORS / WDM<br><strong>Address:<\/strong> 5904 ASHWORTH RD<br>","<strong>Store:<\/strong> WESTSIDE SPIRITS / CEDAR RAPIDS<br><strong>Address:<\/strong> 3330 16TH AVE. SW<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE (1403) / MARSHALLTOWN<br><strong>Address:<\/strong> 802 SOUTH CENTER<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE / MUSCATINE<br><strong>Address:<\/strong> 2400 2ND AVE<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE / JOHNSTON<br><strong>Address:<\/strong> 5750 MERLE HAY ROAD<br>","<strong>Store:<\/strong> HY-VEE DRUGSTORE / OTTUMWA<br><strong>Address:<\/strong> 1140 NORTH JEFFERSON ST<br>","<strong>Store:<\/strong> HY-VEE FORT DODGE WINE AND SPIRITS<br><strong>Address:<\/strong> 1511 2ND AVE NORTH<br>","<strong>Store:<\/strong> SMOKE SHOP, THE<br><strong>Address:<\/strong> 1918 SE 14TH ST<br>","<strong>Store:<\/strong> INGERSOLL WINE MERCHANTS<br><strong>Address:<\/strong> 1300  50TH ST<br>","<strong>Store:<\/strong> HARTIG DRUG CO #6 / DYERSVILLE<br><strong>Address:<\/strong> 711  16TH AVE SE<br>","<strong>Store:<\/strong> WAL-MART 1005 / WAVERLY<br><strong>Address:<\/strong> 700  29 ST SW<br>","<strong>Store:<\/strong> FAREWAY STORES #983 / GRIMES<br><strong>Address:<\/strong> 351 GATEWAY DR<br>","<strong>Store:<\/strong> FAREWAY STORES #737 / GRINNELL<br><strong>Address:<\/strong> 727 WEST STREET<br>","<strong>Store:<\/strong> FAREWAY STORES #395 / WEBSTER CITY<br><strong>Address:<\/strong> 942  2ND ST<br>","<strong>Store:<\/strong> OAK STREET STATION LLC<br><strong>Address:<\/strong> 2403 US HWY 18<br>","<strong>Store:<\/strong> BACKWATER SPIRITS AND MORE<br><strong>Address:<\/strong> 116 W WATER ST STE D<br>","<strong>Store:<\/strong> FIVE CORNERS LIQUOR & WINE<br><strong>Address:<\/strong> 809 E 18TH ST<br>","<strong>Store:<\/strong> WEST D LIQUORS<br><strong>Address:<\/strong> 5014 EP TRUE PKWY<br>","<strong>Store:<\/strong> TARGET STORE T-3374 / IOWA CITY<br><strong>Address:<\/strong> 113 E WASHINGTON ST<br>","<strong>Store:<\/strong> ROYAL MART / DES MOINES<br><strong>Address:<\/strong> 111 SOUTHWEST 63RD STREET<br>","<strong>Store:<\/strong> WORLD LIQUOR & TOBACCO PLUS VAPORS / ADEL<br><strong>Address:<\/strong> 918 COURT STREET<br>","<strong>Store:<\/strong> GRIMES LIQUOR SHOP / GRIMES<br><strong>Address:<\/strong> 3600 SOUTHEAST CROSSROADS DRIVE<br>","<strong>Store:<\/strong> PRIME MART / CEDAR FALLS<br><strong>Address:<\/strong> 2728 CENTER STREET<br>","<strong>Store:<\/strong> HOME TOWN WINE AND SPIRIT / KEOKUK<br><strong>Address:<\/strong> 1501 MAIN STREET<br>","<strong>Store:<\/strong> HAPPY'S WINE & SPIRITS WHOLESALE<br><strong>Address:<\/strong> 5925 UNIVERSITY AVE<br>","<strong>Store:<\/strong> JOHN'S GROCERY<br><strong>Address:<\/strong> 401 EAST MARKET ST<br>","<strong>Store:<\/strong> HY-VEE WINE AND SPIRITS #1 (1281) / IOWA CITY<br><strong>Address:<\/strong> 1720 WATERFRONT DR<br>","<strong>Store:<\/strong> SAM'S CLUB 4973 / DUBUQUE<br><strong>Address:<\/strong> 4400 ASBURY RD<br>","<strong>Store:<\/strong> FAREWAY STORES #980 / KNOXVILLE<br><strong>Address:<\/strong> 1308 S LINCOLN ST<br>","<strong>Store:<\/strong> JIFFY #926 / SPIRIT LAKE<br><strong>Address:<\/strong> 2402, 17TH ST<br>","<strong>Store:<\/strong> SOUTHSIDE LIQUOR & TOBACCO / IOWA CITY<br><strong>Address:<\/strong> 1921 KEOKUK ST<br>","<strong>Store:<\/strong> CORK 'N BOTTLE / MANCHESTER<br><strong>Address:<\/strong> 900 E MAIN ST<br>","<strong>Store:<\/strong> BREW IDA GROVE<br><strong>Address:<\/strong> 500, HWY 175<br>","<strong>Store:<\/strong> JUNCTION LIQUOR<br><strong>Address:<\/strong> 10 3RD ST. NW, STE B<br>","<strong>Store:<\/strong> HY-VEE DOLLAR FRESH / INDEPENDENCE<br><strong>Address:<\/strong> 1975 3 ELMS ROAD<br>","<strong>Store:<\/strong> WORLD LIQUOR & TOBACCO + VAPORS / AMES<br><strong>Address:<\/strong> 111 DUFF AVENUE<br>","<strong>Store:<\/strong> WALGREENS #05512 / BETTENDORF<br><strong>Address:<\/strong> 3425 MIDDLE RD<br>","<strong>Store:<\/strong> WALGREENS #07833 / DES MOINES<br><strong>Address:<\/strong> 3501 INGERSOLL AVE<br>","<strong>Store:<\/strong> RIVERSIDE LIQUOR<br><strong>Address:<\/strong> 826 E RIVER DR<br>","<strong>Store:<\/strong> ALS LIQUOR<br><strong>Address:<\/strong> 215 W. MILWAUKEE AVE<br>","<strong>Store:<\/strong> SUPER QUICK MART / WINDSOR HEIGHTS<br><strong>Address:<\/strong> 7690 HICKMAN RD<br>","<strong>Store:<\/strong> KEYSTONE LIQUOR<br><strong>Address:<\/strong> 517 2ND ST<br>","<strong>Store:<\/strong> THRIFTWAY / LA PORTE CITY<br><strong>Address:<\/strong> 304 4TH ST<br>","<strong>Store:<\/strong> NEIGHBORHOOD LIQUOR HOUSE / ANKENY<br><strong>Address:<\/strong> 833 EAST 1ST STREET, SUITE 102<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #1 (1410) / MASON CITY<br><strong>Address:<\/strong> 2400 4TH ST SW<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE (1324) / KEOKUK<br><strong>Address:<\/strong> 3111 MAIN<br>","<strong>Store:<\/strong> HY-VEE / CHARLES CITY<br><strong>Address:<\/strong> 901 KELLY ST<br>","<strong>Store:<\/strong> HY-VEE DRUGSTORE / MASON CITY<br><strong>Address:<\/strong> 875  4TH ST SW<br>","<strong>Store:<\/strong> SAM'S CLUB 6472 / COUNCIL BLUFFS<br><strong>Address:<\/strong> 3221 MANAWA CENTRE DR<br>","<strong>Store:<\/strong> I-80 LIQUOR / COUNCIL BLUFFS<br><strong>Address:<\/strong> 2411 S 24TH ST #1 PO STN RR<br>","<strong>Store:<\/strong> TOBACCO SHOP / ARNOLDS PARK<br><strong>Address:<\/strong> 612 S HIGHWAY 71<br>","<strong>Store:<\/strong> RAY'S SUPERMARKET, INC.<br><strong>Address:<\/strong> 1975 FRANKLIN ST<br>","<strong>Store:<\/strong> MAD AVE QUIK SHOP<br><strong>Address:<\/strong> 405, MADISON AVE<br>","<strong>Store:<\/strong> GM MART / IOWA CITY<br><strong>Address:<\/strong> 2601 HIGHWAY 6 EAST<br>","<strong>Store:<\/strong> LIBERTY VIEW WINE & SPIRITS / NORTH LIBERTY<br><strong>Address:<\/strong> 595 COUNTRY LANE  STE 1<br>","<strong>Store:<\/strong> MARLE HAY LIQUOR & SMOKE / DES MOINES<br><strong>Address:<\/strong> 3408 MERLE HAY ROAD<br>","<strong>Store:<\/strong> POLK CITY LIQUOR / POLK CITY<br><strong>Address:<\/strong> 201 NORTH 3RD STREET<br>","<strong>Store:<\/strong> LOCAL CRAFT CELLAR / CEDAR RAPIDS<br><strong>Address:<\/strong> 7085 C AVENUE NORTHEAST, UNIT A1<br>","<strong>Store:<\/strong> TOP SHELF LIQUOR / IOWA CITY<br><strong>Address:<\/strong> 412 HIGHWAY 1<br>","<strong>Store:<\/strong> EASYGO LIQUOR / WEST DES MOINES<br><strong>Address:<\/strong> 900 GRAND AVENUE<br>","<strong>Store:<\/strong> HILLSTREET NEWS AND TOBACCO<br><strong>Address:<\/strong> 2217 COLLEGE<br>","<strong>Store:<\/strong> HY-VEE  #2 (1018) / AMES<br><strong>Address:<\/strong> 640 LINCOLNWAY<br>","<strong>Store:<\/strong> HY-VEE WINE AND SPIRITS (1628) / SPIRIT LAKE<br><strong>Address:<\/strong> 1902 PEORIA AVENUE<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE (1011) / ALTOONA<br><strong>Address:<\/strong> 100 8TH STREET SW<br>","<strong>Store:<\/strong> HY-VEE DRUGSTORE / DAVENPORT<br><strong>Address:<\/strong> 2200 WEST KIMBERLY<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE / CARROLL<br><strong>Address:<\/strong> 905 US HIGHWAY 30 WEST<br>","<strong>Store:<\/strong> HY-VEE #3 FOOD & DRUGSTORE / DAVENPORT<br><strong>Address:<\/strong> 1823 E KIMBERLY RD<br>","<strong>Store:<\/strong> HY-VEE / WINDSOR HEIGHTS<br><strong>Address:<\/strong> 7101 UNIVERSITY AVE<br>","<strong>Store:<\/strong> MEGA RETAIL / MARION<br><strong>Address:<\/strong> 5680 KACENA AVE.<br>","<strong>Store:<\/strong> FOUR CORNERS MARKET / MASON CITY<br><strong>Address:<\/strong> 1306 4TH STREET SOUTHWEST<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #1 (1054) / CEDAR RAPIDS<br><strong>Address:<\/strong> 1843 JOHNSON AVENUE, N.W.<br>","<strong>Store:<\/strong> HY-VEE FOOD AND DRUG (1888) / GRAND / WDM<br><strong>Address:<\/strong> 1990 GRAND AVENUE<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #2 / WATERLOO<br><strong>Address:<\/strong> 2181 LOGAN AVE<br>","<strong>Store:<\/strong> 7 RAYOS LIQUOR STORE<br><strong>Address:<\/strong> 120 E MAIN ST<br>","<strong>Store:<\/strong> FOOD LAND SUPER MARKETS<br><strong>Address:<\/strong> 407 W HURON<br>","<strong>Store:<\/strong> FAREWAY STORES #987 / DAVENPORT<br><strong>Address:<\/strong> 1635 WEST 53RD ST<br>","<strong>Store:<\/strong> STRATFORD FOOD CENTER<br><strong>Address:<\/strong> 829 SHAKESPEARE AVE<br>","<strong>Store:<\/strong> HILL BROTHERS JIFFY MART / CEDAR RAPIDS<br><strong>Address:<\/strong> 1904 MT VERNON ROAD SE<br>","<strong>Store:<\/strong> SAM'S CLUB 6979 / ANKENY<br><strong>Address:<\/strong> 4625 SE DELAWARE AVE<br>","<strong>Store:<\/strong> DECORAH MART / DECORAH<br><strong>Address:<\/strong> 303 COLLEGE DRIVE<br>","<strong>Store:<\/strong> LIQUOR+ MADISON / WASHINGTON<br><strong>Address:<\/strong> 1004 W MADISON ST<br>","<strong>Store:<\/strong> CHAMLING SMOKE & LIQUOR / ANKENY<br><strong>Address:<\/strong> 322 SOUTHWEST MAPLE STREET<br>","<strong>Store:<\/strong> HY-VEE DRUGSTORE #4 (7025) / CEDAR RAPIDS<br><strong>Address:<\/strong> 4825 JOHNSON AVE NW<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE / CEDAR FALLS<br><strong>Address:<\/strong> 6301 UNIVERSITY<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #1 / COUNCIL BLUFFS<br><strong>Address:<\/strong> 2323 W BROADWAY<br>","<strong>Store:<\/strong> HY-VEE WINE AND SPIRITS / WATERLOO<br><strong>Address:<\/strong> 2126 KIMBALL AVE<br>","<strong>Store:<\/strong> HY-VEE WINE & SPIRITS / MUSCATINE<br><strong>Address:<\/strong> 522 MULBERRY, SUITE A<br>","<strong>Store:<\/strong> SAM'S CLUB 6514 / WATERLOO<br><strong>Address:<\/strong> 210 EAST TOWER PARK DR<br>","<strong>Store:<\/strong> WINES AND SPIRITS / WASHINGTON<br><strong>Address:<\/strong> 106 W 2ND ST<br>","<strong>Store:<\/strong> WHISKEY WOLF LIQUOR / GLENWOOD<br><strong>Address:<\/strong> 411 S LOCUST ST<br>","<strong>Store:<\/strong> SA TOBACCO LIQUOR MART / CLINTON<br><strong>Address:<\/strong> 320 N 4TH ST<br>","<strong>Store:<\/strong> CRESTON LIQUORS / CRESTON<br><strong>Address:<\/strong> 804 LAUREL STREET STE A<br>","<strong>Store:<\/strong> UNIVERSITY LIQUORS / WEST DES MOINES<br><strong>Address:<\/strong> 9250 UNIVERSITY AVE SUITE 114<br>","<strong>Store:<\/strong> ROYAL LIQUOR AND SMOKE / GRINNELL<br><strong>Address:<\/strong> 229 WEST STREET<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #2 (1138) / DES MOINES<br><strong>Address:<\/strong> 2540 E EUCLID<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #3 (1866) / WATERLOO<br><strong>Address:<\/strong> 1422 FLAMMANG DR<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE (1148) / FLEUR / DSM<br><strong>Address:<\/strong> 4605 FLEUR DRIVE<br>","<strong>Store:<\/strong> HY-VEE #2 FOOD STORE / MASON CITY<br><strong>Address:<\/strong> 551 S ILLINOIS AVE<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE / SIOUX CITY<br><strong>Address:<\/strong> 4500 SERGEANT ROAD<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE #3 / SIOUX CITY<br><strong>Address:<\/strong> 3301 GORDON DR<br>","<strong>Store:<\/strong> HY-VEE DOLLAR FRESH / ORANGE CITY<br><strong>Address:<\/strong> 1301 8TH STREET SOUTHEAST<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE / CORALVILLE<br><strong>Address:<\/strong> 2004 8TH  ST<br>","<strong>Store:<\/strong> SAM'S CLUB 8238 / DAVENPORT<br><strong>Address:<\/strong> 3845 ELMORE AVE.<br>","<strong>Store:<\/strong> SAM'S CLUB 6568 / AMES<br><strong>Address:<\/strong> 305 AIRPORT RD<br>","<strong>Store:<\/strong> CHARLIE'S WINE AND SPIRITS,<br><strong>Address:<\/strong> 507 W 19TH ST<br>","<strong>Store:<\/strong> SELECT MART    GORDON DR<br><strong>Address:<\/strong> 2825 GORDON DR<br>","<strong>Store:<\/strong> WILKIE LIQUORS<br><strong>Address:<\/strong> 724 1ST STREET NE<br>","<strong>Store:<\/strong> LIQUOR ON THE CORNER<br><strong>Address:<\/strong> 300 EAST MAIN<br>","<strong>Store:<\/strong> OASIS / DES MOINES<br><strong>Address:<\/strong> 5120 NE 14TH ST<br>","<strong>Store:<\/strong> RUSH STOP / CHARLES CITY<br><strong>Address:<\/strong> 609 S MAIN ST<br>","<strong>Store:<\/strong> HY-VEE DOLLAR FRESH / MAQUOKETA<br><strong>Address:<\/strong> 102 W. CARLISLE<br>","<strong>Store:<\/strong> HY-VEE #3 / DUBUQUE<br><strong>Address:<\/strong> 400 LOCUST ST<br>","<strong>Store:<\/strong> HY-VEE FOOD STORE / URBANDALE<br><strong>Address:<\/strong> 8701 DOUGLAS<br>","<strong>Store:<\/strong> HY-VEE #2 / CORALVILLE<br><strong>Address:<\/strong> 3285 CROSSPARK RD<br>","<strong>Store:<\/strong> MCNALLY'S SUPER VALU<br><strong>Address:<\/strong> 1026 MAIN<br>","<strong>Store:<\/strong> KAREN'S SPIRITS AND WINE<br><strong>Address:<\/strong> 328  2ND AVE S<br>","<strong>Store:<\/strong> WAL-MART 0886 / FORT DODGE<br><strong>Address:<\/strong> 3036 1ST AVE SOUTH<br>","<strong>Store:<\/strong> SHADE TREE LIQUORS<br><strong>Address:<\/strong> 90 10TH ST S<br>","<strong>Store:<\/strong> D AND S GROCERY<br><strong>Address:<\/strong> 104 SE  A ST<br>","<strong>Store:<\/strong> FAREWAY STORES #951 / WATERLOO<br><strong>Address:<\/strong> 40  W SAN MARNAN<br>","<strong>Store:<\/strong> AJ'S LIQUOR II<br><strong>Address:<\/strong> 2515 CHAMBERLAIN<br>","<strong>Store:<\/strong> HAPPY'S WINE & SPIRITS<br><strong>Address:<\/strong> 5925 UNIVERSITY AVE<br>"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLegend","args":[{"colors":["#ed7c65"],"labels":["Store locations"],"na_color":null,"na_label":"NA","opacity":0.7,"position":"bottomright","type":"unknown","title":"Liquor stores that sell mezcal in Iowa","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[40.40001,43.443689017],"lng":[-96.43086,-90.191495014]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Great! Now, we have an interactive map of the stores that recently ordered mezcal. We can look for the closest one and go there for our treat. You can also click the dot of your store of interest to get its name and address.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/analytics_done_data_lifecycle_logos.png" class="img-fluid figure-img"></p>
<figcaption>Progress we’ve made so far.</figcaption>
</figure>
</div>
<p>Now that we better understand our data, we can use our DuckDB to feed some algorithms and get predictive (machine learning) models.</p>
</section>
<section id="predictive-modeling-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="predictive-modeling-machine-learning">Predictive modeling (machine learning)</h2>
<p>We have a lightning-fast local database for advanced analytics, and we can use the same resource for statistical and predictive modeling. Let’s say <span style="text-decoration: line-through;">some gangster is dissin ya’ fly girl</span> we’re in the middle of 2019, and the supply chain team is interested in rum supply for the end of the year due to the upcoming holidays.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/411_simpsons.gif" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>You don’t know the details well, but you suspect it has something to do with a conversation you overheard about Martha Stewart’s <a href="https://www.youtube.com/watch?v=IPrnBb1BEHw">jet fuel recipe</a> getting too popular. Anyways, you’re excited since you were looking forward to doing some forecasting work by now.</p>
<p>You start by setting up your Python environment for this job. R is undoubtedly nice for advanced analytics, but you do your machine learning with Python<a href="#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.forecasting.compose <span class="im">import</span> make_reduction</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.forecasting.conformal <span class="im">import</span> ConformalIntervals  </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error, mean_squared_error</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With your prelude ready, we continue by establishing a connection with our local database:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>conn_py <span class="op">=</span> duckdb.<span class="ex">connect</span>(<span class="st">"../data/iowa_liquor.duckdb"</span>, read_only<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After we have created a connection in Python, we can query the data we need for the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>query_liquors_sales <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT </span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="st">      DATE_TRUNC('month', date) AS year_month,</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="st">      MONTHNAME(year_month) AS month,</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="st">      liquor_type,</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="st">      SUM(sale_bottles) AS bottles_sold</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM iowa_liquor_sales</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE YEAR(date) &lt; 2020</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY year_month, liquor_type</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="st">  ORDER BY year_month;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>data_df <span class="op">=</span> conn_py.sql(query_liquors_sales).df()</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>data_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year_month    month liquor_type  bottles_sold
0 2012-01-01  January     Tequila       51814.0
1 2012-01-01  January         Gin       46827.0
2 2012-01-01  January       Other      138041.0
3 2012-01-01  January      Brandy       71967.0
4 2012-01-01  January    Schnapps       83489.0</code></pre>
</div>
</div>
<p>We write the query as a docstring and then pass it to the <code>.sql()</code> command. Also, notice that we get our query results as a Pandas data frame with the <code>.df()</code> at the end.</p>
<p>Since we are working with time series data, we will need to reshape our data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>pivoted_data <span class="op">=</span> data_df.pivot(index   <span class="op">=</span> [<span class="st">'year_month'</span>, <span class="st">'month'</span>], </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                             columns <span class="op">=</span> <span class="st">'liquor_type'</span>, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                             values  <span class="op">=</span> <span class="st">'bottles_sold'</span>).reset_index()</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing values</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>pivoted_data <span class="op">=</span> pivoted_data.fillna(<span class="dv">0</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>pivoted_data.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>liquor_type year_month     month   Brandy  ...  Tequila     Vodka    Whisky
0           2012-01-01   January  71967.0  ...  51814.0  365226.0  340421.0
1           2012-02-01  February  83090.0  ...  60387.0  377666.0  431452.0
2           2012-03-01     March  81131.0  ...  61047.0  412089.0  373689.0
3           2012-04-01     April  83601.0  ...  79944.0  443737.0  402901.0
4           2012-05-01       May  87468.0  ...  84798.0  501372.0  468374.0

[5 rows x 12 columns]</code></pre>
</div>
</div>
<p>Here, we pivoted in a wider shape our base data frame and created a new time series column for each liquor type, leaving in place the columns <code>year_month</code> and <code>month</code>. We also fill the missing values with zeroes. For example, remember that we started recording official mezcal sales in 2016, meaning that the <code>NaN</code> at the beginning of the <code>Mezcal</code> column will be filled with zeroes. This is because we will use the sales of each type of liquor as predictors of rum sales.</p>
<p>Next, we will organize our data according to the time series structure. Remember that <strong>the order of our observations matters</strong> in this kind of data. Also we will split our data in two sets, one for training, another for testing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-36"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-36" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-36-1" class="code-annotation-target"><a href="#annotated-cell-36-1" aria-hidden="true" tabindex="-1"></a>pivoted_data[<span class="st">'year_month'</span>] <span class="op">=</span> pd.to_datetime(pivoted_data[<span class="st">'year_month'</span>])</span>
<span id="annotated-cell-36-2"><a href="#annotated-cell-36-2" aria-hidden="true" tabindex="-1"></a>pivoted_data <span class="op">=</span> pivoted_data.sort_values(by<span class="op">=</span><span class="st">'year_month'</span>)</span>
<span id="annotated-cell-36-3"><a href="#annotated-cell-36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-36-4"><a href="#annotated-cell-36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define target (Rum) and features (all other columns except year_month and Rum)</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-36" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-36-5" class="code-annotation-target"><a href="#annotated-cell-36-5" aria-hidden="true" tabindex="-1"></a>target   <span class="op">=</span> <span class="st">'Rum'</span></span>
<span id="annotated-cell-36-6"><a href="#annotated-cell-36-6" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> pivoted_data.columns <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> [<span class="st">'year_month'</span>, <span class="st">'Rum'</span>]]</span>
<span id="annotated-cell-36-7"><a href="#annotated-cell-36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-36-8"><a href="#annotated-cell-36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate target and features</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-36" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-36-9" class="code-annotation-target"><a href="#annotated-cell-36-9" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pivoted_data[target]</span>
<span id="annotated-cell-36-10"><a href="#annotated-cell-36-10" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pivoted_data[features]</span>
<span id="annotated-cell-36-11"><a href="#annotated-cell-36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-36-12"><a href="#annotated-cell-36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define test period (last two quarters of 2019)</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-36" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-36-13" class="code-annotation-target"><a href="#annotated-cell-36-13" aria-hidden="true" tabindex="-1"></a>train_cutoff <span class="op">=</span> pivoted_data[<span class="st">'year_month'</span>] <span class="op">&lt;</span> <span class="st">'2019-07-01'</span></span>
<span id="annotated-cell-36-14"><a href="#annotated-cell-36-14" aria-hidden="true" tabindex="-1"></a>test_cutoff  <span class="op">=</span> <span class="op">~</span>train_cutoff</span>
<span id="annotated-cell-36-15"><a href="#annotated-cell-36-15" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-36" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-36-16" class="code-annotation-target"><a href="#annotated-cell-36-16" aria-hidden="true" tabindex="-1"></a>X_train, X_test <span class="op">=</span> X[train_cutoff], X[test_cutoff]</span>
<span id="annotated-cell-36-17"><a href="#annotated-cell-36-17" aria-hidden="true" tabindex="-1"></a>y_train, y_test <span class="op">=</span> y[train_cutoff], y[test_cutoff]</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-36" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="1,2" data-code-annotation="1">Ensure the data is in chronological order.</span>
</dd>
<dt data-target-cell="annotated-cell-36" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="5,6" data-code-annotation="2">Identify the target variable and the features.</span>
</dd>
<dt data-target-cell="annotated-cell-36" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="9,10" data-code-annotation="3">Separate the target variable from the features.</span>
</dd>
<dt data-target-cell="annotated-cell-36" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="13,14" data-code-annotation="4">Define a test period, which in this case will be the last two quarters of 2019. The <code>train_cutoff</code> and <code>test_cutoff</code> objects are boolean Pandas series used to filter the data.</span>
</dd>
<dt data-target-cell="annotated-cell-36" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="16,17" data-code-annotation="5">Split the data into training and testing datasets.</span>
</dd>
</dl>
</div>
</div>
<p>With our disjoint sets ready, we can continue with the next step, encoding our categorical <code>month</code> variable using the one-hot encoding method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-37"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-37-1" class="code-annotation-target"><a href="#annotated-cell-37-1" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> OneHotEncoder(sparse_output<span class="op">=</span><span class="va">False</span>, drop<span class="op">=</span><span class="st">'first'</span>)</span>
<span id="annotated-cell-37-2"><a href="#annotated-cell-37-2" aria-hidden="true" tabindex="-1"></a>encoded_months_train <span class="op">=</span> encoder.fit_transform(X_train[[<span class="st">'month'</span>]])</span>
<span id="annotated-cell-37-3"><a href="#annotated-cell-37-3" aria-hidden="true" tabindex="-1"></a>encoded_months_test  <span class="op">=</span> encoder.transform(X_test[[<span class="st">'month'</span>]])</span>
<span id="annotated-cell-37-4"><a href="#annotated-cell-37-4" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-37-5" class="code-annotation-target"><a href="#annotated-cell-37-5" aria-hidden="true" tabindex="-1"></a>month_columns   <span class="op">=</span> encoder.get_feature_names_out([<span class="st">'month'</span>])</span>
<span id="annotated-cell-37-6"><a href="#annotated-cell-37-6" aria-hidden="true" tabindex="-1"></a>X_train_encoded <span class="op">=</span> pd.DataFrame(encoded_months_train, columns<span class="op">=</span>month_columns, index<span class="op">=</span>X_train.index)</span>
<span id="annotated-cell-37-7"><a href="#annotated-cell-37-7" aria-hidden="true" tabindex="-1"></a>X_test_encoded  <span class="op">=</span> pd.DataFrame(encoded_months_test, columns<span class="op">=</span>month_columns, index<span class="op">=</span>X_test.index)</span>
<span id="annotated-cell-37-8"><a href="#annotated-cell-37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-37-9"><a href="#annotated-cell-37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the original 'month' column and add the encoded columns</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-37-10" class="code-annotation-target"><a href="#annotated-cell-37-10" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> X_train.drop(columns<span class="op">=</span>[<span class="st">'month'</span>]).join(X_train_encoded)</span>
<span id="annotated-cell-37-11"><a href="#annotated-cell-37-11" aria-hidden="true" tabindex="-1"></a>X_test  <span class="op">=</span> X_test.drop(columns<span class="op">=</span>[<span class="st">'month'</span>]).join(X_test_encoded)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-37" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="1,2,3" data-code-annotation="1">Apply one-hot encoding to the <code>month</code> variable.</span>
</dd>
<dt data-target-cell="annotated-cell-37" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="5,6,7" data-code-annotation="2">Replace the original <code>month</code> column with the one-hot encoded columns.</span>
</dd>
<dt data-target-cell="annotated-cell-37" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="10,11" data-code-annotation="3">Remove the original <code>month</code> column and integrate the encoded columns into the dataset.</span>
</dd>
</dl>
</div>
</div>
<p>With the months now encoded in our feature sets (<code>X_</code>), we are ready to train the model. Since this is a forecasting problem, additional steps are required to adapt our regression model. We will use the <a href="https://www.sktime.net/en/latest/api_reference/auto_generated/sktime.forecasting.compose.make_reduction.html"><code>make_reduction</code></a> function from <a href="https://www.sktime.net/en/stable/"><code>sktime</code></a>, a machine learning framework for time series, to transform a simple estimator—<code>RandomForestRegressor</code> in this case—into a forecaster capable of handling time series data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the forecaster</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>forecaster <span class="op">=</span> make_reduction(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>), <span class="co"># Scikit-learn regression model</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    strategy<span class="op">=</span><span class="st">"recursive"</span>, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    window_length<span class="op">=</span><span class="dv">6</span>  <span class="co"># Use 6 months of past data</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrap the forecaster with ConformalIntervals</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>conformal_forecaster <span class="op">=</span> ConformalIntervals(forecaster)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the conformal forecaster</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>conformal_forecaster.fit(y_train, X<span class="op">=</span>X_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 {
    /* Definition of color scheme common for light and dark mode */
    --sklearn-color-text: black;
    --sklearn-color-line: gray;
    /* Definition of color scheme for objects */
    --sklearn-color-level-0: #fff5e6;
    --sklearn-color-level-1: #f6e4d2;
    --sklearn-color-level-2: #ffe0b3;
    --sklearn-color-level-3: chocolate;

    /* Specific color for light theme */
    --sklearn-color-text-on-default-background: var(--theme-code-foreground, var(--jp-content-font-color1, black));
    --sklearn-color-background: var(--theme-background, var(--jp-layout-color0, white));
    --sklearn-color-border-box: var(--theme-code-foreground, var(--jp-content-font-color1, black));
    --sklearn-color-icon: #696969;

    @media (prefers-color-scheme: dark) {
      /* Redefinition of color scheme for dark theme */
      --sklearn-color-text-on-default-background: var(--theme-code-foreground, var(--jp-content-font-color1, white));
      --sklearn-color-background: var(--theme-background, var(--jp-layout-color0, #111));
      --sklearn-color-border-box: var(--theme-code-foreground, var(--jp-content-font-color1, white));
      --sklearn-color-icon: #878787;
    }
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 {
    color: var(--sklearn-color-text);
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 pre {
    padding: 0;
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 input.sk-hidden--visually {
    border: 0;
    clip: rect(1px 1px 1px 1px);
    clip: rect(1px, 1px, 1px, 1px);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-dashed-wrapped {
    border: 1px dashed var(--sklearn-color-line);
    margin: 0 0.4em 0.5em 0.4em;
    box-sizing: border-box;
    padding-bottom: 0.4em;
    background-color: var(--sklearn-color-background);
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-container {
    /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
       but bootstrap.min.css set `[hidden] { display: none !important; }`
       so we also need the `!important` here to be able to override the
       default hidden behavior on the sphinx rendered scikit-learn.org.
       See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
    display: inline-block !important;
    position: relative;
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-text-repr-fallback {
    display: none;
  }

  div.sk-parallel-item,
  div.sk-serial,
  div.sk-item {
    /* draw centered vertical line to link estimators */
    background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
    background-size: 2px 100%;
    background-repeat: no-repeat;
    background-position: center center;
  }

  /* Parallel-specific style estimator block */

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-parallel-item::after {
    content: "";
    width: 100%;
    border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
    flex-grow: 1;
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-parallel {
    display: flex;
    align-items: stretch;
    justify-content: center;
    background-color: var(--sklearn-color-background);
    position: relative;
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-parallel-item {
    display: flex;
    flex-direction: column;
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-parallel-item:first-child::after {
    align-self: flex-end;
    width: 50%;
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-parallel-item:last-child::after {
    align-self: flex-start;
    width: 50%;
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-parallel-item:only-child::after {
    width: 0;
  }

  /* Serial-specific style estimator block */

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-serial {
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: var(--sklearn-color-background);
    padding-right: 1em;
    padding-left: 1em;
  }


  /* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
  clickable and can be expanded/collapsed.
  - Pipeline and ColumnTransformer use this feature and define the default style
  - Estimators will overwrite some part of the style using the `sk-estimator` class
  */

  /* Pipeline and ColumnTransformer style (default) */

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-toggleable {
    /* Default theme specific background. It is overwritten whether we have a
    specific estimator or a Pipeline/ColumnTransformer */
    background-color: var(--sklearn-color-background);
  }

  /* Toggleable label */
  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 label.sk-toggleable__label {
    cursor: pointer;
    display: block;
    width: 100%;
    margin-bottom: 0;
    padding: 0.5em;
    box-sizing: border-box;
    text-align: center;
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 label.sk-toggleable__label-arrow:before {
    /* Arrow on the left of the label */
    content: "▸";
    float: left;
    margin-right: 0.25em;
    color: var(--sklearn-color-icon);
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 label.sk-toggleable__label-arrow:hover:before {
    color: var(--sklearn-color-text);
  }

  /* Toggleable content - dropdown */

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-toggleable__content {
    max-height: 0;
    max-width: 0;
    overflow: hidden;
    text-align: left;
    background-color: var(--sklearn-color-level-0);
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-toggleable__content pre {
    margin: 0.2em;
    border-radius: 0.25em;
    color: var(--sklearn-color-text);
    background-color: var(--sklearn-color-level-0);
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 input.sk-toggleable__control:checked~div.sk-toggleable__content {
    /* Expand drop-down */
    max-height: 200px;
    max-width: 100%;
    overflow: auto;
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
    content: "▾";
  }

  /* Pipeline/ColumnTransformer-specific style */

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
    color: var(--sklearn-color-text);
    background-color: var(--sklearn-color-level-2);
  }

  /* Estimator-specific style */

  /* Colorize estimator box */
  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
    /* unfitted */
    background-color: var(--sklearn-color-level-2);
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-label label.sk-toggleable__label,
  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-label label {
    /* The background is the default theme color */
    color: var(--sklearn-color-text-on-default-background);
  }

  /* On hover, darken the color of the background */
  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-label:hover label.sk-toggleable__label {
    color: var(--sklearn-color-text);
    background-color: var(--sklearn-color-level-2);
  }

  /* Estimator label */

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-label label {
    font-family: monospace;
    font-weight: bold;
    display: inline-block;
    line-height: 1.2em;
  }

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-label-container {
    text-align: center;
  }

  /* Estimator-specific */
  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-estimator {
    font-family: monospace;
    border: 1px dotted var(--sklearn-color-border-box);
    border-radius: 0.25em;
    box-sizing: border-box;
    margin-bottom: 0.5em;
    background-color: var(--sklearn-color-level-0);
  }

  /* on hover */
  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 div.sk-estimator:hover {
    background-color: var(--sklearn-color-level-2);
  }

  /* Specification for estimator info */

  .sk-estimator-doc-link,
  a:link.sk-estimator-doc-link,
  a:visited.sk-estimator-doc-link {
    float: right;
    font-size: smaller;
    line-height: 1em;
    font-family: monospace;
    background-color: var(--sklearn-color-background);
    border-radius: 1em;
    height: 1em;
    width: 1em;
    text-decoration: none !important;
    margin-left: 1ex;
    border: var(--sklearn-color-level-1) 1pt solid;
    color: var(--sklearn-color-level-1);
  }

  /* On hover */
  div.sk-estimator:hover .sk-estimator-doc-link:hover,
  .sk-estimator-doc-link:hover,
  div.sk-label-container:hover .sk-estimator-doc-link:hover,
  .sk-estimator-doc-link:hover {
    background-color: var(--sklearn-color-level-3);
    color: var(--sklearn-color-background);
    text-decoration: none;
  }

  /* Span, style for the box shown on hovering the info icon */
  .sk-estimator-doc-link span {
    display: none;
    z-index: 9999;
    position: relative;
    font-weight: normal;
    right: .2ex;
    padding: .5ex;
    margin: .5ex;
    width: min-content;
    min-width: 20ex;
    max-width: 50ex;
    color: var(--sklearn-color-text);
    box-shadow: 2pt 2pt 4pt #999;
    background: var(--sklearn-color-level-0);
    border: .5pt solid var(--sklearn-color-level-3);
  }

  .sk-estimator-doc-link:hover span {
    display: block;
  }

  /* "?"-specific style due to the `<a>` HTML tag */

  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 a.estimator_doc_link {
    float: right;
    font-size: 1rem;
    line-height: 1em;
    font-family: monospace;
    background-color: var(--sklearn-color-background);
    border-radius: 1rem;
    height: 1rem;
    width: 1rem;
    text-decoration: none;
    color: var(--sklearn-color-level-1);
    border: var(--sklearn-color-level-1) 1pt solid;
  }

  /* On hover */
  #sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636 a.estimator_doc_link:hover {
    background-color: var(--sklearn-color-level-3);
    color: var(--sklearn-color-background);
    text-decoration: none;
  }
</a></style><div id="sk-7b40ffc1-d43d-4f49-960c-b25ad0c92636" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ConformalIntervals(forecaster=RecursiveTabularRegressionForecaster(estimator=RandomForestRegressor(random_state=42),
                                                                   window_length=6))</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="UUID('346777a0-1af7-4050-bcf6-11f2d51133fa')" type="checkbox"><label for="UUID('346777a0-1af7-4050-bcf6-11f2d51133fa')" class="sk-toggleable__label sk-toggleable__label-arrow">ConformalIntervals<a class="sk-estimator-doc-link" rel="noreferrer" target="_blank" href="https://www.sktime.net/en/v0.35.0/api_reference/auto_generated/sktime.forecasting.conformal.ConformalIntervals.html">?<span>Documentation for ConformalIntervals</span></a></label><div class="sk-toggleable__content"><pre>ConformalIntervals(forecaster=RecursiveTabularRegressionForecaster(estimator=RandomForestRegressor(random_state=42),
                                                                   window_length=6))</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="UUID('b1b093c3-a07d-4c31-97b2-6e98d3fb96dc')" type="checkbox"><label for="UUID('b1b093c3-a07d-4c31-97b2-6e98d3fb96dc')" class="sk-toggleable__label sk-toggleable__label-arrow">forecaster: RecursiveTabularRegressionForecaster</label><div class="sk-toggleable__content"><pre>RecursiveTabularRegressionForecaster(estimator=RandomForestRegressor(random_state=42),
                                     window_length=6)</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="UUID('fa41b9a8-621e-46d6-924b-336716ac7358')" type="checkbox"><label for="UUID('fa41b9a8-621e-46d6-924b-336716ac7358')" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor(random_state=42)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="UUID('cc72ac7c-2fdc-4629-8453-9c926a787f37')" type="checkbox"><label for="UUID('cc72ac7c-2fdc-4629-8453-9c926a787f37')" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor<a class="sk-estimator-doc-link" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.ensemble.RandomForestRegressor.html">?<span>Documentation for RandomForestRegressor</span></a></label><div class="sk-toggleable__content"><pre>RandomForestRegressor(random_state=42)</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>First, we instantiate the <code>forecaster</code>, which uses a <code>RandomForestRegressor</code> as its core model. Next, we wrap it in the ConformalIntervals class to create a conformal predictor. This allows us not only to make predictions but also to generate confidence intervals, adding an extra layer of uncertainty quantification to our forecasts. The hierarchical structure of the model can be inspected in the visualization displayed below the preceding code snippet.</p>
<p>Once the model is set up, we train it using the <code>fit</code> function. With the trained model ready, we can proceed to forecasting. Now, let’s predict the rum sales:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the forecasting horizon</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>fh <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(y_test) <span class="op">+</span> <span class="dv">1</span>))  <span class="co"># Forecast horizon matches test data length</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Point forecasts</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> conformal_forecaster.predict(fh<span class="op">=</span>fh, X<span class="op">=</span>X_test)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict confidence intervals</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>pred_int <span class="op">=</span> conformal_forecaster.predict_interval(fh<span class="op">=</span>fh, X<span class="op">=</span>X_test, coverage<span class="op">=</span><span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Forecasted rum sales for the last two quarters of 2019:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>90    223255.97
91    214242.75
92    214532.89
93    228206.81
94    218049.97
95    222827.08
Name: Rum, dtype: float64</code></pre>
</div>
</div>
<p>Forecasted rum sales confidence interval (90% coverage) for the last two quarters of 2019:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pred_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Rum             
            0.9             
          lower        upper
90   181568.086    261905.29
91   167177.517  252442.6645
92   168367.598   254874.554
93    188172.32   264794.065
94   180995.268   254576.388
95  183766.0995  262251.6415</code></pre>
</div>
</div>
<p>Here is the predicted output for the last two 2019 quarters. Let’s evaluate the model to see how well it performed against the observed ground truth.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the forecast</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> mean_absolute_error(y_test, y_pred)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean Absolute Error (MAE): </span><span class="sc">{</span>mae<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean Absolute Error (MAE): 15972.041666666672</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean Squared Error (MSE): </span><span class="sc">{</span>mse<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean Squared Error (MSE): 307287238.5831502</code></pre>
</div>
</div>
<p>These numbers don’t tell us much on their own, and it would be ideal to compare them against the MAE and MSE of another model. However, we won’t invest more time in that. Feel free to train a different model to make the comparison!</p>
<p>Next, a key step in evaluating the model is visualizing how its forecasts compare with the observed ground truth. To achieve this, we create a plot of our forecast:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract CI</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>y_pred_lower <span class="op">=</span> pred_int[(<span class="st">'Rum'</span>, <span class="fl">0.9</span>, <span class="st">'lower'</span>)].values</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>y_pred_upper <span class="op">=</span> pred_int[(<span class="st">'Rum'</span>, <span class="fl">0.9</span>, <span class="st">'upper'</span>)].values</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine actual and predicted data</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>results_2019 <span class="op">=</span> pivoted_data[pivoted_data[<span class="st">'year_month'</span>].dt.year <span class="op">==</span> <span class="dv">2019</span>][[<span class="st">'year_month'</span>, <span class="st">'Rum'</span>]].copy()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>results_2019[<span class="st">'Forecast'</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>results_2019[<span class="st">'Lower'</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>results_2019[<span class="st">'Upper'</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign forecast values and prediction intervals for the test period</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>test_period <span class="op">=</span> results_2019[<span class="st">'year_month'</span>] <span class="op">&gt;=</span> <span class="st">'2019-07-01'</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>results_2019.loc[test_period, <span class="st">'Forecast'</span>] <span class="op">=</span> y_pred.values</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>results_2019.loc[test_period, <span class="st">'Lower'</span>] <span class="op">=</span> y_pred_lower</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>results_2019.loc[test_period, <span class="st">'Upper'</span>] <span class="op">=</span> y_pred_upper</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot actual Rum sales</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>plt.plot(results_2019[<span class="st">'year_month'</span>], results_2019[<span class="st">'Rum'</span>], label<span class="op">=</span><span class="st">'Actual rum sales'</span>, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot forecasted Rum sales</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>plt.plot(results_2019[<span class="st">'year_month'</span>], results_2019[<span class="st">'Forecast'</span>], label<span class="op">=</span><span class="st">'Forecasted rum sales'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, marker<span class="op">=</span><span class="st">'x'</span>, color<span class="op">=</span><span class="st">'#b1d25a'</span>)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot prediction intervals as separate lines</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>plt.plot(results_2019.loc[test_period, <span class="st">'year_month'</span>], results_2019.loc[test_period, <span class="st">'Lower'</span>], label<span class="op">=</span><span class="st">'Lower bound'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, color<span class="op">=</span><span class="st">'#b1d25a'</span>)</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>plt.plot(results_2019.loc[test_period, <span class="st">'year_month'</span>], results_2019.loc[test_period, <span class="st">'Upper'</span>], label<span class="op">=</span><span class="st">'Upper bound'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, color<span class="op">=</span><span class="st">'#b1d25a'</span>)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Highlight the test period</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span>pd.to_datetime(<span class="st">'2019-07-01'</span>), color<span class="op">=</span><span class="st">'#ed7c65'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Start of forecast period'</span>)</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Forecast of rum bottles sold for 2019 Q3 and Q4'</span>)</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Month'</span>)</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Bottles sold'</span>)</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(array([17897., 17956., 18017., 18078., 18140., 18201.]), [Text(17897.0, 0, '2019-01'), Text(17956.0, 0, '2019-03'), Text(18017.0, 0, '2019-05'), Text(18078.0, 0, '2019-07'), Text(18140.0, 0, '2019-09'), Text(18201.0, 0, '2019-11')])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="data_pipeline_mage_files/figure-html/plot_prediction-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>We see that the ground truth falls within our confidence interval; we can also compare our prediction with the ground truth (consider that the ground truth won’t be present in real life since that period hasn’t happened). So you can now go with your stakeholders and present this chart so they can organize their rum orders for that year’s holiday season.</p>
<p>That’s fantastic! But can we go even further downstream in our data flow by diving into stakeholder management, effective result presentation, and model monitoring? 🤩</p>
<p>Yes, but “what do we say to the god of death?”</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/got_not_to_day.gif" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>And there you have it: we have used our DuckDB data to create a predictive model!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/ml_done_data_lifecycle_logos.png" class="img-fluid figure-img"></p>
<figcaption>Progress we’ve made so far.</figcaption>
</figure>
</div>
<p>At this point, you must be overwhelmed and tired, but that’s because we have worked and implemented a whole data life cycle. Congratulation!</p>
</section>
<section id="recap" class="level2">
<h2 class="anchored" data-anchor-id="recap">Recap</h2>
<p>During this project, we did a lot. We started analyzing the source of our data and thinking about the best way to retrieve it. We coded a mechanism to fetch the data, transformed it with Polars, and then stored it on disk. Finally, we illustrated that the data we got is indeed helpful in answering real-life questions.</p>
<p>The data landscape is vast, with many appliances available for every task. In this project, we explored several modern tools to address a data engineering problem. However, it’s important not to limit yourself to these specific libraries. Each issue may require a different set of tools, but the key is to focus on the foundational principles of data engineering. The technical stack can be chosen later, but the core concepts will pave the way to finding practical solutions to your challenges.</p>
<p>Without more, I hope here you have learned a little and that you can apply some of these things in your tasks :) ## About the polar bear in the header</p>
<p>It’s the <em>Bonjour</em> Bear, you can read more about the bear in <a href="https://knowyourmeme.com/memes/bonjour-bear">Know Your Meme</a> :)</p>
</section>
<section id="cited-works-and-recommended-readings" class="level2">
<h2 class="anchored" data-anchor-id="cited-works-and-recommended-readings">Cited works and recommended readings</h2>
<ul>
<li><p>Kersten, T., Leis, V., Kemper, A., Neumann, T., Pavlo, A., &amp; Boncz, P. (2018). Everything you always wanted to know about compiled and vectorized queries but were afraid to ask. <em>Proceedings of the VLDB Endowment</em>, 11(13), 2209-2222. <a href="https://doi.org/10.14778/3275366.3275370">https://doi.org/10.14778/3275366.3275370</a>.</p></li>
<li><p>Reis, J., &amp; Housley, M. (2022). <em>Fundamentals of data engineering: Plan and build robust data systems</em>. O’Reilly Media.</p></li>
</ul>
</section>
<section id="citation" class="level2">
<h2 class="anchored" data-anchor-id="citation">Citation</h2>
<p>No citation is required, but if you found this project helpful, I’d greatly appreciate a mention! 😄</p>
</section>
<section id="acknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h2>
<p>To Little Mai, my home office manger and editor in chief of “Paws-On Data”</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/Little_Mai_data_eng.png" class="img-fluid figure-img"></p>
<figcaption>Little Mai</figcaption>
</figure>
</div>
</section>
<section id="contact" class="level2">
<h2 class="anchored" data-anchor-id="contact">Contact</h2>
<p>Have questions, suggestions, or just want to connect? Feel free to reach out!</p>
<ul>
<li>LinkedIn: <a href="https://www.linkedin.com/in/jose-barrantes/">José Pablo Barrantes</a></li>
<li>BlueSky: <a href="https://bsky.app/profile/doggofan77.bsky.social">doggofan77.bsky.social</a></li>
</ul>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>According to their web page :)<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no budget for a “scientist,” and at this point in history, there is no such thing as a “data engineer” in <span style="text-decoration: line-through;">Latin America</span> Iowa.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Please pretend that the tools existed at the time. I certainly wished for a data ecosystem like this, and I was in Latin America (Little Mai and I still are, and we’re loving it 🪇🐑).<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>I spent a few days debugging this and initially signaled Mage as the culprit, but in the end, the SODA API was responsible.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>The process will get frozen at some point with no notifications or feedback.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Little Mai and I 🐑.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>This occurs when the returned object is a data frame (Polars or Pandas). In this concrete case, that won’t happen since we’re returning a dictionary, but in the following blocks, it will be the case since the objects transferred will be Polars data frames. With dictionaries, serialization will still occur but in <a href="https://github.com/mage-ai/mage-ai/issues/4725">JSON format</a>.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>We can also use <code>.pl()</code> to cast the results into a Polars data frame or <code>.df()</code> for a Pandas one.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>For instance, I should move the <code>fetch_batch</code> function outside the <code>load_data_from_api</code> loader. Defining functions within other functions is generally considered a bad practice, as it can make the code harder to read, test, and maintain.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>Repeat after me: “We love open source.”<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p>We’ve found Manning a reliable editorial for technical books. Most of the time, their materials have high-quality content that is easy to digest. Highly recommended 👌.<a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn12"><p>The only action we did to enable the use of DuckDB was <code>pip install duckdb</code>.<a href="#fnref12" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn13"><p>Please note that this is not a traditional exporter block; it could be a custom block. I chose the exporter type because it interacts with the local database and creates the table, even though no data is exported in an explicit manner.<a href="#fnref13" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn14"><p>Free Bird’s guitar solo starts playing in the background 🎸🎶🎶.<a href="#fnref14" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn15"><p>If you’ve had the pleasure to work with geospatial analysis before, you probably already know that CRSs are always awfully documented (i.e., not documentation at all). So, working with coordinates of less standard regions is a painful process full of guesses.<a href="#fnref15" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn16"><p>It is more to illustrate that DuckDB can be the source that feeds different systems. We already checked R, and we’re continuing with Python. You can follow with Power BI or Tableau if you want :)<a href="#fnref16" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>